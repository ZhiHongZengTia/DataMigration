<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>Linux下嵌入式Qt开发学习总结报告</title><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


/*
 * ------------------------------------------------------------------------
 * mdmdt-light.css
 * (c) 2024
 * Author: cayxc
 * Homepage:  https://gitee.com/cayxc/mdmdt  https://github.com/cayxc/Mdmdt
 * License: Apache-2.0
 * ------------------------------------------------------------------------
*/
:root {
  --bg-color: rgb(250, 250, 250);
  --bg-color2: rgb(237, 237, 239);

  --text-color: #000;
  --text-grey: #666;
  --text-code: #2f479f;
  --title-color: #070909;
  --border-color: #d3d3d3ff;

  --color-1: #3e69d7;
  --color-1-0-a: rgba(62, 105, 215, 0.15);
  --color-1-0-b: rgba(62, 105, 215, 0.06);

  --color-2: #f59102;
  --color-2-0-a: rgba(245, 145, 2, 0.15);
  --color-2-0-b: rgba(245, 145, 2, 0.06);
  --color-2-0-c: rgba(245, 145, 2, 0.3);

  --color-3: #03b736;
  --color-3-0-a: rgba(3, 183, 54, 0.15);
  --color-3-0-b: rgba(3, 183, 54, 0.06);

  --color-4: #8250df;
  --color-4-0-a: rgba(130, 80, 223, 0.15);
  --color-4-0-b: rgba(130, 80, 223, 0.06);

  --color-5: #e30f2e;
  --color-5-0-a: rgba(227, 15, 46, 0.15);
  --color-5-0-b: rgba(227, 15, 46, 0.06);

  --md-char-color: rgba(72, 93, 108, 0.75);
  --meta-content-color: var(--md-char-color);
  --primary-color: var(--color-1);
  --primary-btn-border-color: var(--bg-color2);
  --primary-btn-text-color: var(--text-color);
  --window-border: 1px solid var(--border-color);
  --active-file-bg-color: var(--bg-color2);
  --active-file-text-color: var(--color-1);
  --active-file-border-color: var(--color-1);
  --side-bar-bg-color: var(--bg-color);
  --item-hover-bg-color: var(--bg-color2);
  --item-hover-text-color: var(--color-1);
  --select-text-bg-color: var(--color-1-0-a);
  --monospace: monospace;

  /*--mermaid-theme: neutral;*/ /*or base, dark, forest, neutral, night*/
  --mermaid-font-family: "trebuchet ms", verdana, arial, sans-serif;
  --mermaid-sequence-numbers: on;
  --mermaid-flowchart-curve: linear;
  --mermaid--gantt-left-padding: 75;
}

html {
  font-size: 16px;
  background-color: var(--bg-color);
  color: var(--text-color);
  letter-spacing: 0.5px;
  -webkit-font-smoothing: antialiased;
  scroll-behavior: smooth;
}

body {
  font-size: 16px;
  line-height: 1.6;
  box-sizing: border-box;
  overflow-x: hidden;
  font-family: "PingFang SC", "Helvetica Neue", Helvetica, "Microsoft YaHei", Arial, sans-serif !important;
  background: var(--bg-color);
}

/*
 * ------------------------
 * scroll style
 * ------------------------
*/
html,
body div,
body pre,
body ul,
body section,
body content,
body #write {
  scrollbar-color: var(--border-color) var(--bg-color2) !important;
  scrollbar-width: thin !important;
}

body,
#megamenu-content,
header {
  background: var(--bg-color) !important;
}
header {
  box-shadow: 0 1px 3px 0 rgba(27, 27, 31, 0.16), 0 2px 5px 0 rgba(27, 27, 31, 0.1);
}

/*
 * -----------------------------------
 * h1 ~ h6
 * p, strong, dl, em, u, kbd, hr, mark
 * -----------------------------------
*/
h1, h2, h3, h4, h5, h6 {
  position: relative;
  line-height: 1.5;
  margin: 32px 0 16px;
  color: var(--title-color);
  letter-spacing: 2px;
}

h1 {
  font-size: 32px;
  border-bottom: 1px solid var(--border-color);
}

h2 {
  font-size: 28px;
}

h3 {
  font-size: 24px;
}

h4 {
  font-size: 20px;
}

h5 {
  font-size: 18px;
}

h6 {
  font-size: 16px;
}

h3.md-focus:before,
h4.md-focus:before,
h5.md-focus:before,
h6.md-focus:before {
  font-size: 12px;
  left: -30px;
  color: var(--color-1);
}
h3.md-focus:before {
  top: 9px;
}
h4.md-focus:before {
  top: 7px;
}
h5.md-focus:before {
  top: 3px;
}
h6.md-focus:before {
  top: 3px;
}

hr {
  border: none;
  height: 1px;
  margin: 16px 0;
  background: var(--border-color);
  box-sizing: border-box;
}

p {
  margin: 16px 0;
}

strong {
  font-weight: bold;
  color: var(--title-color);
}

u {
  text-decoration-color: var(--title-color);
}

em {
  font-weight: 400;
}

del {
  font-size: 16px;
  color: var(--text-grey);
  text-decoration: line-through;
  text-decoration-color: var(--color-2);
  -moz-text-decoration-color: var(--color-2);
}

mark {
  background-color: var(--color-1);
  color: var(--bg-color);
  padding: 0 4px;
  border-radius: 5px;
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}
/*
 * ------------------------
 * image
 * ------------------------
*/
img {
  display: block;
  max-width: 100%;
  border-radius: 8px;
  margin: 0 auto 16px;
  color: var(--md-char-color);
}
span.md-image,
span.md-image span.md-content,
span.md-image span.md-image-src-span,
span.md-image span.md-image-before-src,
span.md-image span.md-image-after-src,
span.md-image span.md-image-input-src-btn,
span.md-image span.md-image-pick-file-btn,
span.md-image span.md-before::before,
span.md-image span.md-image-input-src-btn::before,
span.md-image span.md-image-pick-file-btn::before {
  color: var(--color-1);
}
span.md-image-btn {
  background: var(--bg-color2);
}
span.md-image-btn:hover::before {
  color: var(--bg-color) !important;
}
span.md-image span.md-image-pick-file-btn {
  border-left-color: var(--border-color);
}
/*
 * ------------------------
 * a, link
 * ------------------------
*/
a {
  font-weight: 500;
  text-decoration: none;
  color: var(--color-1);
  font-size: 16px;
}
a:hover,
.md-link a:hover,
.footnotes a:hover {
  color: var(--color-1);
  text-decoration: underline;
  cursor: pointer !important;
}
.unibody-window a:hover,
content a:hover {
  color: var(--color-2) !important;
}
.footnotes,
.footnotes a {
  font-size: 14px;
  text-decoration: none;
}
.footnotes .md-def-name::before,
.footnotes .md-def-name::after {
  color: var(--text-color);
}

.footnotes .md-def-url,
.md-link .md-url {
  text-decoration: none;
  color: var(--color-1);
}
/*
 * ------------------------
 * ul, ol
 * ------------------------
*/
ul {
  margin-left: 0;
  margin-top: 5px;
  margin-bottom: 5px;
  padding-left: 36px;
}
ol {
  margin-left: 0;
  margin-top: 5px;
  margin-bottom: 5px;
  padding-left: 40px;
}

ul li,
ol li {
  margin-bottom: 5px;
}

ul > li > p {
  margin: 0 0 0 -2px;
}

ol > li > p {
  margin: 0 0 0 -6px;
}
ul > .task-list-item > input {
  margin-left: -22px;
}
ul ul {
  margin-left: -2px;
}
ol ol {
  margin-left: -7px;
}
ol > li > ul {
  margin-left: -7px;
}

ul > li > ol {
  margin-left: -2px;
}

/*
 * ------------------------
 * code
 * ------------------------
*/
code, tt {
  margin: 16px 0;
  background: var(--bg-color2);
  font-size: 14px;
  box-sizing: border-box;
  border-radius: 5px;
  padding: 5px 10px;
  color: var(--text-code);
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}
p code,
p tt,
li code,
li tt,
blockquote code,
blockquote tt,
.md-alert code,
.md-alert tt,
table code,
table tt {
  padding: 3px 6px !important;
  background: var(--color-1-0-a);
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}
h1 code,
h2 code,
h3 code,
h4 code,
h5 code,
h6 code {
  vertical-align: middle;
}
h1 code {
  font-size: 18px;
}
h2 code {
  font-size: 16px;
}

.outline-content .outline-item code {
  font-size: 11px;
  padding: 2px 6px !important;
}
/*
 * ------------------------
 * pre
 * ------------------------
*/
pre {
  margin: 16px 0;
  padding: 16px;
  background: var(--bg-color2) !important;
  font-size: 14px !important;
  box-sizing: border-box;
  border-radius: 8px;
  color: var(--text-code);
  overflow: auto;
}

pre pre {
  background: transparent !important;
  padding: 5px 10px;
  border: none;
}

pre .CodeMirror-sizer {
  padding-left: 10px;
}

/*
 * ------------------------
 * blockquote
 * ------------------------
*/
blockquote,
.md-alert {
  margin: 16px 0;
  padding: 16px;
  background: var(--color-1-0-b);
  box-sizing: border-box;
  border-right: 10px solid transparent;
  border-left: 4px solid var(--color-1);
  border-radius: 8px;
}

blockquote blockquote {
  background: var(--color-1-0-b);
}

.md-alert.md-alert-note {
  border-left-color: var(--color-1);
  background: var(--color-1-0-b);
  color: var(--color-1) !important;
}
.md-alert.md-alert-note .md-alert-text-note {
  color: var(--color-1);
}

.md-alert.md-alert-caution {
  border-left-color: var(--color-2);
  background: var(--color-2-0-b);
  color: var(--color-2) !important;;
}
.md-alert.md-alert-caution .md-alert-text-caution {
  color: var(--color-2);
}

.md-alert.md-alert-tip {
  border-left-color: var(--color-3);
  background: var(--color-3-0-b);
  color: var(--color-3) !important;
}
.md-alert.md-alert-tip .md-alert-text-tip {
  color: var(--color-3);
}

.md-alert.md-alert-important {
  border-left-color: var(--color-4);
  background: var(--color-4-0-b);
  color: var(--color-4) !important;
}
.md-alert.md-alert-important .md-alert-text-important {
  color: var(--color-4);
}

.md-alert.md-alert-warning {
  border-left-color: var(--color-5);
  background: var(--color-5-0-b);
  color: var(--color-5) !important;
}
.md-alert.md-alert-warning .md-alert-text-warning {
  color: var(--color-5);
}
/*
 * ------------------------
 * sup, sub, kbd
 * ------------------------
*/
sup, sub {
  font-size: 12px;
  padding: 0 10px;
}
sup.md-footnote {
  background: transparent;
  padding: 0 2px;
  color: var(--color-1);
}
sup.md-footnote:hover {
  color: var(--color-2);
  cursor: pointer;
}
kbd {
  display: inline-block;
  border: none;
  background: var(--title-color);
  color: var(--bg-color);
  border-image: none;
  border-radius: 5px;
  padding: 0 6px;
  font-size: 14px;
  box-shadow: none;
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}
::selection {
  background: var(--color-2-0-c);
  box-decoration-break: clone;
  -webkit-box-decoration-break: clone;
}

/*
 * ------------------------
 * table
 * ------------------------
*/
figure.table-figure {
  margin-top: 24px !important;
}
table {
  width: 100%;
  margin-top: 16px;
  text-align: left;
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 8px;
  overflow: hidden;
  padding: 0 !important;
  border: 1px solid var(--border-color) !important;
}
table thead tr th {
  background: var(--bg-color2);
}
table tbody tr:nth-child(even) td {
  background: var(--bg-color2);
}
table tbody tr:nth-child(odd) td {
  background: var(--bg-color);
}
table tr th, table tr td {
  padding: 10px !important;
}
table tr td,
table thead tr th {
  border-left: 1px solid var(--border-color) !important;
}
table tbody tr td:first-of-type,
table thead tr th:first-of-type {
  border-left: none !important;
}

.md-grid-board-wrap table {
  border: none !important;
  border-radius: 0;
}
.md-grid-board-wrap table tr th,
.md-grid-board-wrap table tr td {
  padding: 0 !important;
}
#md-grid-width,
#md-grid-height {
  text-align: center !important;
  padding: 1px 0;

}
button#md-resize-grid {
  display: block !important;
  width: 100%;
  margin: 5px auto 0;
  color: var(--bg-color);
}
button#md-resize-grid:hover {
  color: var(--color-1);
  border-color: var(--color-1);
}

/*
 * ------------------------
 * btn
 * ------------------------
*/
.btn,
.btn-default,
.long-btn {
  border-radius: 5px !important;
  border: 1px solid var(--border-color) !important;
  background: var(--bg-color2) !important;
  outline: none !important;
}
.btn-primary {
  background: var(--color-1) !important;
  border-color: var(--color-1) !important;
  color: #fff;
}

.btn:hover,
.long-btn:hover {
  background: var(--color-1-0-b) !important;
  color: var(--color-1);
  border-color: var(--color-1) !important;
}

.btn:focus,
.long-btn:focus {
  outline: none !important;
}
.btn {
  margin: 2px;
  margin-right: 5px !important;
}
.btn:last-of-type {
  margin-right: 0;
}
.dropdown-toggle::after {
  font-size: 14px;
}
.dropdown-toggle:hover::after {
  color: var(--color-1);
}

/*
 * ------------------------
 * select
 * ------------------------
 */
select {
  border-radius: 5px !important;
  border: 1px solid var(--border-color) !important;
  padding: 6px !important;
}
option {
  background: var(--bg-color);
}
/*
 * ------------------------
 * textarea
 * ------------------------
 */
textarea {
  outline: none;
  padding: 5px;
  border-radius: 5px;
  border-color: var(--border-color);
  background: var(--bg-color) !important;
  color: var(--text-color) !important;
  font-family: "PingFang SC", "Helvetica Neue", Helvetica, "Microsoft YaHei", Arial, sans-serif !important;
}
/*
 * ------------------------
 * input
 * ------------------------
*/
html input,
input {
  border-radius: 5px !important;
  line-height: 1.2;
  position: relative;
  padding: 0 6px;
  outline: none !important;
  border: 1px solid var(--border-color);

}
html input:focus,
html textarea:focus,
html input[type="number"]:focus,
html input[type="search"]:focus,
html input[type="text"]:focus {
  border-color: var(--color-1) !important;
  box-shadow: none !important;
  outline: none !important;
}
input::placeholder {
  font-size: 14px;
  color: var(--text-grey) !important;
}
/*input checkbox*/
input[type="checkbox"],
input[type="radio"] {
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  -ms-appearance: none;
  width: 14px !important;
  height: 14px !important;
  padding: 0 !important;
  box-sizing: border-box;
  border: 1px solid var(--border-color) !important;
  border-radius: 3px !important;
  list-style: none;
  background: transparent !important;
  margin-right: 10px !important;
  margin-bottom: -2px !important;
}

input[type="checkbox"]:checked,
input[type="radio"]:checked {
  background: var(--color-1) !important;
  border-color: transparent !important;
}
input[type="checkbox"]:checked::after {
  content: "";
  display: block;
  width: 5px;
  height: 9px;
  background: transparent;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  position: absolute;
  box-sizing: border-box;
  bottom: 2.5px;
  left: 3.5px;
  transform: rotate(40deg);
  -webkit-transform: rotate(40deg);
  -ms-transform: rotate(40deg);
}

input[type="radio"] {
  border-radius: 50% !important;
  -webkit-border-radius: 50% !important;
  -moz-border-radius: 50% !important;
  border: 1px solid var(--border-color) !important;
}

input[type="radio"]:checked::after {
  content: "";
  display: block;
  width: 5px;
  height: 5px;
  box-sizing: border-box;
  margin: 3.5px auto;
  background: #fff;
  border-radius: 50%;
  -webkit-border-radius: 50%;
  -moz-border-radius: 50%;
}

span.md-comment {
  color: var(--md-char-color);
  opacity: 1;
}
.md-image-btn.selected, .md-image-btn:hover {
  background: var(--color-1);
}
#write pre.md-meta-block:empty:before {
  color: var(--text-code);
}

/* #write */
#write {
  width: 100%;
  margin: 0 auto;
  padding: 0 96px 32px;
  overflow-x: hidden;
  scroll-behavior: smooth;
}

#typora-sidebar {
  border-right-color: var(--border-color);
}

/*
 * ------------------------
 * typora-source
 * ------------------------
*/
#typora-source .CodeMirror-sizer {
  padding-right: 0 !important;
}
#typora-source .CodeMirror-lines {
  width: 100%;
  max-width: 1400px;
  margin: 0 auto;
  padding: 32px 100px;
  box-sizing: border-box;
}
#typora-source .CodeMirror-lines pre {
  font-size: 16px !important;
  border: none !important;
  padding: 8px 16px !important;
  background: var(--bg-color) !important;
}
#typora-source .CodeMirror-activeline pre {
  background: var(--bg-color2) !important;
  border-radius: 6px;
}
#typora-source .CodeMirror-activeline .CodeMirror-linebackground {
  background: transparent !important;
}
#typora-source .CodeMirror-lines .cm-header {
  color: var(--color-2);
}
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor {
  border-left: 3px solid var(--color-2);
}
.cm-s-typora-default .cm-header, .cm-s-typora-default .cm-property,
.cm-s-typora-default .cm-link {
  color: var(--color-2);
}
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment, .cm-overlay {
  color: var(--md-char-color);
}
.cm-s-typora-default .cm-string {
  color: var(--color-1);
}
.cm-s-typora-default .cm-code, .cm-s-typora-default .cm-comment {
  color: var(--text-code);
}
.cm-s-typora-default .cm-tag {
  color: #e31570;
}

.cm-attribute {
  color: var(--color-2);
}

/*
 * ------------------------
 * #toc-dropmenu
 * ------------------------
*/
#toc-dropmenu {
  border-top-left-radius: 8px;
  border-bottom-left-radius: 8px;
  top: calc(var(--title-bar-height) - 2px) !important;
  right: 18px;
}
#toc-dropmenu #pin-outline-btn {
  display: inline-block;
  top: 10px;
}
#toc-dropmenu .divider {
  margin-bottom: 0;
}
/*
 * ------------------------
 * sidebar
 * toc-content
 * ------------------------
*/
.outline-content {
  padding: 16px;
  font-size: 14px !important;
}
.outline-content li {
  position: relative;
  z-index: 30;
  line-height: 1.3 !important;
  margin-bottom: 0;
}

.outline-content li::before {
  content: '';
  width: 1px;
  height: calc(100% + 5px);
  position: absolute;
  z-index: 30;
  left: 0;
  top: 0;
  background: var(--border-color);
}
.outline-content > li:first-of-type::before {
  top: 0;
}
.outline-content li a {
  font-size: 14px !important;
}
.outline-content li ul {
  margin-left: 19px;
  position: relative;
  z-index: 48;
}

.outline-content ul li::before {
  content: '';
  width: 1px;
  height: calc(100% + 11px);
  top: -11px;
}
.outline-content ul > li:last-of-type::before {
  content: '';
  width: 1px;
  height: 11px;
  top: -11px;
}
.outline-content li .outline-item {
  margin: 0 0 3px 6px;
  padding: 4px 8px;
  position: relative;
  z-index: 50;
  border-radius: 5px;
  border: 1px solid transparent;
}
.outline-content li .outline-item:hover,
.outline-content li .outline-item-active {
  z-index: 70;
}
.outline-content .outline-label {
  margin: 0;
  padding: 0;
  position: relative;
  z-index: 70;
  background: var(--bg-color);
  text-decoration: none;
}

.outline-content li .outline-item::before {
  content: '';
  width: 12px;
  height: calc(50% + 12px);
  position: absolute;
  z-index: 38;
  left: -7px;
  top: -12px;
  background: transparent;
  border-left: 1px solid var(--border-color);
  border-bottom: 1px solid var(--border-color);
}

.outline-content > li:first-of-type > .outline-item::before {
  top: calc(50% - 1px) !important;
  border-top: 1px solid var(--border-color);
  border-bottom: none;
  border-top-left-radius: 3px;
  -webkit-border-top-left-radius: 3px;
  border-bottom-left-radius: 0;
  -webkit-border-bottom-left-radius: 0;
}
.outline-content > li:first-of-type > .outline-item::after {
  content: '';
  width: 1px;
  height: 100%;
  position: absolute;
  z-index: 35;
  left: -7px;
  top: -2px;
  background: var(--bg-color);
}
.outline-content > li:last-of-type > .outline-item::before,
.outline-content > li ul > li:last-of-type > .outline-item::before {
  z-index: 90;
  background: transparent;
  border-left: 1px solid var(--border-color);
  border-top: 1px solid var(--border-color);
  border-top: none !important;
  border-bottom-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  border-top-left-radius: 0;
  -webkit-border-top-left-radius: 0;
}

.outline-content > li:only-of-type > .outline-item::before,
.outline-content > li:last-of-type::before {
  display: none;
}
.outline-content > li:only-of-type {
  margin-left: -6px;
}

.outline-expander {
  padding-left: 0;
  width: auto;
  height: 8px;
  background: transparent;
}

.outline-expander:before {
  font-size: 10px;
  padding: 0 3px 0 2px;
  margin-top: -2px;
  margin-left: -2px;
  background: transparent;
}

.outline-item:hover,
.outline-item:hover > .outline-label,
.outline-item:hover > .outline-expander:before,
.outline-item:hover > .outline-expander,
.outline-item-active,
.outline-item-active > span,
.outline-item-active > .outline-expander:before {
  background: var(--bg-color2) !important;
  color: var(--color-1) !important;
}
.outline-item:hover {
  z-index: 70;
}
.outline-item:hover::before,
.outline-item-active::before {
  width: 6px !important;
}
.outline-item-active .outline-expander {
  font-weight: bold !important;
}

/*ty-on-outline-filter(catalog search style)*/
.ty-on-outline-filter .outline-content li::before,
.ty-on-outline-filter .outline-content .outline-item::before,
.ty-on-outline-filter .outline-content .outline-item::after {
  display: none;
}
.ty-on-outline-filter .outline-content > li > ul,
.ty-on-outline-filter .outline-content .outline-item {
  margin-left: 0;
}

/*
 * --------------------------
 * file-library-list
 * file-library-search-result
 * --------------------------
*/
#file-library-list,
#file-library-search-result {
  padding: 12px;
}
/*ty-search-item*/
#file-library-list .file-list-item,
#file-library-search-result .ty-search-item {
  margin-bottom: 8px;
  border: 1px solid transparent;
  border-bottom-color: var(--border-color);
}
#file-library-list .file-list-item {
  padding-left: 12px;
  padding-right: 12px;
}

#file-library-list .file-list-item.active,
#file-library-search-result .ty-search-item.active {
  border-radius: 5px;
  border: 1px solid var(--color-1);
}
#file-library-list .file-list-item.active {
  padding: 6px 12px;
}
#file-library-search-result .ty-search-item.active {
  padding: 6px 12px 6px 0;
}
#file-library-list .file-list-item:first-of-type.active,
#file-library-search-result .ty-search-item:first-of-type.active {
  margin-top: 0;
}
#file-library-list .file-list-item:hover,
#file-library-search-result .ty-search-item:hover {
  border-radius: 5px;
  background: var(--bg-color2);
  border-color: var(--border-color);
}
#file-library-list .file-list-item:hover {
  color: var(--color-1);
}
#file-library-search-result .ty-search-item.active {
  color: var(--text-color);
}
#file-library-search-result .ty-search-item.active .ty-search-item-line {
  white-space: normal;
  word-break: break-word;
}
.file-list-item-time {
  margin-right: 0;
  padding-right: 0;
}
.file-list-item-count {
  margin-right: 0;
  padding: 0 6px;
  border-radius: 3px;
}
#file-library-search-result .ty-search-item.active .file-list-item-count {
  padding-right: 0;
}
#sidebar-loading-template {
  padding: 8px;
  border-radius: 5px;
  margin-bottom: 5px;
  display: none;
}
.ty-file-search-match-text {
  background-color: var(--color-2-0-c);
}
/*
 * ------------------------
 * file-library tree
 * ------------------------
*/
#file-library-tree {
  padding-top: 8px;
  padding-left: 12px;
  padding-right: 12px;
  box-sizing: border-box;
}
.sidebar-tab-btn {
  font-size: 16px !important;
  line-height: 20px !important;
  vertical-align: text-top;
  margin-top: 12px !important;
  color: var(--title-color);
}
.sidebar-tab-btn:hover {
  color: var(--color-1);
}
.ty-sidebar-search-panel .searchpanel-search-option-btn {
  top: 8px;
}
.file-tree-node {
  position: relative;
  padding-left: 0;
  margin-left: 0;
}

.file-library-node .file-node-children {
  margin-left: 12px;
}

.file-node-expanded > .file-node-children {
  margin-left: 28px;
}

.file-tree-node.active > .file-node-background {
  border-radius: 5px;
  border: none;
}
.fa-folder:before,
.fa-folder:after,
.fa-caret-right,
.fa-caret-down {
  color: var(--text-grey);
}

/*
 * ------------------------
 * md-notification-container
 * ------------------------
*/
#md-notification {
  position: relative;
}
#md-notification::before {
  font-size: 18px;
  top: 13px;
}

#md-notification p {
  margin: auto;
  font-size: 14px;
}
#md-notification > p {
  margin-top: 10px;
}

#md-notification-content span {
  margin-bottom: 4px;
  margin-left: 8px;
}
.typora-search-spinner > div {
  background: var(--color-1);
}

/*
 * ------------------------
 * TOC md-toc
 * ------------------------
*/
.md-toc {
  font-size: 14px;
  margin: 20px 0 0 0;
  background: var(--bg-color2);
}
.md-toc-content {
  padding: 20px 30px;
  margin: 16px 0;
}
.md-toc-content .md-toc-item {
  margin-bottom: 6px;
}
#write div.md-toc-tooltip {
  position: relative;
  margin: 12px 0 6px;
}
#write div.md-toc-tooltip .md-delete-toc {
  padding: 0 12px;
  background: var(--bg-color);
}
#write div.md-toc-tooltip .md-delete-toc:hover {
  color: var(--color-1);
  background: var(--bg-color2);
}

/*
 * ------------------------
 * code colors
 * ------------------------
*/
.cm-s-inner {
  background-color: transparent !important;
  color: var(--text-code);
}
.cm-s-inner .CodeMirror-gutters {
  background: transparent !important;
  color: var(--text-code);
  border: none;
}
.cm-s-inner .CodeMirror-guttermarker,
.cm-s-inner .CodeMirror-guttermarker-subtle,
.cm-s-inner .CodeMirror-linenumber {
  color: var(--md-char-color);
}
.cm-s-inner .CodeMirror-cursor {
  border-left: 1px solid var(--border-color);
}
.cm-s-inner div.CodeMirror-selected,
.cm-s-inner.CodeMirror-focused div.CodeMirror-selected,
.cm-s-inner .CodeMirror-line::selection,
.cm-s-inner .CodeMirror-line > span::selection,
.cm-s-inner .CodeMirror-line > span > span::selection,
.cm-s-inner .CodeMirror-line::-moz-selection,
.cm-s-inner .CodeMirror-line > span::-moz-selection,
.cm-s-inner .CodeMirror-line > span > span::-moz-selection {
  background: var(--color-2-0-c);
}
.cm-s-inner .CodeMirror-activeline-background { background: transparent; }
.cm-s-inner .cm-keyword { color: #bb59fd; }
.cm-s-inner .cm-operator { color: #6ac0df; }
.cm-s-inner .cm-variable { color: #f4395dff; }
.cm-s-inner .cm-variable-2 { color: #e2785f; }
.cm-s-inner .cm-variable-3 { color: #0d50cc; }
.cm-s-inner .cm-builtin { color: #f61d78; }
.cm-s-inner .cm-atom { color: #fa5336; }
.cm-s-inner .cm-number { color: #f59102; }
.cm-s-inner .cm-def { color: #4087fd; }
.cm-s-inner .cm-string { color: #00a866; }
.cm-s-inner .cm-string-2 { color: #01b001; }
.cm-s-inner .cm-comment,
.cm-s-inner .cm-meta { color: var(--md-char-color); }
.cm-s-inner .cm-attribute { color: #c08b01; }
.cm-s-inner .cm-property { color: #1b9f72; }
.cm-s-inner .cm-qualifier { color: #dc7b45; }
.cm-s-inner .cm-tag { color: #e32e73; }
.cm-s-inner .cm-tag.cm-bracket {color: #01a2da;}
.cm-s-inner .cm-error {
  color: var(--bg-color);
  background-color: #ee3658;
}
.cm-s-inner .CodeMirror-matchingbracket {
  text-decoration: underline;
  color: var(--text-code) !important;
}
/* apply to code fences with plan text*/
.md-fences {
  background-color: var(--bg-color2);
  color: var(--text-grey);
}
.md-fences .code-tooltip {
  background-color: var(--bg-color2);
  color: var(--text-color);
  border-radius: 5px;
  z-index: 50;
  padding: 0;
  bottom: -2.9em;
}
.md-fences .code-tooltip input,
.md-fences .code-tooltip span {
  padding: 3px;
  border-radius: 5px;
}
/*
 * ------------------------
 * export html
 * ------------------------
*/
body.typora-export {
  padding-left: 0;
  padding-right: 0;
}
.typora-export-content,
.typora-export-show-outline .typora-export-content{
  width: 100vw;
  max-width: 1920px;
  height: 100vh;
  margin: 0 auto;
}
.typora-export-sidebar {
  margin-right: 0;
  margin-top: 0;
  border-right: 1px solid var(--border-color);
}
.typora-export-sidebar .outline-content {
  padding-top: 18px;
}
.typora-export-sidebar .outline-content li ul {
  margin-left: 20px;
  z-index: 55;
}

.typora-export-sidebar .outline-content .outline-item-active > .outline-item {
  position: relative;
  z-index: 70;
}

.typora-export .outline-content li a {
  font-weight: normal;
  padding: 2px 0;
}

.typora-export-sidebar .outline-content li,
.typora-export-sidebar .outline-content li > .outline-item {
  background: var(--bg-color) !important;
  color: var(--text-color) !important;
}

.typora-export-sidebar .outline-content ul li::before,
.typora-export-sidebar .outline-content ul > li:last-of-type::before {
  top: 0;
}
.typora-export .outline-content li .outline-item::before {
  height: calc(50% + 13px);
  top: -13px;
}
.typora-export-no-collapse-outline .outline-content li .outline-item::before {
  height: calc(50% + 10px);
  top: -10px;
}

.typora-export .outline-expander::before {
  content: "";
  width: 7px;
  height: 7px;
  background: transparent;
  box-sizing: border-box;
  border-top: 1px solid var(--text-color);
  border-right: 1px solid var(--text-color);
  transform: rotate(45deg);
  -webkit-transform: rotate(45deg);
  -ms-transform: rotate(45deg);
  margin-right: 5px;
  margin-top: 1px;
}
.typora-export .outline-expander:hover::before {
  content: "";
  width: 7px;
  height: 7px;
  background: transparent;
  box-sizing: border-box;
  border-top: 1px solid var(--text-color);
  border-right: 1px solid var(--text-color);
  transform: rotate(135deg);
  -webkit-transform: rotate(135deg);
  -ms-transform: rotate(135deg);
  margin-right: 5px;
  margin-left: 2px;
  margin-top: -2px;
}
.typora-export .outline-item-open > .outline-item > .outline-expander::before {
  content: "";
  width: 7px;
  height: 7px;
  background: transparent;
  box-sizing: border-box;
  border-top: 1px solid var(--text-color);
  border-right: 1px solid var(--text-color);
  transform: rotate(135deg);
  -webkit-transform: rotate(135deg);
  -ms-transform: rotate(135deg);
  margin-right: 5px;
  margin-left: 2px;
  margin-top: -2px;
}

.typora-export-sidebar .outline-content li .outline-item:hover,
.typora-export-sidebar .outline-content .outline-item-active > .outline-item,
.typora-export-sidebar .outline-content .outline-item-active > .outline-item > .outline-label {
  background: var(--bg-color2) !important;
  color: var(--color-1) !important;
}
.typora-export-sidebar .outline-content li > .outline-item:hover > .outline-expander::before {
  border-color: var(--color-1);
}

.typora-export-sidebar .outline-item-active > .outline-item::before {
  width: 6px;
}
.typora-export .outline-item:hover {
  margin-right: 0;
}
.typora-export-sidebar .outline-item-active::before {
  width: 1px !important;
}

.typora-export-sidebar .outline-content .outline-item-active > .outline-item > .outline-expander::before {
  border-width: 2px !important;
  border-color: var(--color-1);
}

.typora-export-no-collapse-outline .outline-expander {
  display: none;
}

/**
 * --------------------------------------
 * unibody-window
 * Control UI on Windows/Linux (optional)
 * --------------------------------------
*/
body.unibody-window,
body.typora-export {
  letter-spacing: 1px;
}
.unibody-window .outline-content li .outline-item::before {
  height: calc(50% + 13px);
  top: -13px;
}
.unibody-window #write ul,
.typora-export #write ul {
  padding-left: 34px;
}

.unibody-window #write ol,
.typora-export #write ol {
  padding-left: 36px;
}
.unibody-window #write ul ul,
.unibody-window #write ol ol,
.unibody-window #write ul > li > ol,
.unibody-window #write ol > li > ul,
.typora-export #write ul ul,
.typora-export #write ol ol,
.typora-export #write ul > li > ol,
.typora-export #write ol > li > ul {
  margin-left: 0;
}

.unibody-window #write ul > li > p,
.typora-export #write ul > li > p {
  margin: 0;
}
.unibody-window #write ol > li > p,
.typora-export #write ol > li > p {
  margin: 0 0 0 -2px;
}

.unibody-window #write ul > .task-list-item > input,
.typora-export #write ul > .task-list-item > input {
  margin-left: -22px;
}

.unibody-window #megamenu-menu-sidebar {
  --bg-color: #1b1b1f;
  --bg-color2: rgb(40, 42, 50);
  --border-color: rgb(60, 62, 70);
  overflow: hidden;
}
#megamenu-menu-sidebar .megamenu-menu-list {
  border: none;
}

#recent-file-panel-search-input,
.megamenu-menu-panel .btn,
.dropdown-menu li a {
  border-radius: 5px !important;
}
.unibody-window .long-btn {
  border-radius: 8px !important;
}

/* .dropdown-menu */
.dropdown-menu {
  padding: 6px !important;
  border-radius: 8px !important;
  border: 1px solid var(--border-color);
}
.dropdown-menu li {
  border-radius: 5px !important;
}
.ty-spell-check-panel-item {
  border-radius: 5px;
  margin-bottom: 4px;
}
.btn-split-group .dropdown-menu {
  margin-top: 0;
}
.input-group-content .dropdown-menu li:hover {
  border-radius: 5px;
  background: var(--bg-color2);
}
.dropdown-menu li:hover a {
  color: var(--color-1);
}
.dropdown-menu li a {
  font-size: 14px;
}
.dropdown-menu table th,
.dropdown-menu table td {
  padding: 5px !important;
}
#sidebar-files-menu li:hover a {
  color: var(--color-1) !important;
}

#close-sidebar-menu-btn:hover {
  color: var(--color-1);
}

.unibody-window .long-btn:hover span,
.unibody-window .long-btn:hover i,
.megamenu-menu-panel .btn:hover,
#megamenu-menu-header-title:hover,
.toolbar-icon:hover,
#megamenu-back-btn:hover i {
  color: var(--color-1) !important;
  text-decoration: none;
}
.unibody-window .long-btn:hover,
.megamenu-menu-panel .btn:hover,
#megamenu-back-btn:hover {
  border-color: var(--color-1);
  background: var(--bg-color2);
}
#w-traffic-lights span {
  background: transparent !important;
  border-radius: 0 !important;
  border: none !important;
}
#w-traffic-lights span:hover {
  background: var(--color-1-0-b) !important;
}

#w-traffic-lights #w-close:hover {
  background: var(--color-5) !important;
  color: #fff !important;
}
#top-titlebar .btn {
  margin: 0 !important;
}

/* .megamenu-men */
.megamenu-menu-panel .btn {
  padding: 6px 12px;
}
.megamenu-content {
  padding-right: 30px;
}
#open-theme-folder-btn {
  margin-top: 48px;

}
.megamenu-menu {
  background: var(--bg-color);
}
.megamenu-menu-header {
  border-color: var(--bg-color2);
}
#megamenu-back-btn {
  border-radius: 5px;
  border-color: var(--border-color);
  margin-left: 10px;
}
#megamenu-menu-list {
  padding: 0 8px;
}

.megamenu-menu-list li {
  margin-top: 6px;
}

.megamenu-menu-list li a {
  font-size: 16px;
  border-radius: 5px;
  display: block;
  border: 1px solid transparent;
  line-height: 34px;
}

.megamenu-menu-list li a .fa {
  font-size: 18px;
  line-height: 38px;
  display: inline-block;
  margin-left: 0;
  opacity: 1;
}
.megamenu-menu-list li #m-saved .fa {
  font-size: 20px;
  line-height: 36px !important;
  color: var(--color-2);
}

.megamenu-menu-list li a:hover,
.megamenu-menu-list li a.active:hover {
  color: var(--color-1) !important;
  background: var(--bg-color2) !important;
  border: 1px solid var(--color-1);
}
.megamenu-menu-list li a:hover,
.megamenu-menu-list li a.active {
  background: var(--bg-color2);
}
.megamenu-menu-list li a.active {
  color: var(--color-1) !important;
}
@media (max-width: 530px) {
  #megamenu-back-btn {
    margin-left: 0;
  }
  .megamenu-menu-list li a i {
    margin-left: 10px;
  }
}
#recent-file-panel-action-btn-container {
  margin-right: 0;
}
#recent-file-panel-search-input {
  width: calc(100% - 55px);
}

#megamenu-clear-recet-documents {
  background: var(--bg-color2);
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 14px;
}
#megamenu-clear-recet-documents:hover {
  color: var(--color-1);
}

.ty-show-search #info-panel-tab-search .info-panel-tab-border,
.ty-show-search #info-panel-tab-search .info-panel-tab-border,
.active-tab-files #info-panel-tab-file .info-panel-tab-border,
.active-tab-outline #info-panel-tab-outline .info-panel-tab-border {
  border-radius: 2px;
  height: 3px;
}

#file-library-search-input {
  border-radius: 0 !important;
  top: 4px;
}
#close-outline-filter-btn {
  top: 8px;
  border: none !important;
  background: transparent !important;
}
.unibody-window .sidebar-content {
  top: 58px;
}
.native-window #file-library-search-input,
.unibody-window #file-library-search-input {
  border-radius: 5px !important;
  height: 28px;
}

.megamenu-menu-panel {
  scrollbar-width: none;
}
#theme-preview-grid {
  max-width: 100%;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
  justify-content: space-between;
  grid-gap: 32px;
}
@media (max-width: 1200px) {
  #theme-preview-grid {
    grid-template-columns: 1fr 1fr 1fr;
  }
}
.theme-preview-div {
  border: 3px solid var(--border-color);
  padding: 4px;
  box-sizing: border-box;
  margin: 0;
  overflow: hidden;
  color: var(--color-1);
  border-radius: 8px;
}
.theme-preview-div:hover {
  border-color: var(--color-1);
}
.theme-preview-div.active {
  border-color: var(--color-2);
}
.theme-preview-div .fa {
  color: var(--color-2);
}
.theme-preview-content {
  width: 100%;
  height: 100%;
  border-radius: 5px;
}
#outline-btn:hover {
  color: var(--color-1) !important;
}

/* context menu */
.context-menu {
  border-radius: 5px !important;
  padding: 5px !important;
  border: 1px solid var(--border-color);
}
.context-menu li a {
  display: inline-block;
  width: 100%;
  border-radius: 5px !important;
}
.context-menu > .active a {
  color: var(--color-1) !important;
}
.tb43e-d6bd-dbe4y {
  background: var(--bg-color2);
}

/*
 * ------------------------
 * UI-controls
 * dialogs
 * ------------------------
*/
#md-searchpanel input,
#md-replace-type-label,
#search-panel-replace-btn,
.modal-content,
.modal-dialog,
.modal-title,
.modal-content {
  border-radius: 5px;
}

.modal-content {
  padding: 6px;
}
#sidebar-files-menu li a {
  padding-top: 5px;
  padding-bottom: 5px;
}
#sidebar-files-menu .file-action-item {
  line-height: 30px;
}

/* footer */
#footer-word-count-info {
  border-radius: 5px;
  padding: 6px;
  border: 1px solid var(--border-color);
}
#footer-word-count-info table {
  border-radius: 0;
}
#footer-word-count-info table tr > td:first-of-type {
  border-top-left-radius: 5px;
  border-bottom-left-radius: 5px;
}
#footer-word-count-info table tr > td:last-of-type {
  border-top-right-radius: 5px;
  border-bottom-right-radius: 5px;
}

/**
 * ---------------------------------
 * Control UI on Mac (optional)
 * ---------------------------------
*/
#typora-quick-open {
  background-color: var(--bg-color);
  border: 1px solid var(--border-color);
  padding: 12px;
  border-radius: 8px;
}
.typora-quick-open-item,
.md-hover-tip .code-tooltip-content {
  border-radius: 5px;
}
.code-tooltip.md-hover-tip,
.md-hover-tip .code-tooltip-content,
.md-arrow::after {
  border-bottom-color: var(--color-1) !important;
  background: var(--color-1) !important;
  box-shadow: 0 1px 4px var(--color-1) !important;
}
.md-hover-tip .md-arrow::after {
  box-shadow: none !important;
}
.md-hover-tip .code-tooltip-content:hover a {
  color: var(--color-2) !important;
}
/*
 * ------------------------
 * #root
 * .ty-preferences
 * ------------------------
*/
.sidebar {
  position: relative;
}
.sidebar:after {
  content: '';
  display: block;
  position: absolute;
  width: 1px;
  height: 100%;
  right: -24px;
  top: 0;
  background: var(--border-color);
}

.ty-preferences a {
  font-size: 12px !important;
  color: var(--color-1);
  text-decoration: none;
}
.ty-preferences a:hover {
  text-decoration: underline;
  color: var(--color-2);
}

.export-item.active,
.export-items-list-control {
  border-radius: 3px !important;
}
.nav-group-item {
  border-radius: 5px !important;
}
.input-group table,
.export-detail {
  border-radius: 5px !important;
}
.export-detail .file-input input {
  padding-left: 8px !important;
  height: 30px !important;
  border-color: var(--border-color) !important;
}
.search-input {
  padding: 6px 12px !important;
  border-color: var(--border-color) !important;
}

.label-input-group div {
  border: none !important;
  margin: 0 !important;
  padding: 0 !important;
}
.label-input-group div pre {
  border-radius: 5px !important;
  font-size: 14px !important;
}
.input-group-content {
  border-radius: 5px !important;
}
.input-group-content table {
  margin-top: 4px;
}
.label-hint svg {
  margin-right: 3px;
}
.export-detail .input-group-content > .row {
  margin-right: 16px;
}
.export-detail,
.export-item.active {
  color: var(--text-color) !important;
}
.export-item.active {
  color: var(--color-1) !important;
}

#md-notification {
  top: -6px;
}
.md-show-hint::after {
  background: var(--color-1-0-b) !important;
  border-radius: 3px;
  box-shadow: 0 0 5px var(--color-1) !important;
}

/*
 * ------------------------
 * diagram
 * ------------------------
*/
.md-diagram-panel {
  width: 100% !important;
  max-width: 100% !important;
  border-radius: 8px;
  margin-top: 20px;
  border-color: var(--border-color) !important;
  background: var(--bg-color2) !important;
}
.md-diagram {
  width: 100% !important;
  max-width: 100% !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
}
.md-diagram-panel > svg {
  width: 100% !important;
  max-width: 100% !important;
}

/*
 * ------------------------
 * @media print
 * ------------------------
*/
@media print {
  table,
  pre {
    page-break-inside: avoid;
  }
  pre {
    word-wrap: break-word;
  }
}


</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><h1><a name="linux下嵌入式qt开发学习总结报告" class="md-header-anchor"></a><span>Linux下嵌入式Qt开发学习总结报告</span></h1><h2><a name="第一章基础" class="md-header-anchor"></a><span>第一章：基础</span></h2><h3><a name="11-gui程序原理分析" class="md-header-anchor"></a><span>1.1 GUI程序原理分析</span></h3><hr /><p><span>图形界面应用程序的特点Graphic Use Interface</span></p><ul><li><span>是一种</span><strong><span>基于消息驱动模型</span></strong><span>的可执行程序</span></li><li><span>程序的执行</span><strong><span>依赖于用户的交互过程</span></strong></li><li><span>程序执行过程中</span><strong><span>实时响应用户操作</span></strong></li><li><span>一般情况下</span><strong><span>程序执行后不会主动退出</span></strong></li></ul><hr /><p><strong><span>图形界面应用程序的运行模式：</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">main</span>() </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">定义主窗口</span> <span class="cm-variable">→</span> <span class="cm-variable">创建主窗口</span> <span class="cm-variable">→</span> <span class="cm-variable">创建主窗口中的元素</span> <span class="cm-variable">→</span> <span class="cm-variable">显示主窗口</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span>(<span class="cm-number">1</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">→</span> <span class="cm-variable">进入消息循环</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><hr /><p><span>图形界面应用程序的消息处理模型：</span></p><p><span>用户操作，操作系统会检测到事件，操作系统内核发送系统消息到应用程序，应用程序中调用消息处理函数</span></p><hr /><p><strong><span>图形界面应用程序适用于：</span></strong></p><ul><li><span>多任务的场合</span></li><li><span>强用户交互的场合</span></li><li><span>非专业计算机用户</span></li></ul><p><span>图形界面应用程序是当代计算机系统中的主要程序类型</span></p><hr /><p><span>命令行应用程序与图形界面应用程序区别</span></p><figure><table><thead><tr><th><span>命令行应用程序</span></th><th><span>图形界面应用程序区别</span></th></tr></thead><tbody><tr><td><span>基于顺序执行结构</span></td><td><span>基于消息驱动模型</span></td></tr><tr><td><span>弱交互执行</span></td><td><span>强交互执行</span></td></tr><tr><td><span>由用户触发运行</span></td><td><span>由用户触发运行</span></td></tr><tr><td><span>主动结束</span></td><td><span>由用户触发结束</span></td></tr></tbody></table></figure><hr /><p><span>现代操作系统提供原生SDK支持GUI程序开发</span></p><p><span>不同操作系统上的GUI SDK不同，但是GUI开发原理相同</span></p><p><mark><span>GUI程序开发原理</span></mark></p><ul><li><span>GUI程序正在运行时会</span><strong><span>创建一个消息队列</span></strong></li><li><span>系统内核将</span><strong><span>用户操作</span></strong><span>翻译成为对应的</span><strong><span>程序消息</span></strong></li><li><span>程序在运行过程中需要</span><strong><span>实时处理队列中的消息</span></strong></li><li><span>当队列中没有消息时，程序将处于</span><strong><span>停滞状态</span></strong></li></ul><blockquote><p><span>用户操作 → 操作系统内核 → 程序消息 → GUI应用程序</span></p></blockquote><hr /><p><span>GUI 程序开发</span></p><ol><li><span>在代码中用程序创建窗口及窗口元素</span></li><li><span>在消息处理函数中根据程序消息做出不同响应</span></li></ol><blockquote><p><strong><span>经典GUI程序开发模式：可视化界面开发  +  消息映射</span></strong></p><ol><li><span>通过所见即所得的方式“画”出界面；开发环境自动生成对应的程序代码</span></li><li><span>程序中将具体消息映射到指定函数；当消息触发时，函数被调用</span></li></ol></blockquote><h3><a name="12-qt的诞生和本质" class="md-header-anchor"></a><span>1.2 Qt的诞生和本质</span></h3><hr /><p><span>GUI用户界面是由固定的窗口元素所构成的</span></p><blockquote><p><span>用户界面元素：主窗口、菜单栏、工具栏、标签、文本框、按钮等等</span></p></blockquote><hr /><p><span>操作系统提供了创建用户界面元素所需的函数，各种函数依次调用，从而创建出界面元素</span></p><p><span>但是操作系统提供的</span><strong><span>原生函数无法直接映射到界面元素</span></strong></p><p><span>因此使用</span><strong><span>面向对象</span></strong><span>的C++语言，面向对象方法学视角下</span></p><ul><li><p><span>将</span><strong><span>界面元素</span></strong><span>定义为</span><strong><span>类</span></strong></p></li><li><p><span>通过</span><strong><span>抽象</span></strong><span>和</span><strong><span>封装</span></strong><span>隐藏界面元素的细节</span></p></li><li><p><span>所有的</span><strong><span>界面元素</span></strong><span>都可以看作</span><strong><span>实际的对象</span></strong></p></li><li><p><span>GUI用户界面是</span><strong><span>由各个不同的对象组成</span></strong></p></li><li><p><span>应用程序创建过程就是</span><strong><span>组合不同界面元素对象</span></strong><span>的过程</span></p><blockquote><p><span>计算机图形框架的C++解决方案：Qt，MFC（Window专用）</span></p></blockquote></li></ul><hr /><p><mark><strong><span>Qt的本质</span></strong></mark></p><ul><li><span>利用</span><strong><span>面向对象</span></strong><span>方法学开发的一套</span><strong><span>GUI组件库</span></strong></li><li><span>将不同操作系统的</span><strong><span>GUI细节封装于类的内部</span></strong></li><li><span>提供一套</span><strong><span>跨平台的类</span></strong><span>用于开发GUI抽象</span></li><li><span>遵循经典的GUI应用程序开发模式：</span><strong><span>可视化界面开发  +  消息映射</span></strong></li></ul><hr /><p><span>命令行编译Qt源程序（只有 .cpp .h 文件）步骤</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">1.</span> <span class="cm-variable">qmake</span> <span class="cm-operator">-</span><span class="cm-variable">project</span> <span class="cm-comment">// 根据当前目录中的源码（.cpp）生成工程文件(.pro)</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">2.</span> <span class="cm-variable">qmake</span> &nbsp; <span class="cm-comment">// 根据工程文件生成makefile文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">3.</span> <span class="cm-variable">make</span> &nbsp; <span class="cm-comment">// 根据makefile进行编译，生成.exe和.o</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><strong><span>Qt Creator是一套可视化的集成开发环境</span></strong><span>，可以打开.pro文件，以</span><strong><span>工程项目的方式</span></strong><span>对源码进行管理</span></p><p><mark><span>Creator工程构成</span></mark></p><ul><li><span>.pro  项目描述文件</span></li><li><span>.pro.user  用户配置描述文件</span></li><li><span>.h .cpp  源码</span></li><li><span>.ui  界面描述文件</span></li><li><span>资源文件（图片、音频等）</span></li></ul><p><span>在.pro文件中</span></p><figure><table><thead><tr><th><span>#</span></th><th><span>注释起始符</span></th></tr></thead><tbody><tr><td><span>QT</span></td><td><span>模块声明</span></td></tr><tr><td><span>TARGET</span></td><td><span>可执行文件名</span></td></tr><tr><td><span>TEMPLATE</span></td><td><span>程序模板声明</span></td></tr><tr><td><span>SOURCES</span></td><td><span>源码文件声明</span></td></tr><tr><td><span>HEADERS</span></td><td><span>头文件声明</span></td></tr><tr><td><span>FORMS</span></td><td><span>界面文件声明</span></td></tr><tr><td><span>RC_FILE</span></td><td><span>资源文件声明</span></td></tr></tbody></table></figure><p><span>.pro本质就是Qt中与平台无关的Makefile文件</span></p><p><span>.pro中的高级变量</span></p><figure><table><thead><tr><th><span>INCLUDEPATH</span></th><th><span>头文件搜索路径</span></th></tr></thead><tbody><tr><td><span>CONFIG</span></td><td><span>设定项目的</span><strong><span>配置信息</span></strong><span>和</span><strong><span>编译选项</span></strong></td></tr><tr><td><span>LIBS</span></td><td><span>添加第三方库文件</span></td></tr><tr><td><span>DEFINES</span></td><td><span>定义编译宏</span></td></tr></tbody></table></figure><hr /><p><span>CONFIG的常用选项</span></p><ul><li><span>debug</span></li><li><span>release</span></li><li><span>debug_and_release  同时构建debug版和release版本的可执行程序</span></li><li><span>warn_on</span></li><li><span>warn_off  不输出警告信息</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">CONFIG</span> <span class="cm-operator">+=</span> <span class="cm-variable">warn_on</span> <span class="cm-variable">debug</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">CONFIG</span>(<span class="cm-variable">debug</span>){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">DEFINES</span> <span class="cm-operator">+=</span> <span class="cm-variable">DEBUG_LOG</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">SOURCES</span> <span class="cm-operator">+=</span> <span class="cm-variable">DebugLog</span>.<span class="cm-variable">cpp</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">HEADERS</span> <span class="cm-operator">+=</span> <span class="cm-variable">DebugLog</span>.<span class="cm-variable">h</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><mark><span>跨平台开发原理</span></mark></p><blockquote><p><span>.pro文件 → qmake → 生成Makefile（对于不同系统生成不同的） </span></p></blockquote><p><span>一般使用相对路径，Creator在打开项目文件的同时会生成.pro.user文件（包含本地配置信息），因此，在不同计算机之间移动项目源码时，建议删除.pro.user</span></p><hr /><p><span>窗口组件和窗口类型</span></p><p><span>图形用户界面由窗口和窗口组件构成</span></p><p><span>Qt以组件对象（</span><QtGui><span>头文件中包含GUI模块）的方式构建图形用户界面</span></p><p><span>窗口：没有父组件的顶级组件</span></p><p><span>组件类型：</span></p><ul><li><span>容器类（父组件）：用于包含其他界面组件，如 widget，frame</span></li><li><span>功能类（子组件）：用于实现特定的交互功能，如 label，pushbutton</span></li></ul><hr /><p><span>窗口组件</span></p><p><span>QWidget类继承自QObject类和QPintDevice类</span></p><ul><li><span>QObject是所有支持Qt对象模型的基类</span></li><li><span>QPaintDevice是Qt中所有可绘制组件的基类</span></li></ul><blockquote><p><span>QLabel、QLineEdit、QPushButton等 →（继承自）→ QWidget → QObject、QPintDevice</span></p></blockquote><p><span>QWidget能够绘制自己和处理用户的输入，是</span><strong><span>所有窗口组件类的父类</span></strong><span>，是</span><strong><span>所有窗口组件的抽象</span></strong><span>，每一个窗口组件都是一个QWidget</span></p><p><strong><span>窗口类型</span></strong></p><ul><li><span>Qt::Dialog  对话框类型</span></li><li><span>Qt::Window  主窗口类型</span></li><li><span>Qt::SplashScreen 用来做欢迎界面，启动动画类型</span></li></ul><p><strong><span>窗口标志</span></strong></p><ul><li><span>Qt::WindowStaysOnTopHint  保持在顶部，相当于一直贴在屏幕上</span></li><li><span>Qt::WindwoContextHelpButtonHint  帮助替换了最大最小化</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QWidget</span> <span class="cm-def">w</span>(<span class="cm-variable">NULL</span>,<span class="cm-variable">Qt::SplashScreen</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QWidget</span> <span class="cm-def">w</span>(<span class="cm-variable">NULL</span>,<span class="cm-variable">Qt::Window</span> <span class="cm-operator">|</span> <span class="cm-variable">WindowStaysOnTopHint</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QWidget</span> <span class="cm-def">w</span>(<span class="cm-variable">NULL</span>,<span class="cm-variable">Qt::Dialog</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><h3><a name="13-qt的坐标系统" class="md-header-anchor"></a><span>1.3 Qt的坐标系统</span></h3><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"x = "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">w</span>.<span class="cm-variable">x</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"y="</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">w</span>.<span class="cm-variable">y</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"width = "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">w</span>.<span class="cm-variable">width</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"y="</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">w</span>.<span class="cm-variable">height</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"geometry x = "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">w</span>.<span class="cm-variable">geometry</span>().<span class="cm-variable">x</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"geometry y="</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">w</span>.<span class="cm-variable">geometry</span>().<span class="cm-variable">y</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"geometry width = "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">w</span>.<span class="cm-variable">geometry</span>().<span class="cm-variable">width</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"geometry y="</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">w</span>.<span class="cm-variable">geometry</span>().<span class="cm-variable">height</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"frameGeometry x = "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">w</span>.<span class="cm-variable">frameGeometry</span>().<span class="cm-variable">x</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"y="</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">w</span>.<span class="cm-variable">frameGeometry</span>().<span class="cm-variable">y</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"frameGeometry width = "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">w</span>.<span class="cm-variable">frameGeometry</span>().<span class="cm-variable">width</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"y="</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">w</span>.<span class="cm-variable">frameGeometry</span>().<span class="cm-variable">height</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>改变窗口部件的大小</span></p><ul><li><span>resize(in w, int h);  resize(const QSize&amp;)</span></li></ul><p><span>改变位置</span></p><ul><li><span>move(in x, int y);  move(const QPoint&amp;)</span></li></ul><hr /><p><span>快捷键</span></p><figure><table><thead><tr><th><span>ctrl + shift + r</span></th><th><span>预览ui</span></th></tr></thead><tbody><tr><td><span>ctrl + h</span></td><td><span>水平布局</span></td></tr><tr><td><span>ctrl + l</span></td><td><span>垂直布局</span></td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table></figure><p>&nbsp;</p><p>&nbsp;</p><h3><a name="14-软件开发中代码重构" class="md-header-anchor"></a><span>1.4 软件开发中代码重构</span></h3><hr /><p><span>重构Refactoring，对软件系统进行重写架构</span></p><p><span>以</span><strong><span>改善代码质量</span></strong><span>为目的代码重写</span></p><ul><li><span>使其软件的</span><strong><span>设计和框架更加合理</span></strong></li><li><span>提高软件的</span><strong><span>扩展性</span></strong><span>和</span><strong><span>维护性</span></strong></li></ul><hr /><p><mark><span>重构与实现区别</span></mark></p><p><span>代码实现：按照设计编程实现，</span><strong><span>重心在于功能实现</span></strong><span>，不考虑架构的好坏，只考虑功能的实现</span></p><p><span>代码重构：以提高代码质量为目的</span><strong><span>软件架构优化</span></strong><span>，不能影响已实现的功能，只考虑框架的改善</span></p><hr /><p><span>从工程角度的软件开发过程</span></p><blockquote><p><span>需求分析 → 功能分解 → 功能实现 → 功能测试 → （重构 → 功能测试）→ 系统测试 → 最终发布</span></p></blockquote><p><span>重构是维持代码质量在可接受范围内的重要方式</span></p><p><span>重构时间和时机：当重复的代码越来越多，代码功能越来越不清晰，代码离设计越来越远</span></p><hr /><p><mark><span>二阶构造法</span></mark></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Test9Calculator</span> : <span class="cm-keyword">public</span> <span class="cm-variable">QWidget</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Q_OBJECT</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">~Test9Calculator</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-variable">show</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">static</span> <span class="cm-variable">Test9Calculator</span><span class="cm-operator">*</span> <span class="cm-variable">NewInstance</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Test9Calculator</span>(<span class="cm-variable">QWidget</span> <span class="cm-operator">*</span><span class="cm-variable">parent</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">bool</span> <span class="cm-variable">construct</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QLineEdit</span><span class="cm-operator">*</span> <span class="cm-variable">MyLineEdit</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QPushButton</span><span class="cm-operator">*</span> <span class="cm-variable">MyBtn</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include "test9calculator.h"</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">Test9Calculator::Test9Calculator</span>(<span class="cm-variable">QWidget</span> <span class="cm-operator">*</span><span class="cm-variable">parent</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  : <span class="cm-variable">QWidget</span>(<span class="cm-variable">parent</span>,<span class="cm-variable">Qt::WindowCloseButtonHint</span><span class="cm-operator">|</span><span class="cm-variable">Qt::WindowMaximizeButtonHint</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">Test9Calculator::~Test9Calculator</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">Test9Calculator::show</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">move</span>(<span class="cm-number">300</span>,<span class="cm-number">300</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setFixedSize</span>(<span class="cm-number">280</span>,<span class="cm-number">300</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QWidget::show</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Test9Calculator</span><span class="cm-operator">*</span> <span class="cm-def">Test9Calculator::NewInstance</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">Test9Calculator</span><span class="cm-operator">*</span> <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Test9Calculator</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>( (<span class="cm-variable">ret</span> <span class="cm-operator">==</span> <span class="cm-variable">NULL</span>) <span class="cm-operator">||</span> (<span class="cm-operator">!</span><span class="cm-variable">ret</span><span class="cm-operator">-&gt;</span><span class="cm-variable">construct</span>()) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">delete</span> <span class="cm-variable">ret</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">NULL</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">ret</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-def">Test9Calculator::construct</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">bool</span> <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">MyLineEdit</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QLineEdit</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">MyLineEdit</span> <span class="cm-operator">!=</span> <span class="cm-variable">NULL</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">MyLineEdit</span><span class="cm-operator">-&gt;</span><span class="cm-variable">resize</span>(<span class="cm-number">240</span>,<span class="cm-number">30</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">MyBtn</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QPushButton</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">MyBtn</span> <span class="cm-operator">!=</span> <span class="cm-variable">NULL</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">MyBtn</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setText</span>(<span class="cm-variable">StrList</span>[<span class="cm-variable">i</span>]);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">ret</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1100px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1100px;"></div></div></div></pre><p>&nbsp;</p><h3><a name="15-消息处理" class="md-header-anchor"></a><span>1.5 消息处理</span></h3><p><span>Qt遵循经典的GUI消息驱动事件模型，封装了具体操作系统的消息机制</span></p><blockquote><p><span>用户事件 → 操作系统 → （翻译为应用程序消息） → 应用程序（消息处理函数）</span></p></blockquote><p><span>信号到槽的连接必须发生在两个Qt对象之间</span></p><ul><li><strong><span>SIGNAL</span></strong><span>  由操作系统产生的消息，用字符串（const char*）进行描述</span></li><li><strong><span>SLOT</span></strong><span>   程序中的消息处理函数</span></li><li><strong><span>Connect</span></strong><span>  将系统消息绑定到消息处理函数</span></li></ul><p><span>信号槽依赖于 Q_OBJECT 宏，只有 Qt 类才能定义信号</span></p><hr /><p><mark><span>信号与槽的对应关系</span></mark></p><blockquote><p><span>单个信号 → 单个槽（一对一）</span></p><p><span>一个信号 → 多个槽（一对多）</span></p><p><span>多个信号 → 单个槽（多对一）</span></p><p><span>单个信号 → 单个信号（转嫁）</span></p></blockquote><p>&nbsp;</p><hr /><p><span>信号本质是什么，如何发射的</span></p><ul><li><span>信号只是一个</span><strong><span>特殊的成员函数声明</span></strong><span>（必须使用 signals 关键字进行声明，返回值是 void，只能说明不能定义）</span></li><li><span>函数访问属性</span><strong><span>自动</span></strong><span>被设置为 </span><strong><span>protected</span></strong></li><li><span>只能通过 </span><strong><span>emit</span></strong><span> 关键字调用函数（发射信号）</span></li></ul><p><mark><span>信号槽军规</span></mark></p><ul><li><span>Qt 类只能在头文件中声明</span></li><li><span>信号与槽原型应该完全相同，信号参数更多时，多余的参数被忽略</span></li><li><span>槽函数的返回值必须是 void</span></li><li><span>槽函数可以像普通函数一样被调用</span></li><li><strong><span>信号与槽的访问属性对于 connect/disconnect 无效</span></strong></li></ul><p><mark><span>信号槽意义</span></mark></p><ul><li><span>最大限度</span><strong><span>弱化</span></strong><span>类之间的耦合关系，使得类间关系松散，提高类的可复用性</span></li></ul><ul><li><span>在设计阶段，可以减少不必要的接口类（抽象类）</span></li></ul><ul><li><span>在开发阶段，对象间的交互通过信号与槽动态绑定</span></li></ul><hr /><p><mark><span>连接方式</span></mark><span>：connect() 第五个参数，连接方式决定槽函数调用时候的相关行为</span></p><ol><li><p><strong><span>立即调用</span></strong><span>     </span><mark><span>Qt::DirectConnection</span></mark></p><p><span>直接在发送信号的线程中调用槽函数，等价于槽函数的</span><strong><span>实时调用</span></strong><span>（在 emit 信号处），</span><strong><span>忽略掉线程依附性</span></strong></p></li><li><p><strong><span>异步调用</span></strong><span>   </span><mark><span>Qt::QueuedConnection</span></mark></p><p><span>信号发送到目标线程的事件队列，由目标线程处理，当前线程继续向下执行</span></p></li><li><p><strong><span>同步调用</span></strong><span>    </span><mark><span>Qt::BlockingQueuedConnection</span></mark></p></li></ol><p><span>信号发送到目标线程的事件队列，由目标线程处理；当前线程等待槽函数返回，之后继续向下执行</span></p><p><span>注意：</span><strong><span>目标线程和当前线程必须不同</span></strong><span>，如果相同，那当前发送信号的线程永远无法向下执行</span></p><ol start='4' ><li><p><strong><span>默认连接</span></strong><span>   </span><mark><span>Qt::AutoConnection</span></mark><span>，自动确定连接类型</span></p><p><span>情况一：等价于 DirecConnection，发送线程= 接收线程</span></p><p><span>情况二：等价于 QueuedConnection，发送线程 ！= 接收线程</span></p></li><li><p><strong><span>单一连接</span></strong><span>    </span><mark><span>Qt::UniqueConnection</span></mark></p></li></ol><p><span>功能与AutoConnection相同，自动确定连接类型</span></p><p><span>同一个信号与同一个槽函数之间只有一个连接</span></p><p><span>默认情况：同一个信号可以多次连接到同一个槽函数，这时信号发送时，槽函数会被多次调用</span></p><p>&nbsp;</p><hr /><ul><li><span>每一个线程都有自己的事件队列</span></li><li><span>线程通过事件队列接收信号</span></li></ul><ul><li><span>信号在事件循环中被处理</span></li></ul><ul><li><span>发送信号，信号进入接收者对象所依附线程的事件队列</span></li></ul><p>&nbsp;</p><h3><a name="16-qstring字符串类" class="md-header-anchor"></a><span>1.6 QString字符串类</span></h3><p><strong><span>C缺陷：不支持真正意义上的字符串，用字符数组和一组函数实现字符串操作，不支持自定义类型，因此无法获得字符串类型</span></strong></p><p><span>C到C++的进化过程引入了自定义类型</span></p><p><span>STL是意义上需要与c++一同发布的标准库</span></p><p><span>STL是一套以模板技术完成的C++类库，包含常用的算法和数据结构，包含了字符串类</span></p><p><strong><span>STL的缺陷：具体实现依赖于编译器生产厂商</span></strong></p><p><span>STL的标准只是</span><strong><span>其接口是标准的</span></strong><span>：相同的全局函数，相同的算法类和数据结构类，相同的类成员函数</span></p><p><span>依赖于STL开发的C++程序在不同平台上的行为可能不同</span></p><p><span>因此，需要跨平台时，不使用STL库，而使用QString，更适合跨平台开发的场景，更强大易用</span></p><p><span>QString特点</span></p><ul><li><span>采用Unicode编码，STL采用ASCII编码</span></li><li><span>使用隐式共享技术来节省内存和不必要的数据拷贝，是集合了深拷贝和浅拷贝的优点于一身</span></li><li><span>跨平台使用，不必考虑字符串的平台兼容性</span></li></ul><p><span>支持字符串和数组的相互转换，支持字符串大小比较，支持不同字符编码间的相互转换，支持std::string和std::wstring的相互转换，支持正则表达式</span></p><p>&nbsp;</p><p>&nbsp;</p><h4><a name="161-符号上标" class="md-header-anchor"></a><span>1.6.1 符号上标</span></h4><figure><table><thead><tr><th><span>上标</span></th><th><span>Unicode</span></th><th>&nbsp;</th></tr></thead><tbody><tr><td><span>0</span></td><td><span>2070</span></td><td><span>C++</span></td></tr><tr><td><span>1</span></td><td><span>00B9</span></td><td><span>\xE2\81\80</span></td></tr><tr><td><span>2</span></td><td><span>00B2</span></td><td><span>\xC2\xB9</span></td></tr><tr><td><span>3</span></td><td><span>00B3</span></td><td><span>\xC2\xB2</span></td></tr><tr><td><span>4</span></td><td><span>2074</span></td><td><span>\xC2\xB3</span></td></tr><tr><td><span>5</span></td><td><span>2075</span></td><td><span>\xE2\81\B4</span></td></tr><tr><td><span>6</span></td><td><span>2076</span></td><td><span>\xE2\81\B5</span></td></tr><tr><td><span>7</span></td><td><span>2077</span></td><td><span>\xE2\81\B6</span></td></tr><tr><td><span>8</span></td><td><span>2078</span></td><td><span>\xE2\81\B7</span></td></tr><tr><td><span>9</span></td><td><span>2079</span></td><td><span>\xE2\81\B8</span></td></tr></tbody></table></figure><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 方法一</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QString</span> <span class="cm-variable">str</span> <span class="cm-operator">=</span> <span class="cm-variable">QString::fromUtf8</span>(<span class="cm-string">"m\xC2\xB2"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 方法二</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">quint16</span> <span class="cm-variable">square</span> <span class="cm-operator">=</span> <span class="cm-number">0xB2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QString</span> <span class="cm-variable">paintStr</span> <span class="cm-operator">=</span> <span class="cm-string">"m"</span> <span class="cm-operator">+</span> <span class="cm-variable">QString::fromUtf16</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">square</span>, <span class="cm-number">1</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p>&nbsp;</p><p>&nbsp;</p><h3><a name="17-设计原则" class="md-header-anchor"></a><span>1.7 设计原则</span></h3><p><span>界面与逻辑</span></p><p><span>用户界面模块UI：接受用户输入及呈现数据</span></p><p><span>业务逻辑模块：根据用户需求处理数据</span></p><hr /><p><mark><span>基本设计原则</span></mark></p><blockquote><p><span>功能模块之间需要进行解耦，</span><strong><span>强内聚</span></strong><span>，</span><strong><span>弱耦合</span></strong></p></blockquote><ul><li><span>每个模块只实现</span><strong><span>单一功能</span></strong></li><li><span>模块内部的</span><strong><span>子模块只为整体的单一功能而存在</span></strong></li><li><span>模块之间通过约定好的</span><strong><span>接口进行交互</span></strong></li></ul><p><span>接口：（1）广义：一种</span><strong><span>契约</span></strong><span>（协议，语法，格式等）（2）狭义：面向对象，接口是</span><strong><span>一组预定义的函数原型</span></strong><span>；面向对象中接口是</span><strong><span>纯虚类</span></strong></p><p><span>用户界面与业务逻辑，用户界面使用业务接口，业务逻辑实现业务接口</span></p><p><span>模块之间仅通过接口进行关联（有模块使用，也有模块实现该接口）</span></p><p><span>模块之间的关系是单项依赖的（避免模块间存在循环依赖的情况）</span></p><p>&nbsp;</p><h2><a name="第二章qt" class="md-header-anchor"></a><span>第二章：Qt</span></h2><hr /><h3><a name="21-qt对象间的父子关系" class="md-header-anchor"></a><span>2.1 Qt对象间的父子关系</span></h3><p><span>Qt对象（继承QObject）间存在父子关系：（1）每一个对象保存它所有子对象的指针（2）每个对象保存指向其父对象的指针</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QObject</span><span class="cm-operator">*</span> <span class="cm-variable">p</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QObject</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QObject</span><span class="cm-operator">*</span> <span class="cm-variable">c1</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QObject</span>(<span class="cm-variable">p</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QObject</span><span class="cm-operator">*</span> <span class="cm-variable">c2</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QObject</span>(<span class="cm-variable">p</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"p: "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">p</span>; &nbsp;<span class="cm-comment">// p:  QObject(0x55f32ce1eef0)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"c1: "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">c1</span>; &nbsp;<span class="cm-comment">//c1:  QObject(0x55f32ce1ef90)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"c2: "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">c2</span>; &nbsp;<span class="cm-comment">// c2:  QObject(0x55f32ce1f060)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">const</span> <span class="cm-variable">QObjectList</span><span class="cm-operator">&amp;</span> <span class="cm-variable">list</span> <span class="cm-operator">=</span> <span class="cm-variable">p</span><span class="cm-operator">-&gt;</span><span class="cm-variable">children</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-variable">list</span>.<span class="cm-variable">length</span>();<span class="cm-operator">++</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">i</span><span class="cm-operator">&lt;&lt;</span><span class="cm-string">": "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">list</span>[<span class="cm-variable">i</span>]; &nbsp;<span class="cm-comment">//0 :  QObject(0x55f32ce1ef90)  1 :  QObject(0x55f32ce1f060)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"parent of c1: "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">c1</span><span class="cm-operator">-&gt;</span><span class="cm-variable">parent</span>(); &nbsp;<span class="cm-comment">//parent of c1:  QObject(0x55f32ce1eef0)</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"parent of c2: "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">c2</span><span class="cm-operator">-&gt;</span><span class="cm-variable">parent</span>(); &nbsp;<span class="cm-comment">//parent of c2:  QObject(0x55f32ce1eef0)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><hr /><p><span>当Qt对象被销毁时（1）将自己从父对象的 Children List移除，解除父子关系（2）将自己的Children List中的所有对象销毁</span></p><p>&nbsp;</p><h3><a name="22-dialog" class="md-header-anchor"></a><span>2.2 Dialog</span></h3><hr /><p><span>对话框是与用户</span><strong><span>简短交互</span></strong><span>的顶层窗口</span></p><p><span>QDialog是所有对话框类的基类，QDialog继承于QWidget，是一种容器类型的组件</span></p><p><span>意义</span></p><ul><li><span>作为一种</span><strong><span>专用交互窗口</span></strong><span>而存在</span></li><li><strong><span>不能作为子部件</span></strong><span>嵌入其它容器</span></li><li><span>是定制了窗口式样的特殊QWidget</span></li></ul><p><mark><span>1.模态对话框</span></mark><span>（QDialog::exec()）</span></p><ul><li><span>显示后无法与父窗口交互</span></li><li><span>是一种阻塞式的对话框调用方式</span></li></ul><p><span>常用于消息提示、文件选择、打印设置等</span></p><p><mark><span>2.非模态对话框</span></mark><span>（QDialog::show()）</span></p><ul><li><span>显示后独立存在可以同时和父窗口交互</span></li><li><span>非阻塞式的对话框调用方式</span></li></ul><p><span>用于查找操作、属性功能设置等</span></p><p><span>在</span><strong><span>栈</span></strong><span>上创建</span><strong><span>模态对话框</span></strong><span>，堆上创建非模态</span></p><p><span>通过QDialog::setModal可以创建混合特性的对话框</span></p><p><strong><span>非模态对话框需要指定 Qt::WA_DeleteOnClose属性</span></strong></p><p><span>dialog-&gt;setAttribute(Qt::WA_DeleteOnClose);</span></p><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QDialog</span><span class="cm-operator">*</span> <span class="cm-variable">Dia</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Dialog</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Dia</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setModal</span>(<span class="cm-keyword">this</span>); &nbsp;<span class="cm-comment">// 具有模态的特性</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Dia</span><span class="cm-operator">-&gt;</span><span class="cm-variable">show</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>Dialog::exec()的返回值为交互结果</span></p><p><span>自制控件（继承与Dialog），可以使用done(Accept);来指定返回，自定义返回 done(100);</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">r</span><span class="cm-operator">=</span> <span class="cm-variable">Dlg</span>.<span class="cm-variable">exec</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-variable">QDialog::Accepted</span> <span class="cm-operator">==</span> <span class="cm-variable">r</span>){}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span> <span class="cm-keyword">if</span>(<span class="cm-variable">QDialog::Rejected</span> <span class="cm-operator">==</span> <span class="cm-variable">r</span>){}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-variable">r</span>; &nbsp;<span class="cm-comment">// 不是 return a.exec();，因为 Dlg.exec()已经进入了消息循环</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 如果 return a.exec(); 那么关闭窗口，程序还在运行，因为进入了两次消息循环</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><hr /><p><span>可复用登录对话框</span></p><p><span>附加需求：随机验证码</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">name</span><span class="cm-operator">=</span> <span class="cm-variable">LineEdit1</span>.<span class="cm-variable">text</span>.<span class="cm-variable">trimmed</span>(); &nbsp;<span class="cm-comment">// 去除前后空格</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><hr /><p><span>Qt中的标准对话框</span></p><hr /><p><mark><span>消息对话框</span></mark><span> QMessageBox</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QMessageBox</span> <span class="cm-def">msg</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">msg</span>.<span class="cm-variable">setStandardButtons</span>(<span class="cm-variable">QMessage::Ok</span> <span class="cm-operator">|</span> <span class="cm-variable">QMessage::Cancel</span> <span class="cm-operator">|</span> <span class="cm-variable">QMessage::YesToAll</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-variable">msg</span>.<span class="cm-variable">exec</span>() <span class="cm-operator">==</span> <span class="cm-variable">QMessage::Ok</span>){}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><hr /><p><mark><span>文件对话框</span></mark><span> QFileDialog</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QFileDialog</span> <span class="cm-def">dlg</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dlg</span>.<span class="cm-variable">setAcceptMode</span>(<span class="cm-variable">QFileDialog::AcceptOpen</span>); &nbsp;<span class="cm-comment">//QFileDialog::AcceptSave保存文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dlg</span>.<span class="cm-variable">setFileMode</span>(<span class="cm-variable">QFileDialog::ExistingFile</span>); &nbsp;<span class="cm-comment">// 单选，多选ExistingFiles</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">dlg</span>.<span class="cm-variable">exec</span>() <span class="cm-operator">==</span> <span class="cm-variable">QFileDialog::Accepted</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QStringList</span> <span class="cm-variable">fs</span> <span class="cm-operator">=</span> <span class="cm-variable">dlg</span>.<span class="cm-variable">selectedFiles</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 文件过滤</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">JPG</span> &nbsp;<span class="cm-operator">*</span>.<span class="cm-variable">jpg</span><span class="cm-operator">*</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">Text</span>(<span class="cm-operator">*</span>.<span class="cm-variable">txt</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">All</span> &nbsp;<span class="cm-operator">*</span>.<span class="cm-operator">*</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dlg</span>.<span class="cm-variable">setFile</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><hr /><p><mark><span>颜色对话框</span></mark><span> QColorDialog</span></p><p><span>QColor支持多种颜色表示</span></p><ul><li><span>RGB:  以红绿蓝为基准的三色模型</span></li><li><span>HSV:  以色调、饱和度、明度为基准的六角锥体模型</span></li><li><span>CMYK:  以天蓝、品红、黄色、黑为基准的全彩印刷色彩模型</span></li></ul><p>&nbsp;</p><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QColorDialog</span> <span class="cm-def">dlg</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dlg</span>.<span class="cm-variable">setCurrentColor</span>(<span class="cm-variable">Qt::red</span>); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">dlg</span>.<span class="cm-variable">exec</span>() <span class="cm-operator">==</span> <span class="cm-variable">QColorDialog::Accepted</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">dlg</span>.<span class="cm-variable">selectedColor</span>(); &nbsp;<span class="cm-comment">// QColor(ARGB 1, 1, 0, 0) ，第一个1是透明度100%（即不透明），QColor.red()单个颜色</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p>&nbsp;</p><p><mark><span>输入对话框</span></mark><span> QInputDialog</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QInputDialog</span> <span class="cm-def">dlg</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dlg</span>.<span class="cm-variable">setInputMode</span>(<span class="cm-variable">QInputDialog::IntInput</span>); &nbsp; <span class="cm-comment">// TextInput IntInput DoubleInput </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">dlg</span>.<span class="cm-variable">exec</span>() <span class="cm-operator">==</span> <span class="cm-variable">QInputDialog::Accepted</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">dlg</span>.<span class="cm-variable">intValue</span>(); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>实用函数 getInt</span></p><p>&nbsp;</p><p><mark><span>字体对话框</span></mark><span>  QFontDialog</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QFontDialog</span> <span class="cm-def">dlg</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dlg</span>.<span class="cm-variable">setCurrentFont</span>(<span class="cm-variable">QFont</span>(<span class="cm-string">"Kinnari"</span>,<span class="cm-number">10</span>,<span class="cm-variable">QFont::Bold</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">dlg</span>.<span class="cm-variable">exec</span>() <span class="cm-operator">==</span> <span class="cm-variable">QFontDialog::Accepted</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">dlg</span>.<span class="cm-variable">selectedFont</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 实用函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-variable">ok</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QFont</span> <span class="cm-variable">font</span> <span class="cm-operator">=</span> <span class="cm-variable">QFontDialog::getFont</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">ok</span>,<span class="cm-variable">QFont</span>(<span class="cm-string">"Times"</span>,<span class="cm-number">12</span>),<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"font:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">font</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p><mark><span>进度对话框</span></mark><span>  QProgressDialog</span></p><p><span>用于显示进度信息，用于需要用户等待的场合</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">QProgressDialog</span> <span class="cm-def">dlg</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">dlg</span>.<span class="cm-variable">setWindowTitle</span>(<span class="cm-string">"progressdialog"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">dlg</span>.<span class="cm-variable">setLabelText</span>(<span class="cm-string">"downloading from server..."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">dlg</span>.<span class="cm-variable">setMinimum</span>(<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">dlg</span>.<span class="cm-variable">setMaximum</span>(<span class="cm-number">100</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">dlg</span>.<span class="cm-variable">setValue</span>(<span class="cm-number">35</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// create a new thread</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">dlg</span>.<span class="cm-variable">exec</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><mark><span>打印对话框</span></mark><span>   QPrintDialog</span></p><p><span>用于设置打印相关的参数信息</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPrintDialog</span> <span class="cm-def">dlg</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">dlg</span>.<span class="cm-variable">setWindowTitle</span>(<span class="cm-string">"print dialog"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">dlg</span>.<span class="cm-variable">exec</span>() <span class="cm-operator">==</span> <span class="cm-variable">QPrintDialog::Accepted</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">QPrinter</span><span class="cm-operator">*</span> <span class="cm-variable">p</span> <span class="cm-operator">=</span> <span class="cm-variable">dlg</span>.<span class="cm-variable">printer</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">QTextDocument</span> <span class="cm-variable">td</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">td</span>.<span class="cm-variable">setPlainText</span>(<span class="cm-string">"printer object test."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">td</span>.<span class="cm-variable">print</span>(<span class="cm-variable">p</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">td</span>.<span class="cm-variable">setHtml</span>(<span class="cm-string">"&lt;h1&gt;Print html object test&lt;/h1&gt;"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">p</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setOutputFileName</span>(<span class="cm-string">"/test.pdf"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><p>&nbsp;</p><p><span>界面部件产生数据对象，业务逻辑中的其他对象使用数据对象，GUI界面与业务逻辑通过数据对象相连</span></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h3><a name="23-布局管理器" class="md-header-anchor"></a><span>2.3 布局管理器</span></h3><p><span>在像素级指定位置和大小move，resize 等，是绝对定位，不会随着窗口的缩放而改变</span></p><p><strong><span>绝对定位的布局方式无法自适应窗口的变化</span></strong></p><p><span>解决方案：布局管理器，自动排列窗口组件，自动更新组件大小</span></p><p><span>不是界面部件，而是界面部件的定位策略</span></p><p><span>同一布局管理器中的组件拥有相同的父组件，组件间的父子关系是Qt内存管理的重要方式</span></p><p><span>QLayout是抽象基类</span></p><p><mark><span>QBoxLayout</span></mark><span>（QVBoxLayout与QHBoxLayout）、QGridLayout、QFormLayout、QStackdLayout</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QVBoxLayout</span><span class="cm-operator">*</span> <span class="cm-variable">layout</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QVBoxLayout</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setSpacing</span>(<span class="cm-number">30</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn1</span>); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn3</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">setLayout</span>(<span class="cm-variable">layout</span>); &nbsp; <span class="cm-comment">// 执行之后 btn 会成为 this 的子部件，同一布局管理器中的组件拥有相同的父组件</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><hr /><p><span>布局管理器可以相互嵌套，形成更加复杂的布局方式，自定义布局类可以达到个性化界面布局的效果</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QVBoxLayout</span><span class="cm-operator">*</span> <span class="cm-variable">layoutv1</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QVBoxLayout</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layoutv1</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setSpacing</span>(<span class="cm-number">30</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layoutv1</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layoutv1</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QVBoxLayout</span><span class="cm-operator">*</span> <span class="cm-variable">layoutv2</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QVBoxLayout</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layoutv2</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setSpacing</span>(<span class="cm-number">30</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layoutv2</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layoutv2</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn3</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QHBoxLayout</span><span class="cm-operator">*</span> <span class="cm-variable">layouth</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QHBoxLayout</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layouth</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setSpacing</span>(<span class="cm-number">30</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layouth</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addLayout</span>(<span class="cm-variable">layoutv1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layouth</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addLayout</span>(<span class="cm-variable">layoutv2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">setLayout</span>(<span class="cm-variable">layouth</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><hr /><p><span>自定义组件大小更新时的比例系数</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setStretchFactor</span>(<span class="cm-variable">btn1</span>,<span class="cm-number">1</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setStretchFactor</span>(<span class="cm-variable">btn2</span>,<span class="cm-number">2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setStretchFactor</span>(<span class="cm-variable">btn3</span>,<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setStretchFactor</span>(<span class="cm-variable">btn</span>,<span class="cm-number">4</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><hr /><p><mark><span>QGridLayout</span></mark><span>  以网格（二维）的方式管理界面组件</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QGridLayout</span><span class="cm-operator">*</span> <span class="cm-variable">layout</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QGridLayout</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setSpacing</span>(<span class="cm-number">10</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn1</span>,<span class="cm-number">0</span>,<span class="cm-number">0</span>); &nbsp;<span class="cm-comment">//指定坐标（0，0），也可以指定大小 layout-&gt;addWidget(btn1,0,0,2,1);占两行一列</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn2</span>,<span class="cm-number">0</span>,<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn</span>,<span class="cm-number">1</span>,<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn3</span>,<span class="cm-number">1</span>,<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setRowStretch</span>(<span class="cm-number">0</span>,<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setRowStretch</span>(<span class="cm-number">1</span>,<span class="cm-number">2</span>); &nbsp;<span class="cm-comment">// 第一行：第二行 = 1：2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">setLayout</span>(<span class="cm-variable">layout</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><hr /><p><mark><span>QFormLayout</span></mark><span>  表单布局管理器 嵌入式中最常用</span></p><p><span>以表单form的方式管理界面组件</span></p><p><span>表单布局中的标签和组件是相互对应的关系  [标签1，组件1]</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QFormLayout</span><span class="cm-operator">*</span> <span class="cm-variable">layout</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QFormLayout</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setSpacing</span>(<span class="cm-number">10</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addRow</span>(<span class="cm-string">"name:"</span>,<span class="cm-variable">lineedit1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addRow</span>(<span class="cm-string">"age:"</span>,<span class="cm-variable">lineedit2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addRow</span>(<span class="cm-string">"sex:"</span>,<span class="cm-variable">lineedit3</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">setLayout</span>(<span class="cm-variable">layout</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>样式函数</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setRowWrapPolicy</span>(<span class="cm-variable">QFormLayout::WrapAllRows</span>); &nbsp;<span class="cm-comment">// 分行显示，一行文字，一行输入框</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setLabelAlignment</span>(<span class="cm-variable">Qt::AlignRight</span>); &nbsp;<span class="cm-comment">// 文本对齐</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><hr /><p><mark><span>QStackedLayout</span></mark><span>   栈式布局管理器，不能嵌套其他布局管理器</span></p><p><span>所有组件垂直于屏幕的方向，每次仅能显示一个组件</span></p><p><span>组件大小一致，能够自由切换需要显示的组件</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QStackedLayout</span><span class="cm-operator">*</span> <span class="cm-variable">layout</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QStackedLayout</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QHBoxLayout</span><span class="cm-operator">*</span> <span class="cm-variable">layouth</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QHBoxLayout</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QWidget</span><span class="cm-operator">*</span> <span class="cm-variable">widget</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QWidget</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">btn</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setParent</span>(<span class="cm-variable">widget</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">btn1</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setParent</span>(<span class="cm-variable">widget</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">layouth</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">layouth</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">widget</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setLayout</span>(<span class="cm-variable">layouth</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">widget</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn3</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setCurrentIndex</span>(<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">setLayout</span>(<span class="cm-variable">layout</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><hr /><p><span>QTimer  计时器</span></p><p>&nbsp;</p><h3><a name="24-主窗口" class="md-header-anchor"></a><span>2.4 主窗口</span></h3><p><span>封装有 菜单栏 MenuBar、工具栏 ToolBar、中心组件 CentralWidget、停靠组件 DockWidget、状态栏 StatusBar</span></p><p>&nbsp;</p><p><mark><span>QMenuBar</span></mark><span> 菜单栏，其中有 下拉菜单组 QMenu，菜单项 QAction</span></p><p>&nbsp;</p><p><mark><span>QToolBar</span></mark><span> 工具栏，容器类型组件，其中有QAction，QToolBar   中可以加任意widget组件，如pushbutton、label、lineedit</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QToolBar</span><span class="cm-operator">*</span> <span class="cm-variable">tb</span> <span class="cm-operator">=</span> <span class="cm-variable">addToolBar</span>(<span class="cm-string">"Tool Bar"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tb</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setFloatable</span>(<span class="cm-atom">false</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tb</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setMovable</span>(<span class="cm-atom">false</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tb</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setIconSize</span>(<span class="cm-variable">QSize</span>(<span class="cm-number">16</span>,<span class="cm-number">16</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QAction</span><span class="cm-operator">*</span> <span class="cm-variable">action</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QAction</span>(<span class="cm-string">""</span>,<span class="cm-variable">NULL</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">action</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setToolTip</span>(<span class="cm-string">"Open"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">action</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setIcon</span>(<span class="cm-variable">QIcon</span>(<span class="cm-string">":/res/open.png"</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tb</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addAction</span>(<span class="cm-variable">action</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p>&nbsp;</p><p><mark><span>QStatusBar</span></mark><span> 状态栏，容器类型组件，可以添加任意组件进去</span></p><p>&nbsp;</p><p><span> 输出简要信息的区域，一般位于最底部，消息类型一般为：</span></p><p><span>实时信息（显示在左边区域 addWidget）：如当前程序状态</span></p><p><span>永久消息（显示在右边区域 addPermanentWidget）：如程序版本号，机构名称</span></p><p><span>进度消息：如进度条提示，百分比提示</span></p><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QStatusBar</span><span class="cm-operator">*</span> <span class="cm-variable">sb</span> <span class="cm-operator">=</span> <span class="cm-variable">statusBar</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QLabel</span><span class="cm-operator">*</span> <span class="cm-variable">label</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QLabel</span>(<span class="cm-string">"label"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QLineEdit</span><span class="cm-operator">*</span> <span class="cm-variable">ed</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QLineEdit</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPushButton</span><span class="cm-operator">*</span> <span class="cm-variable">btn</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QPushButton</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sb</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">label</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sb</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addPermanentWidget</span>(<span class="cm-variable">ed</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sb</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addPermanentWidget</span>(<span class="cm-variable">btn</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">label</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setText</span>(<span class="cm-string">"ZZH"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sb</span><span class="cm-operator">-&gt;</span><span class="cm-variable">show</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><p><mark><span>QCentralWidget</span></mark><span> 文本编辑组件</span></p><p><span>QLineEdit、QTextEdit（多行富文本、支持图片音频，html 等）、QPainTextEdit（多行普通文本）</span></p><p><span>内置功能</span></p><p><span>右键弹出式菜单，快捷键功能（复制粘贴等）</span></p><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QTextEdit</span><span class="cm-operator">*</span> <span class="cm-variable">te</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QTextEdit</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">te</span><span class="cm-operator">-&gt;</span><span class="cm-variable">insertPlainText</span>(<span class="cm-string">"\n\nok"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QString</span> <span class="cm-variable">str</span> <span class="cm-operator">=</span> <span class="cm-string">"&lt;img src=\"D:\\File\\Ubuntu1804Shared\\DTSoftwareQt\\Test27\\Test27\\Icons\\goto.png\" /&gt;"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">te</span><span class="cm-operator">-&gt;</span><span class="cm-variable">insertHtml</span>(<span class="cm-variable">str</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPlainTextEdit</span><span class="cm-operator">*</span> <span class="cm-variable">pe</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QPlainTextEdit</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pe</span><span class="cm-operator">-&gt;</span><span class="cm-variable">insertPlainText</span>(<span class="cm-string">"\n\nok"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p>&nbsp;</p><p>&nbsp;</p><p><span>避免过度设计</span></p><p>&nbsp;</p><p>&nbsp;</p><h3><a name="25-文件操作" class="md-header-anchor"></a><span>2.5 文件操作</span></h3><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p><span>Qt中IO操作的处理方式</span></p><p><span>通过</span><strong><span>统一的接口</span></strong><span>简化了文件与外部设备的操作方式</span></p><p><span>文件被看作一种特殊的外部设备</span></p><p><span>Qt的文件操作和外部设备的操作相同</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-def">open</span>(<span class="cm-variable">OpenMode</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QByteArray</span> <span class="cm-def">read</span>(<span class="cm-variable">qint64</span> <span class="cm-variable">maxsize</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qint64</span> <span class="cm-def">write</span>(<span class="cm-keyword">const</span> <span class="cm-variable">QByteArray</span><span class="cm-operator">&amp;</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">close</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>IO设备的类型</span></p><ol><li><strong><span>顺序读取设备</span></strong><span>：只能从头开始顺序读写数据，不能指定数据的读写位置，如串口设备</span></li><li><strong><span>随机存取设备</span></strong><span>：可以定位到任意位置进行数据的读写 seek function，如文件</span></li></ol><p><span>文件 QFile，串口 QBuffer ，网络编程 QAbstractSocket，进程间多进程编程 QProcess 都是IO设备</span></p><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">file</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::WriteOnly</span> <span class="cm-operator">|</span> <span class="cm-variable">QIODevice::Text</span>) &nbsp; <span class="cm-comment">// 以文本的形式打开，默认是以字节方式</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 没有文件则会创建文件，有该文件则会清空文件内容</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">file</span>.</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p>&nbsp;</p><p>&nbsp;</p><p><mark><span>QTemporaryFile</span></mark><span> 临时文件操作类</span></p><ul><li><span>安全地创建要给</span><strong><span>全局唯一</span></strong><span>的临时文件</span></li><li><strong><span>当对象销毁时对应的临时文件将被删除</span></strong></li><li><span>临时文件的打开方式为 </span><strong><span>QIODevice::ReadWrite</span></strong></li><li><span>临时文件常用于</span><strong><span>大数据传递</span></strong><span>或者</span><strong><span>进程间通信</span></strong><span>的场合</span></li></ul><p>&nbsp;</p><p>&nbsp;</p><hr /><p><span>文本流和数据流</span></p><p><span>两个辅助类，用于IO设备的</span></p><p><span>人类角度文件类型</span></p><p><span>文本文件：内容是可读的文本字符</span></p><p><span>数据文件：内容是直接的二进制数据</span></p><p><span>QFile直接支持文本文件和数据文件，因为直接操作的都是基于字节</span></p><p><span>如何将浮动数据写入文本文件和数据文件</span></p><hr /><p><span>错误示例：不使用辅助类遇到的问题</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QString</span> <span class="cm-variable">str</span> <span class="cm-operator">=</span> <span class="cm-string">"/mnt/hgfs/Ubuntu1804Shared/DTSoftwareQt/Lesson29/Lesson29/demo.txt"</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QFile</span> <span class="cm-def">file</span>(<span class="cm-variable">str</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-variable">file</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::WriteOnly</span>)) &nbsp; &nbsp;<span class="cm-comment">// 默认是写二进制文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">QString</span> <span class="cm-variable">dt</span> <span class="cm-operator">=</span> <span class="cm-string">"zzh"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable-3">double</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-number">3.14</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">file</span>.<span class="cm-variable">write</span>(<span class="cm-variable">dt</span>); &nbsp;<span class="cm-comment">// ERROR</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">file</span>.<span class="cm-variable">write</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">value</span>,<span class="cm-keyword">sizeof</span>(<span class="cm-variable">value</span>)); &nbsp;<span class="cm-comment">// ERROR</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">file</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 以下才为正确</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">file</span>.<span class="cm-variable">write</span>(<span class="cm-variable">dt</span>.<span class="cm-variable">toStdString</span>().<span class="cm-variable">c_str</span>()); <span class="cm-comment">// 先转化为std标准的字符串，再转化为二进制数据，最后得到一个指针（指向该二进制数据）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">file</span>.<span class="cm-variable">write</span>(<span class="cm-keyword">reinterpret_cast</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">char*</span><span class="cm-operator">&gt;</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">value</span>),<span class="cm-keyword">sizeof</span>(<span class="cm-variable">value</span>)); <span class="cm-comment">// </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 打开文件会显示乱码，因为是二进制数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/*---------------------------*/</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-variable">file</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::ReadOnly</span>)) &nbsp;<span class="cm-comment">// 默认是读二进制文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">QString</span> <span class="cm-variable">dt</span> <span class="cm-operator">=</span> <span class="cm-string">""</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable-3">double</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">dt</span> <span class="cm-operator">=</span> <span class="cm-variable">file</span>.<span class="cm-variable">read</span>(<span class="cm-number">3</span>); &nbsp;<span class="cm-comment">//  == dt = (QString)file.read(3);  read 返回的是 QByteArray字节数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">file</span>.<span class="cm-variable">read</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">value</span>,<span class="cm-keyword">sizeof</span>(<span class="cm-variable">value</span>)); &nbsp;<span class="cm-comment">// ERROR</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"dt = "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">dt</span><span class="cm-operator">&lt;&lt;</span><span class="cm-string">"value = "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">// 以下才为正确</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">file</span>.<span class="cm-variable">read</span>(<span class="cm-keyword">reinterpret_cast</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-operator">&gt;</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">value</span>),<span class="cm-keyword">sizeof</span>(<span class="cm-variable">value</span>));</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 616px;"></div><div class="CodeMirror-gutters" style="display: none; height: 616px;"></div></div></div></pre><p>&nbsp;</p><hr /><p><span>使用辅助类</span></p><p><span>QTextStream  写入的数据全部</span><strong><span>转换为可读文本</span></strong><span>，用于</span><strong><span>文本数据的快速读写</span></strong></p><p><span>QDataStream  写入的数据根据类型</span><strong><span>转换为二进制数据</span></strong><span>，用于</span><strong><span>二进制数据的快速读写</span></strong></p><p><span>IO设备使用辅助类的方式</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 1. 创建IO设备的对象，如创建QFile文件对象 file</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 2. 使用file 对象打开文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 3. 将数据写入文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QXXXXStream</span> <span class="cm-def">out</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">file</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">QString</span>(<span class="cm-string">"zzh"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">QString</span>(<span class="cm-string">"Result: "</span>)<span class="cm-operator">&lt;&lt;</span><span class="cm-number">3.14</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 4. 将数据从文件读出</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QXXXXStream</span> <span class="cm-def">in</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">file</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">in</span><span class="cm-operator">&gt;&gt;</span><span class="cm-variable">dt</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">in</span><span class="cm-operator">&gt;&gt;</span><span class="cm-variable">result</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">in</span><span class="cm-operator">&gt;&gt;</span><span class="cm-variable">value</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 使用 QTextStream </span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">text_stream_test</span>(<span class="cm-variable">QString</span> <span class="cm-variable">f</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QFile</span> <span class="cm-variable">file</span>(<span class="cm-variable">f</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 使用 QTextStream 写入</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">file</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::WriteOnly</span> <span class="cm-operator">|</span> <span class="cm-variable">QIODevice::Text</span>)) &nbsp;<span class="cm-comment">// 使用的是 QTextStream，因此必须加 QIODevice::Text</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">QTextStream</span> <span class="cm-variable">out</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">file</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">QString</span>(<span class="cm-string">"zzh"</span>)<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">endl</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">QString</span>(<span class="cm-string">"Result:"</span>)<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">endl</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-number">5</span><span class="cm-operator">&lt;&lt;</span><span class="cm-string">"*"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-number">6</span><span class="cm-operator">&lt;&lt;</span><span class="cm-string">"="</span><span class="cm-operator">&lt;&lt;</span><span class="cm-number">5</span><span class="cm-operator">*</span><span class="cm-number">6</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">endl</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">file</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 使用 QTextStream 读取</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">file</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::ReadOnly</span> <span class="cm-operator">|</span> <span class="cm-variable">QIODevice::Text</span> ))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">QTextStream</span> <span class="cm-variable">in</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">file</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span>(<span class="cm-operator">!</span><span class="cm-variable">in</span>.<span class="cm-variable">atEnd</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">QString</span> <span class="cm-variable">line</span> <span class="cm-operator">=</span> <span class="cm-variable">in</span>.<span class="cm-variable">readLine</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">line</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">file</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 使用 QDataStream </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">data_stream_test</span>(<span class="cm-variable">QString</span> <span class="cm-variable">f</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QFile</span> <span class="cm-variable">file</span>(<span class="cm-variable">f</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 使用 QDataStream 写入，写入的是二进制数据，因此是乱码的</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">file</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::WriteOnly</span> ))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">QDataStream</span> <span class="cm-variable">out</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">file</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">QString</span>(<span class="cm-string">"zzh"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">QString</span>(<span class="cm-string">"Result:"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-number">5.14</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">file</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 使用 QDataStream 读取</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">file</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::ReadOnly</span>  ))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">QDataStream</span> <span class="cm-variable">in</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">file</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">QString</span> <span class="cm-variable">dt</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">QString</span> <span class="cm-variable">result</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">double</span> <span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">in</span><span class="cm-operator">&gt;&gt;</span><span class="cm-variable">dt</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">in</span><span class="cm-operator">&gt;&gt;</span><span class="cm-variable">result</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">in</span><span class="cm-operator">&gt;&gt;</span><span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"dt = "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">dt</span><span class="cm-operator">&lt;&lt;</span><span class="cm-string">"result = "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">result</span><span class="cm-operator">&lt;&lt;</span><span class="cm-string">"value = "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">file</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1166px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1166px;"></div></div></div></pre><hr /><p><span>注意：</span></p><p><span>不同Qt版本的数据流文件格式可能不同，</span><strong><span>当数据流文件要在不同版本程序中传递数据时，需要考虑版本问题</span></strong></p><p><span>void setVersion(int v)  // 设置读写版本号，如： out.setVersion(QDataStream::Qt_4_7)   in.setVersion(QDataStream::Qt_4_7)</span></p><p><span>int version() const    // 获取读写版本号</span></p><h4><a name="251-缓冲区操作与目录操作" class="md-header-anchor"></a><span>2.5.1 缓冲区操作与目录操作</span></h4><hr /><p><span>计算机中有外部缓冲区（位于外部设备中）和内部缓冲区</span></p><p><span>Qt中缓冲区的本质为</span><strong><span>一段连续的存储空间</span></strong></p><p><strong><span>QBuffer</span></strong><span>类，缓冲区可看作</span><strong><span>一种特殊的 IO 设备</span></strong><span>，文本辅助类可以直接用于操作缓冲区</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QByteArray</span> <span class="cm-variable">arr</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QBuffer</span> <span class="cm-def">buffer</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">arr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-variable">buffer</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::WriteOnly</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QDataStream</span> <span class="cm-variable">out</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">buffer</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">QString</span>(<span class="cm-string">"ZZH"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-number">3.14</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">buffer</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><hr /><p><span>QBuffer 缓冲区的使用场合：</span></p><ol><li><span>在线程间进行不同类型的</span><strong><span>数据传递</span></strong></li><li><strong><span>缓存外部设备</span></strong><span>中的数据返回</span></li><li><strong><span>数据读取速度小于数据写入速度</span></strong></li></ol><p><span>涉及到大量数据的读写时候</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 使用缓冲区读写不同类型数据</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">WriteBuffer</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">type</span>,<span class="cm-variable">QBuffer</span><span class="cm-operator">&amp;</span> <span class="cm-variable">buffer</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>(<span class="cm-variable">buffer</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::WriteOnly</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QDataStream</span> <span class="cm-variable">out</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">buffer</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">type</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>(<span class="cm-number">0</span><span class="cm-operator">==</span><span class="cm-variable">type</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">QString</span>(<span class="cm-string">"ZZH"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">QString</span>(<span class="cm-string">"3.1415926"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-number">3</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">out</span><span class="cm-operator">&lt;&lt;</span><span class="cm-number">1415926</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">buffer</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">ReadBuffer</span>(<span class="cm-variable">QBuffer</span><span class="cm-operator">&amp;</span> <span class="cm-variable">buffer</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>(<span class="cm-variable">buffer</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::ReadOnly</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">int</span> <span class="cm-variable">type</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QDataStream</span> <span class="cm-variable">in</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">buffer</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">in</span><span class="cm-operator">&gt;&gt;</span><span class="cm-variable">type</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>(<span class="cm-number">0</span><span class="cm-operator">==</span><span class="cm-variable">type</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QString</span> <span class="cm-variable">a</span>,<span class="cm-variable">b</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">in</span><span class="cm-operator">&gt;&gt;</span><span class="cm-variable">a</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">in</span><span class="cm-operator">&gt;&gt;</span><span class="cm-variable">ab</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">int</span> <span class="cm-variable">a</span>,<span class="cm-variable">b</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">in</span><span class="cm-operator">&gt;&gt;</span><span class="cm-variable">a</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">in</span><span class="cm-operator">&gt;&gt;</span><span class="cm-variable">b</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">buffer</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>(){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QByteArray</span> <span class="cm-variable">arr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QBuffer</span> <span class="cm-variable">buffer</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">arr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">WriteBuffer</span>(<span class="cm-number">1</span>,<span class="cm-variable">buffer</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ReadBuffer</span>(<span class="cm-variable">buffer</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1034px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1034px;"></div></div></div></pre><hr /><p><span>目录操作 </span><mark><span>QDir</span></mark><span>  ‘/’</span></p><p><span>能够对目录</span><strong><span>进行任意操作</span></strong><span>（创建、删除、重命名）</span></p><p><span>能够</span><strong><span>获取指定目录中的所有条目</span></strong><span>（文件和文件夹）</span></p><p><span>能够使用</span><strong><span>过滤字符串</span></strong><span>获取指定条目</span></p><p><span>能够获取系统的所有根目录</span></p><hr /><p><mark><span>QFileSystemWatcher</span></mark><span> 文件系统监视器</span></p><p><span>用于监控文件和目录的状态变化</span></p><p><span>能够监控特定目录和文件的状态</span></p><p><span>能够同时对</span><strong><span>多个目录和文件</span></strong><span>进行监控</span></p><p><span>当目录或者文件</span><strong><span>发生改变时将触发信号</span></strong></p><p><span>可以通过</span><strong><span>信号和槽</span></strong><span>的机制捕捉信号并作出响应</span></p><p>&nbsp;</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QFileSystemWatcher</span> &nbsp;<span class="cm-variable">m_wathcer</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_wathcer</span>.<span class="cm-variable">addPath</span>(<span class="cm-string">".///text.txt"</span>); &nbsp;<span class="cm-comment">// Qt中 /</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">connect</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">m_watcher</span>,<span class="cm-variable">SIGNAL</span>(<span class="cm-variable">fileChanged</span>(<span class="cm-keyword">const</span> <span class="cm-variable">QString</span> <span class="cm-operator">&amp;</span>)),<span class="cm-keyword">this</span> ,<span class="cm-variable">SLOT</span>(<span class="cm-variable">statusChanged</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">connect</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">m_watcher</span>,<span class="cm-variable">SIGNAL</span>(<span class="cm-variable">directoryChanged</span>(<span class="cm-keyword">const</span> <span class="cm-variable">QString</span> <span class="cm-operator">&amp;</span>)),<span class="cm-keyword">this</span> ,<span class="cm-variable">SLOT</span>(<span class="cm-variable">statusChanged</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><h4><a name="252-文本编辑器中的数据存取" class="md-header-anchor"></a><span>2.5.2 文本编辑器中的数据存取</span></h4><p><span>界面代码与功能代码分离开</span></p><p><span>尽量复用平台中提供的相关组件</span></p><p><span>大部分时间都是写槽函数，相应用户操作，具体功能的触发点</span></p><h4><a name="253-文本编辑器的功能交互" class="md-header-anchor"></a><span>2.5.3 文本编辑器的功能交互</span></h4><p><span>QPlainTextEdit 能够触发与编辑操作相关的信号</span></p><p><strong><span>void textChanged()</span></strong><span>  用于检测数据变化</span></p><p><span>void cursorPositonChanged()</span></p><p><span>void copyAviable(bool)</span></p><p><span>void redoAviable(bool)</span></p><p><span>void undoAviable(bool)</span></p><p><span>功能的交互通过状态变量完成</span></p><h4><a name="254-qmap与qhash" class="md-header-anchor"></a><span>2.5.4 QMap与QHash</span></h4><p><span>两个非线性数据结构类，用于存储键值对的类模板</span></p><hr /><p><mark><span>QMap</span></mark><span> 是一个以</span><strong><span>升序键顺序</span></strong><span>存储</span><strong><span>键值对</span></strong><span>的数据结构</span></p><p><span>原型为 class QMap&lt;K,T&gt; 模板</span></p><p><span>键值对根据 </span><strong><span>Key  (键大小)进行了排序</span></strong></p><p><span>QMap中的 Key 类型必须重载  operator&lt;</span></p><p><span>使用方式一</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QMap</span><span class="cm-operator">&lt;</span><span class="cm-variable">QString</span>,<span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span> <span class="cm-variable">map</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">map</span>.<span class="cm-variable">insert</span>(<span class="cm-string">"key 2"</span>,<span class="cm-number">2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">map</span>.<span class="cm-variable">insert</span>(<span class="cm-string">"key 0"</span>,<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">map</span>.<span class="cm-variable">insert</span>(<span class="cm-string">"key 1"</span>,<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-number">0</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-number">3</span>;<span class="cm-operator">++</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">map</span>.<span class="cm-variable">value</span>(<span class="cm-string">"key "</span><span class="cm-operator">+</span><span class="cm-variable">QString::number</span>(<span class="cm-variable">i</span>)); &nbsp;<span class="cm-comment">// 0  1  2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QList</span><span class="cm-operator">&lt;</span><span class="cm-variable">QString</span><span class="cm-operator">&gt;</span> <span class="cm-variable">list</span> <span class="cm-operator">=</span> <span class="cm-variable">map</span>.<span class="cm-variable">keys</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-variable">list</span>.<span class="cm-variable">count</span>();<span class="cm-operator">++</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">list</span>[<span class="cm-variable">i</span>]; &nbsp;<span class="cm-comment">//"key 0" &nbsp; "key 1" &nbsp; "key 2"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QList</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span> <span class="cm-variable">list2</span> <span class="cm-operator">=</span> <span class="cm-variable">map</span>.<span class="cm-variable">values</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-variable">list2</span>.<span class="cm-variable">count</span>();<span class="cm-operator">++</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">list2</span>[<span class="cm-variable">i</span>]; &nbsp;<span class="cm-comment">//  0  1  2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 440px;"></div><div class="CodeMirror-gutters" style="display: none; height: 440px;"></div></div></div></pre><p><span>使用方式二</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QMap</span><span class="cm-operator">&lt;</span><span class="cm-variable">QString</span>,<span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span> <span class="cm-variable">map2</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">map2</span>[<span class="cm-string">"key 2"</span>]<span class="cm-operator">=</span><span class="cm-number">2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">map2</span>[<span class="cm-string">"key 0"</span>]<span class="cm-operator">=</span><span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">map2</span>[<span class="cm-string">"key 1"</span>]<span class="cm-operator">=</span><span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-number">0</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-number">3</span>;<span class="cm-operator">++</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">map2</span>[<span class="cm-string">"key "</span><span class="cm-operator">+</span><span class="cm-variable">QString::number</span>(<span class="cm-variable">i</span>)]; &nbsp;<span class="cm-comment">// 0  1  2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QMapIterator</span><span class="cm-operator">&lt;</span><span class="cm-variable">QString</span>, <span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span> <span class="cm-def">it</span>(<span class="cm-variable">map2</span>); &nbsp;<span class="cm-comment">// 初始时，it指向 map2 前一个位置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">while</span>(<span class="cm-variable">it</span>.<span class="cm-variable">hasNext</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">it</span>.<span class="cm-variable">next</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">it</span>.<span class="cm-variable">key</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">":"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">it</span>.<span class="cm-variable">value</span>(); <span class="cm-comment">// "key 0" : 0  "key 1" : 1  "key 2" : 2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 308px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p><span>插入键值对时</span></p><ul><li><span>当Key存在：更新 Value的值</span></li><li><span>当Key不存在：插入新的键值对</span></li></ul><p><span>通过Key获取Value时</span></p><ul><li><span>当Key存在：返回对应的 Value</span></li><li><span>当Key不存在：放回类型值所对应的 0 值</span></li></ul><hr /><p><span>QHash是哈希数据结构</span></p><ul><li><span>原型为class QHash&lt;K,T&gt; 模板</span></li><li><span>键值对在内部</span><strong><span>无序排序</span></strong></li><li><span>Key 类型必须重载 </span><strong><span>operator ==</span></strong><span> </span></li><li><span>Key 对象必须重载全局hash函数 </span><strong><span>qHash()</span></strong></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QHash</span><span class="cm-operator">&lt;</span><span class="cm-variable">QString</span>,<span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span> <span class="cm-variable">hash</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">hash</span>.<span class="cm-variable">insert</span>(<span class="cm-string">"key 2"</span>,<span class="cm-number">2</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">hash</span>.<span class="cm-variable">insert</span>(<span class="cm-string">"key 0"</span>,<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">hash</span>.<span class="cm-variable">insert</span>(<span class="cm-string">"key 1"</span>,<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-number">0</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-number">3</span>;<span class="cm-operator">++</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">hash</span>.<span class="cm-variable">value</span>(<span class="cm-string">"key "</span><span class="cm-operator">+</span><span class="cm-variable">QString::number</span>(<span class="cm-variable">i</span>)); &nbsp;<span class="cm-comment">// 0  1  2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QList</span><span class="cm-operator">&lt;</span><span class="cm-variable">QString</span><span class="cm-operator">&gt;</span> <span class="cm-variable">list</span> <span class="cm-operator">=</span> <span class="cm-variable">hash</span>.<span class="cm-variable">keys</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-variable">list</span>.<span class="cm-variable">count</span>();<span class="cm-operator">++</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">list</span>[<span class="cm-variable">i</span>]; &nbsp;<span class="cm-comment">//"key 1" &nbsp; "key 0" &nbsp; "key 2"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QList</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span> <span class="cm-variable">list2</span> <span class="cm-operator">=</span> <span class="cm-variable">hash</span>.<span class="cm-variable">values</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-variable">list2</span>.<span class="cm-variable">count</span>();<span class="cm-operator">++</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">list2</span>[<span class="cm-variable">i</span>]; &nbsp;<span class="cm-comment">// &nbsp; 1  0 &nbsp; 2</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 418px;"></div><div class="CodeMirror-gutters" style="display: none; height: 418px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QHash</span><span class="cm-operator">&lt;</span><span class="cm-variable">QString</span>,<span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span> <span class="cm-variable">hash2</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">hash2</span>[<span class="cm-string">"key 2"</span>]<span class="cm-operator">=</span><span class="cm-number">2</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">hash2</span>[<span class="cm-string">"key 0"</span>]<span class="cm-operator">=</span><span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">hash2</span>[<span class="cm-string">"key 1"</span>]<span class="cm-operator">=</span><span class="cm-number">1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-number">0</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-number">3</span>;<span class="cm-operator">++</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">hash2</span>[<span class="cm-string">"key "</span><span class="cm-operator">+</span><span class="cm-variable">QString::number</span>(<span class="cm-variable">i</span>)]; &nbsp;<span class="cm-comment">// 0  1  2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QHashIterator</span><span class="cm-operator">&lt;</span><span class="cm-variable">QString</span>, <span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span> <span class="cm-def">it</span>(<span class="cm-variable">hash2</span>); &nbsp;<span class="cm-comment">// 初始时，it指向 map2 前一个位置</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">while</span>(<span class="cm-variable">it</span>.<span class="cm-variable">hasNext</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">it</span>.<span class="cm-variable">next</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">it</span>.<span class="cm-variable">key</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">":"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">it</span>.<span class="cm-variable">value</span>(); <span class="cm-comment">// "key 1" : 1<span class="cm-tab" role="presentation" cm-text="	"> </span> &nbsp;  "key 0" : 0<span class="cm-tab" role="presentation" cm-text="	"> </span>  "key 2" : 2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QHash</span><span class="cm-operator">&lt;</span><span class="cm-variable">QString</span>,<span class="cm-variable-3">int</span><span class="cm-operator">&gt;</span>::<span class="cm-variable">const_iterator</span> <span class="cm-variable">i</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-variable">hash2</span>.<span class="cm-variable">constBegin</span>();<span class="cm-variable">i</span><span class="cm-operator">!=</span><span class="cm-variable">hash2</span>.<span class="cm-variable">constEnd</span>();<span class="cm-operator">++</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">i</span>.<span class="cm-variable">key</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">":"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">i</span>.<span class="cm-variable">value</span>(); &nbsp;<span class="cm-comment">//  "key 1" : 1<span class="cm-tab" role="presentation" cm-text="	">   </span> &nbsp;  "key 0" : 0<span class="cm-tab" role="presentation" cm-text="	"> </span>  "key 2" : 2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 440px;"></div><div class="CodeMirror-gutters" style="display: none; height: 440px;"></div></div></div></pre><hr /><p><span>QMap 与 QHash 接口相同，不同点如下：</span></p><ul><li><span>QHash查找速度快于QMap</span></li><li><span>QHash占用空间多于QMap</span></li><li><span>QHash以任意方式存储元素，以Key顺序存储元素</span></li><li><span>QHash的键类型必须提供 operator ==() 和 qHash(key) 函数</span></li><li><span>QMap的键类型必须提供 operator&lt;() 函数</span></li></ul><h3><a name="26-事件处理" class="md-header-anchor"></a><span>2.6 事件处理</span></h3><p><span>Qt 将系统产生的消息转换为 Qt 事件</span></p><ul><li><span>Qt事件是一个 </span><strong><span>QEvent</span></strong><span> 对象</span></li><li><span>用于</span><strong><span>描述程序内部或外部发生的动作</span></strong></li><li><span>任意Object对象都具备事件处理的能力</span></li></ul><p><span>如: QInputEvent   QDropEvent   QPaintEvent  QCloseEvent</span></p><p><span>Qt 事件的传递过程</span></p><blockquote><p><span>OS →(1.OS_MESSAGE)   QApplication  →(2.QEvent)   QWidget(Child)   可能→(3.QEvent)   QWidget(Parent)</span></p></blockquote><p><span>事件被组件对象处理后</span><strong><span>可能传递到其父组件对象</span></strong></p><hr /><p><span>GUI 应用程序的事件处理方式</span></p><ol><li><span>Qt事件产生后立即被</span><strong><span>分发到 QWidget 对象</span></strong></li><li><span>QWidget 中的 </span><strong><span>event(QEvent*)</span></strong><span> 进行事件处理  （ event() 函数是处理入口）</span></li><li><span>event() 根据事件类型</span><strong><span>调用不同的事件处理函数</span></strong></li><li><span>在事件处理函数中</span><strong><span>发送 Qt 中预定义的信号</span></strong></li><li><span>调用信号相关的</span><strong><span>槽函数</span></strong></li></ol><p><span>如QPushButton事件处理</span></p><ol><li><span>接收到鼠标事件</span></li><li><span>调用 event(QEvent*) 成员函数</span></li><li><span>调用 mouseReleaseEvent(QMouseEvent*) 成员函数</span></li><li><span>调用 click() 函数</span></li><li><span>触发信号 SIGNAL(clicked())</span></li></ol><hr /><p><span>事件 QEvent 和信号 SIGNAL 不同</span></p><ul><li><strong><span>事件由QObject具体对象进行处理</span></strong></li><li><strong><span>信号由QObject具体对象触发</span></strong></li><li><span>重写事件处理函数可能导致程序行为发生改变</span></li><li><span>信号是否存在，对应的槽函数不会改变程序行为</span></li><li><span>一般而言，信号在具体的事件处理函数中产生</span></li></ul><p><span>事件处理的具体方法</span></p><p><span>QEvent 关键成员函数</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">ignore</span>() &nbsp;<span class="cm-comment">// 接收者忽略当前事件，事件可能传递给父组件</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">accept</span>() <span class="cm-comment">// 接收者期望处理当前事件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-def">isAccept</span>() &nbsp;<span class="cm-comment">// 判断当前事件是否被处理</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>不同的事件处理方式不同，方式非常多，如：有的事件 accept() 了，但是Qt还是要再处理一遍</span></p><h4><a name="261-事件过滤器" class="md-header-anchor"></a><span>2.6.1 事件过滤器</span></h4><p><span>Qt 中的事件过滤器</span></p><ul><li><span>可以</span><strong><span>对其它组件接受到的事件进行监控</span></strong></li><li><span>任意的 QObject 对象都可以作为事件过滤器使用</span></li><li><span>事件过滤器对象</span><strong><span>需要重写 eventFilter() 函数</span></strong></li></ul><p><span>使用事件过滤器</span></p><ul><li><span>组件通过 </span><strong><span>installEventFilter()</span></strong><span> 安装事件过滤器</span></li><li><span>事件过滤器</span><strong><span>在组件之前接收到事件</span></strong><span>，对事件进行监控</span></li><li><span>事件过滤器能够</span><strong><span>决定是否将事件转发到组件对象</span></strong></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* 事件过滤器的 典型实现 */</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 返回 true 表示事件已经处理，无需传递给 obj</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 返回 false 则正常传递给 obj</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-def">Widget::eventFilter</span>(<span class="cm-variable">QObject</span><span class="cm-operator">*</span> <span class="cm-variable">obj</span>,<span class="cm-variable">QEvent</span><span class="cm-operator">*</span> <span class="cm-variable">e</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>() &nbsp;<span class="cm-comment">// 根据 obj 判断对象</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>() &nbsp;<span class="cm-comment">// 根据 e-&gt;type() 判断事件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 事件处理逻辑</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 调用父类中的同名函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-variable">QWidget::eventFilter</span>(<span class="cm-variable">obj</span>,<span class="cm-variable">e</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><p><span>案例：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mLineEdit</span><span class="cm-operator">-&gt;</span><span class="cm-variable">installEventFilter</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-def">Test39::eventFilter</span>(<span class="cm-variable">QObject</span><span class="cm-operator">*</span> <span class="cm-variable">watched</span>,<span class="cm-variable">QEvent</span><span class="cm-operator">*</span> <span class="cm-variable">event</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">bool</span> <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>((<span class="cm-variable">watched</span> <span class="cm-operator">==</span> <span class="cm-variable">mLineEdit</span>) <span class="cm-operator">&amp;&amp;</span> ( <span class="cm-variable">event</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>() <span class="cm-operator">==</span> <span class="cm-variable">QEvent::KeyPress</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"eventFilter  MyLineEdit KeyPress"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">QKeyEvent</span><span class="cm-operator">*</span> <span class="cm-variable">evt</span> <span class="cm-operator">=</span> <span class="cm-keyword">dynamic_cast</span><span class="cm-operator">&lt;</span><span class="cm-variable">QKeyEvent</span><span class="cm-operator">*&gt;</span>(<span class="cm-variable">event</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">switch</span>(<span class="cm-variable">event</span><span class="cm-operator">-&gt;</span><span class="cm-variable">key</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">case</span> <span class="cm-variable">Qt::Key_0</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">case</span> <span class="cm-variable">Qt::Key_1</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span> <span class="cm-keyword">case</span> <span class="cm-variable">Qt::Key_2</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;<span class="cm-keyword">break</span>; &nbsp;<span class="cm-comment">// 仅当输入1，2，3时 才分发给 mLineEdit</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">default</span> : <span class="cm-keyword">break</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">QWidget::eventFilter</span>(<span class="cm-variable">watched</span>,<span class="cm-variable">event</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">ret</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 528px;"></div><div class="CodeMirror-gutters" style="display: none; height: 528px;"></div></div></div></pre><h4><a name="262-拖放事件" class="md-header-anchor"></a><span>2.6.2 拖放事件</span></h4><p><span>鼠标拖放文件事件：</span></p><ul><li><p><span>拖放一个文件进入窗口时</span><strong><span>触发拖放事件</span></strong></p></li><li><p><span>每一个 QWidget 对象都能够处理拖放事件</span></p></li><li><p><span>拖放事件的处理函数</span></p><p><span>void dragEnterEvent(QDragEnterEvent* e)</span></p><p><span>void dropEvent(QDropEvent* e)</span></p></li></ul><hr /><p><span>拖放事件中的 </span><mark><span>QMimeData</span></mark></p><ul><li><span>是Qt中的多媒体数据类</span></li><li><span>拖放事件通过 QMimeData 对象传递数据</span></li><li><span>QMimeData 支持多种不同类型的多媒体数据</span></li></ul><p><span>常用 MIME 类型数据处理函数</span></p><hr /><p><span>自定义拖放事件：</span></p><ol><li><p><span>接收拖放事件的对象调用 </span><strong><span>setAcceptDrops</span></strong><span> 成员函数</span></p></li><li><p><span>重写 </span><strong><span>drapEnterEvent</span></strong><span> 函数并判断 MIME 类型</span></p><p><span>期望数据：e-&gt;acceptProposedAction();</span></p><p><span>其它数据：e-&gt;ignore();</span></p></li><li><p><span>重写 </span><strong><span>dropEvent</span></strong><span> 函数比判断MIME类型</span></p><p><span>期望数据：从事件对象中获取 MIME 数据并处理</span></p><p><span>其它：e-&gt;ignore();</span></p></li></ol><h4><a name="263-编辑交互功能" class="md-header-anchor"></a><span>2.6.3 编辑交互功能</span></h4><p><span>编辑器中的常规编辑交互功能</span></p><p><span>复制 copy 、粘贴 psate 、剪切 cut 、撤销 undo、重做 redo 、删除 delete</span></p><p>&nbsp;</p><p><span>QPlainTextEdit 中有 </span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-variable">slots：</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">void</span> <span class="cm-def">copy</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">void</span> <span class="cm-def">undo</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">signal</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">void</span> <span class="cm-def">copyAvailable</span>(<span class="cm-variable-3">bool</span> <span class="cm-variable">yes</span>);</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">bool</span> <span class="cm-def">undoChanged</span>();</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><h4><a name="264-文本打印与光标定位" class="md-header-anchor"></a><span>2.6.4 文本打印与光标定位</span></h4><p><span>QPlainTextEdit 只负责界面形态的显示 内部</span></p><p><span>通过 QTextDocument 对象存储文本数据</span></p><ul><li><span>设置文本属性：排版，字体，标题等</span></li><li><span>获取文本参数：行数，文本宽度，文本信息</span></li><li><span>实现标准操作：撤销，重做，查找，打印</span></li></ul><p><span>QTextCursor 对象提供光标相关的信息</span></p><h4><a name="265-发送自定义事件" class="md-header-anchor"></a><span>2.6.5 发送自定义事件</span></h4><hr /><p><mark><span>发送预定义事件</span></mark></p><p><span>Qt可以在程序中主动发送事件</span></p><ol><li><p><span>阻塞型事件发送：事件发送后需要等待事件处理完成，完成后才返回</span></p><p><span>bool sendEvent(QObject* receiver, QEvent* event)</span></p><p><strong><span>同时支持栈事件对象和堆事件对象</span></strong><span>的发送</span></p></li><li><p><span>非阻塞型事件发送：事件发送后立即返回，事件被发送到事件队列中等待处理</span></p><p><span>void postEvent(QObject* receiver, QEvent* event)</span></p><p><strong><span>只能发送堆事件对象</span></strong><span>，事件被处理后由 Qt 平台销毁</span></p></li></ol><p><span>消息发送可以理解为：在 sendEvent() 内部直接调用Qt对象的 event()</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">testSendEvent</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QMouseEvent</span> <span class="cm-variable">dbcEvt</span>(<span class="cm-variable">QEvent::MouseButtonDbClick</span>,<span class="cm-variable">QPoint</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>),<span class="cm-variable">Qt::LeftButton</span>,<span class="cm-variable">Qt::NoButton</span>,<span class="cm-variable">Qt::NoModifier</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QApplication::sendEvent</span>(<span class="cm-keyword">this</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">dbcEvt</span>);<span class="cm-tab" role="presentation" cm-text="	">  </span> &nbsp;<span class="cm-comment">// 发送给 this 一个事件  dbcEvt，该事件处理完才往下执行</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">testPostEvent</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QMouseEvent</span><span class="cm-operator">*</span> <span class="cm-variable">dbcEvt</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QMouseEvent</span>(<span class="cm-variable">QEvent::MouseButtonDbClick</span>,<span class="cm-variable">QPoint</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>),<span class="cm-variable">Qt::LeftButton</span>,<span class="cm-variable">Qt::NoButton</span>,<span class="cm-variable">Qt::NoModifier</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QApplication::postEvent</span>(<span class="cm-keyword">this</span>,<span class="cm-variable">dbcEvt</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><span>案例：点击按钮，实现键盘的 delete 功能</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">MainEditor::OnDeleteClicked</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QKeyEvent</span> <span class="cm-variable">keyPress</span>(<span class="cm-variable">QEvent::KeyPress</span>,<span class="cm-variable">Qt::Key_Delete</span>,<span class="cm-variable">Qt::NoModifier</span>); &nbsp;<span class="cm-comment">// NoModifier 是指该键没有和shift等组合按下</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QKeyEvent</span> <span class="cm-variable">keyRelease</span>(<span class="cm-variable">QEvent::KeyRelease</span>,<span class="cm-variable">Qt::Key_Delete</span>,<span class="cm-variable">Qt::NoModifier</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QApplication::sendEvent</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">mainEditor</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">keyPress</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QApplication::sendEvent</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">mainEditor</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">keyRelease</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><span>delete 可以删除空白行</span></p><hr /><p><mark><span>发送自定义事件</span></mark></p><p><span>自定义的事件类</span><strong><span>必须继承自 QEvent</span></strong></p><p><span>自定义的事件类</span><strong><span>必须拥有全局唯一的 Type 值</span></strong></p><p><span>程序中</span><strong><span>必须提供处理自定义事件对象的办法</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">StringEvent</span> : <span class="cm-keyword">public</span> <span class="cm-variable">QEvent</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QString</span> <span class="cm-variable">str</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">static</span> <span class="cm-keyword">const</span> <span class="cm-variable">Type</span> <span class="cm-variable">TYPE</span> <span class="cm-operator">=</span> <span class="cm-keyword">static_cast</span><span class="cm-operator">&lt;</span><span class="cm-variable">Type</span><span class="cm-operator">&gt;</span>(<span class="cm-variable">QEvent::User</span> <span class="cm-operator">+</span> <span class="cm-number">0xFF</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QString</span> <span class="cm-variable">data</span>(){ <span class="cm-keyword">return</span> <span class="cm-variable">str</span>; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* 发送 */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">StringEvent</span> <span class="cm-def">strEvent</span>(<span class="cm-string">"zzh"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QApplication::sendEvent</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">mainEditor</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">strEvent</span>); </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* 处理 */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-def">eventFilter</span>(<span class="cm-variable">QObject</span><span class="cm-operator">*</span> <span class="cm-variable">obj</span>,<span class="cm-variable">QEvent</span><span class="cm-operator">*</span> <span class="cm-variable">event</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>( (<span class="cm-variable">obj</span> <span class="cm-operator">==</span> <span class="cm-operator">&amp;</span><span class="cm-variable">mainEditor</span>)<span class="cm-operator">&amp;&amp;</span> (<span class="cm-variable">event</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>() <span class="cm-operator">==</span> <span class="cm-variable">StringEvent::TYPE</span>) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">StringEvent</span><span class="cm-operator">*</span> <span class="cm-variable">se</span> <span class="cm-operator">=</span> <span class="cm-keyword">dynamic_cast</span><span class="cm-operator">&lt;</span><span class="cm-variable">StringEvent</span><span class="cm-operator">*&gt;</span>(<span class="cm-variable">event</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"received:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">se</span><span class="cm-operator">-&gt;</span><span class="cm-variable">data</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">true</span>; &nbsp;<span class="cm-comment">// 表示该事件已被处理</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">QWidget::eventFilter</span>(<span class="cm-variable">obj</span>,<span class="cm-variable">event</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 506px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><hr /><p><span>事件的 Type 值</span></p><ul><li><span>每个事件类拥有</span><strong><span>全局唯一</span></strong><span>的 Type 值</span></li><li><strong><span>自定义事件类的Type 值也需要自定义</span></strong></li><li><span>自定义事件类使用 QEvent::User 之后的值作为 Type 值</span></li><li><span>程序中保证 </span><strong><span>QEvent::User + VALUE 全局唯一</span></strong><span>即可</span></li></ul><hr /><p><span>处理自定义事件对象，两种方法</span></p><ol><li><p><span>将</span><strong><span>事件过滤器</span></strong><span>安装到目标对象</span></p><p><span>在eventFilter() 中编写自定义事件处理逻辑</span></p></li><li><p><span>在目标对象的类中</span><strong><span>重写事件处理函数</span></strong></p><p><span>在 event() 函数中编写自定义事件的处理逻辑</span></p></li></ol><hr /><p><span>要自定义事件类的场景</span></p><ul><li><span>需要</span><strong><span>扩展</span></strong><span>一个已有组件类的功能</span></li><li><span>需要开发一个</span><strong><span>全新功能</span></strong><span>的组件类</span></li><li><span>需要向一个</span><strong><span>第三方的组件类</span></strong><span>发送消息</span></li></ul><h3><a name="27-调色板" class="md-header-anchor"></a><span>2.7 调色板</span></h3><p><span>调色板是存储组件颜色信息的数据结构，窗口组件内部都拥有 QPalette 对象</span></p><figure><table><thead><tr><th>&nbsp;</th><th><span>WindowText</span></th><th><span>ButtonText</span></th></tr></thead><tbody><tr><td><strong><span>Active</span></strong></td><td><span>black</span></td><td><span>blue</span></td></tr><tr><td><strong><span>Inactive</span></strong></td><td><span>black</span></td><td><span>blue</span></td></tr><tr><td><strong><span>Disable</span></strong></td><td><span>gray</span></td><td><span>gray</span></td></tr></tbody></table></figure><p><span>QPalette 类包含了组件状态和颜色组</span></p><p><span>三个状态的颜色描述</span></p><ol><li><span>激活颜色组 </span><strong><span>Active</span></strong><span>：组件</span><strong><span>获得焦点</span></strong><span>使用的颜色搭配方案</span></li><li><span>非激活颜色组 </span><strong><span>Inactive</span></strong><span>：</span><strong><span>失去焦点</span></strong><span>使用的颜色方案</span></li><li><span>失效颜色组 </span><strong><span>Disable</span></strong><span>：组件处于</span><strong><span>不可用状态</span></strong><span>使用的颜色方案 </span></li></ol><p><span>QPalette 的颜色组定义了组细节的颜色值</span></p><p><span>QPalette ::ColorRole 中的常量值用于标识组件细节</span></p><p><span>使用</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p</span> <span class="cm-operator">=</span> <span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">plainTextEdit</span><span class="cm-operator">-&gt;</span><span class="cm-variable">palette</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p</span>.<span class="cm-variable">setColor</span>(<span class="cm-variable">QPalette::Active</span>,<span class="cm-variable">QPalette::Highlight</span>,<span class="cm-variable">Qt::red</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p</span>.<span class="cm-variable">setColor</span>(<span class="cm-variable">QPalette::Inactive</span>,<span class="cm-variable">QPalette::Highlight</span>,<span class="cm-variable">Qt::red</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p</span>.<span class="cm-variable">setColor</span>(<span class="cm-variable">QPalette::Inactive</span>,<span class="cm-variable">QPalette::HighlightedText</span>,<span class="cm-variable">Qt::white</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">plainTextEdit</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setPalette</span>(<span class="cm-variable">p</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPalette</span> <span class="cm-variable">p</span> <span class="cm-operator">=</span> <span class="cm-variable">mainEditor</span>.<span class="cm-variable">palette</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p</span>.<span class="cm-variable">setColor</span>(<span class="cm-variable">QPalette::Inactive</span>,<span class="cm-variable">QPalette::Highlight</span>,<span class="cm-variable">p</span>.<span class="cm-variable">color</span>(<span class="cm-variable">QPalette::Active</span>,<span class="cm-variable">QPalette::Highlight</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p</span>.<span class="cm-variable">setColor</span>(<span class="cm-variable">QPalette::Inactive</span>,<span class="cm-variable">QPalette::HighlightedText</span>,<span class="cm-variable">p</span>.<span class="cm-variable">color</span>(<span class="cm-variable">QPalette::Active</span>,<span class="cm-variable">QPalette::HighlightedText</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mainEditor</span>.<span class="cm-variable">setPalette</span>(<span class="cm-variable">p</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><h3><a name="28-程序中的配置文件" class="md-header-anchor"></a><span>2.8 程序中的配置文件</span></h3><p><span>应用程序在运行后都有一个初始化的状态（最近一次运行退出前的状态）</span></p><hr /><p><span>解决思路：</span></p><ul><li><span>程序退出前保存状态参数到文件（数据库）</span></li><li><span>程序再次启动时读出状态参数并恢复</span></li></ul><hr /><p><span>参数状态的存储方式：</span></p><ul><li><span>文本文件格式（XML，JSon，等）</span></li><li><span>轻量级数据库（Access，SQLite 等）</span></li><li><strong><span>私有二进制文件格式</span></strong></li></ul><p><span>通过二进制数据流（QDataStream）将状态参数直接存储与文件中</span></p><p><span>优势：</span></p><ul><li><strong><span>参数的存储和读取简单高效</span></strong><span>，易于编码实现</span></li><li><span>最终文件为二进制格式，</span><strong><span>不易被恶意修改</span></strong></li></ul><h3><a name="29-命令行参数的应用" class="md-header-anchor"></a><span>2.9 命令行参数的应用</span></h3><hr /><p><span>如何保存主窗口的大小</span></p><p><span>应用程序退出的过程：</span></p><ol><li><span>收到关闭事件</span></li><li><strong><span>执行关闭事件处理函数</span></strong></li><li><span>主窗口从屏幕上消失</span></li><li><span>主窗口的析构函数执行</span></li></ol><p><span>一般而言，受到关闭事件时进行状态参数的保存</span></p><p><span>Qt中：</span></p><ol><li><span>重写关闭事件处理函数</span></li><li><span>在关闭处理函数中保存状态参数</span></li></ol><hr /><p><span>每一个应用程序都能接收命令行参数</span></p><p><span>传统应用方式：在命令行启动 GUI 程序时传递参数 notepad text.txt</span></p><p><span>操作系统关联的方式：1. 在文件被双击时，操作系统根据文件后缀选择应用程序</span></p><p><span>									</span><span>3. 将文件绝对路径作为命令行参数启动应用程序</span></p><h3><a name="210多页面切换组件-qtabwidget" class="md-header-anchor"></a><span>2.10多页面切换组件 QTabWidget</span></h3><p><span>能够在同一个窗口中</span><strong><span>自由切换不同页面</span></strong><span>的内容</span></p><p><span>是一个</span><strong><span>容器类型的组件</span></strong><span>，同时提供友好的页面切换</span></p><p><span>使用</span></p><ol><li><span>创建容器类型的 QWidget 组件对象</span></li><li><span>将多个子组件在容器对象中布局</span></li><li><span>将容器对象加入QTabWidget中生成新的页面</span></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QTabWidget</span> <span class="cm-variable">m_tabWidget</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_tabWidget</span>.<span class="cm-variable">setParent</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_tabWidget</span>.<span class="cm-variable">setGeometry</span>(<span class="cm-number">10</span>,<span class="cm-number">10</span>,<span class="cm-number">200</span>,<span class="cm-number">200</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPlainTextEdit</span><span class="cm-operator">*</span> <span class="cm-variable">edit</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QPlainTextEdit</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">m_tabWidget</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">edit</span><span class="cm-operator">-&gt;</span><span class="cm-variable">insertPlainText</span>(<span class="cm-string">"1st tab page"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_tabWidget</span>.<span class="cm-variable">addTab</span>(<span class="cm-variable">edit</span>,<span class="cm-string">"1st"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QWidget</span><span class="cm-operator">*</span> <span class="cm-variable">widget</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QWidget</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">m_tabWidget</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QLabel</span><span class="cm-operator">*</span> <span class="cm-variable">lbl</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QLabel</span>(<span class="cm-variable">widget</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPushButton</span><span class="cm-operator">*</span> <span class="cm-variable">btn</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QPushButton</span>(<span class="cm-variable">widget</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">btn</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setText</span>(<span class="cm-string">"btn"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QVBoxLayout</span><span class="cm-operator">*</span> <span class="cm-variable">layout</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QVBoxLayout</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">lbl</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">layout</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addWidget</span>(<span class="cm-variable">btn</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">widget</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setLayout</span>(<span class="cm-variable">layout</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_tabWidget</span>.<span class="cm-variable">addTabWidget</span>(<span class="cm-variable">widget</span>,<span class="cm-string">"2nd"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 506px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><p><span>高级用法：</span></p><ul><li><span>设置 Tab 标签的位置 North，South，West, East</span></li><li><span>设置 Tab 的外观 Rounded，Triangular</span></li><li><span>设置 Tab 的</span><strong><span>可关闭模式</span></strong></li></ul><p><span>预定义信号</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">currentChanged</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">index</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">tabCloseRequested</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">index</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><h3><a name="211-模型视图设计模式" class="md-header-anchor"></a><span>2.11 模型视图设计模式</span></h3><p><mark><span>核心思想</span></mark></p><ul><li><span>模型（数据）与视图（显示）相分离</span></li><li><span>模型提供对外标准接口存储数据（不关心数据如何显示）</span></li><li><span>视图自定义数据的显示模式（不关心数据如何组织存储）</span></li></ul><hr /><p><mark><span>工作机制</span></mark></p><ul><li><span>当数据发生变化时：模型发出信号通知视图</span></li><li><span>当用户与视图进行交互时：视图发出信号提供交互信息</span></li></ul><hr /><p><span>Qt 内置了支持模型视图的开发方式</span></p><p><span>模型用于定义数据的显示方式，不关心数据的组织方式</span></p><p><span>模型如何为数据提供统一的访问方式</span></p><p><span>Qt中，</span><strong><span>不管模型以什么结构组织数据，都必须为每一个数据提供独一无二的索引</span></strong><span>；视图通过索引访问模型中的具体数据</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_treeView</span>.<span class="cm-variable">setParent</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_treeView</span>.<span class="cm-variable">setGeometry</span>(<span class="cm-number">10</span>,<span class="cm-number">10</span>,<span class="cm-number">500</span>,<span class="cm-number">500</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_fileSystemModel</span>.<span class="cm-variable">setRootPath</span>(<span class="cm-variable">QDir::currentPath</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_treeView</span>.<span class="cm-variable">setModel</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">m_fileSystemModel</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_treeView</span>.<span class="cm-variable">setRootIndex</span>(<span class="cm-variable">m_fileSystemModel</span>.<span class="cm-variable">index</span>(<span class="cm-variable">QDir::currentPath</span>()));</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><ul><li><span>模型</span><strong><span>定义标准接口</span></strong><span>（成员函数）对数据进行访问</span></li><li><span>视图</span><strong><span>通过标准接口</span></strong><span>获取数据并定义显示方式</span></li><li><span>模型使用</span><strong><span>信号槽机制</span></strong><span>通知视图数据变化</span></li><li><span>模型中的数据都是</span><strong><span>以层次结构表示的</span></strong></li></ul><p><mark><span>模型索引</span></mark><span>是数据与视图分离的重要机制</span></p><p><mark><span>QModelIndex</span></mark><span> 是 Qt 中的模型索引类：包含具体数据的访问途径，包含一个指向模型的指针</span></p><ol><li><span>线性模型可以使用 （row，column）作为数据索引</span></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QModelIndex</span> <span class="cm-variable">indexA</span> <span class="cm-operator">=</span> <span class="cm-variable">model</span><span class="cm-operator">-&gt;</span><span class="cm-variable">index</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><ol start='2' ><li><p><span>非线性模型</span></p><p><span>树：（index，parent）作为索引 parent下编号为index的节点</span></p></li><li><p><span>通用方式：</span><strong><span>三元组</span></strong><span>：（row，column，parent）</span></p><p><span>当父节点为虚拟root节点时，可以使用空索引（直接调用 QModelIndex() 产生）作为父节点参数</span></p></li></ol><p><span>特殊的模型可以自定义特殊的索引获取方式，如 QFileSystemModel</span></p><p><span>不同的视图如何显示同一模型的数据</span></p><p><span>Qt 标准模型定义</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QStandardItem</span><span class="cm-operator">*</span> <span class="cm-variable">root</span> <span class="cm-operator">=</span> <span class="cm-variable">m_model</span>.<span class="cm-variable">invisibleRootItem</span>();</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QStandardItem</span><span class="cm-operator">*</span> <span class="cm-variable">itemA</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QStandardItem</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QStandardItem</span><span class="cm-operator">*</span> <span class="cm-variable">itemB</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QStandardItem</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QStandardItem</span><span class="cm-operator">*</span> <span class="cm-variable">itemC</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QStandardItem</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">itemA</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setData</span>(<span class="cm-string">"A1"</span>); <span class="cm-variable">itemA</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setData</span>(<span class="cm-string">"A2"</span>); <span class="cm-variable">itemA</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setData</span>(<span class="cm-string">"A3"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">itemB</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setData</span>(<span class="cm-string">"B1"</span>); <span class="cm-variable">itemB</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setData</span>(<span class="cm-string">"B2"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">itemC</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setData</span>(<span class="cm-string">"C1"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">root</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setChild</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>,<span class="cm-variable">itemA</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">root</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setChild</span>(<span class="cm-number">0</span>,<span class="cm-number">1</span>,<span class="cm-variable">itemB</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">root</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setChild</span>(<span class="cm-number">0</span>,<span class="cm-number">2</span>,<span class="cm-variable">itemC</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_tableView</span>.<span class="cm-variable">setParent</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_tableView</span>.<span class="cm-variable">setGeometry</span>(<span class="cm-number">10</span>,<span class="cm-number">10</span>,<span class="cm-number">400</span>,<span class="cm-number">400</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* 连接模型与视图 */</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_tableView</span>.<span class="cm-variable">setModel</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">m_model</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 418px;"></div><div class="CodeMirror-gutters" style="display: none; height: 418px;"></div></div></div></pre><p><mark><span>数据角色</span></mark></p><ul><li><span>模型中的数据在视图中的用途（</span><strong><span>显示方式</span></strong><span>）可能不同</span></li><li><span>模型必须为数据设置特定数据角色（</span><strong><span>数据属性</span></strong><span>）</span></li><li><strong><span>数据角色用于提示视图数据的作用</span></strong></li><li><span>数据角色是不同视图以</span><strong><span>统一风格显示数据的标准</span></strong></li></ul><p><span>常用数据角色</span></p><figure><table><thead><tr><th><span>Qt::DisplayRole</span></th><th><span>用于以文本形式显示数据QString</span></th></tr></thead><tbody><tr><td><span>Qt::EditRole</span></td><td><span>用于文本数据的编辑QString</span></td></tr><tr><td><span>Qt::ToolTipRole</span></td><td><span>当鼠标处于选中的数据时，显示出数据的相关提示QString</span></td></tr><tr><td><span>Qt::SizeHintRole</span></td><td><span>可以提示相应大小QSize</span></td></tr></tbody></table></figure><p><span>意义</span></p><ul><li><span>定义了数据在特定系统下的标准用途</span></li><li><span>不同的视图可以通过相同标准显示数据</span></li></ul><h4><a name="2111-自定义模型类" class="md-header-anchor"></a><span>2.11.1 自定义模型类</span></h4><p><span>QStandardItemModel 是一个通用的模型类</span></p><ul><li><span>能够以</span><strong><span>任意的方式</span></strong><span>组织数据（线性，非线性）</span></li><li><span>数据组织的基本单位为</span><strong><span>数据项</span></strong><span>（</span><strong><span>QStandardItem</span></strong><span>）</span></li></ul><ul><li><span>每一个数据项能够</span><strong><span>存储多个具体数据</span></strong><span>（附加数据角色）</span></li><li><span>每一个数据项能够</span><strong><span>对数据状态进行控制</span></strong><span>（可编辑，可选）</span></li></ul><p><span>变体类型 QVariant</span></p><p><span>用于封装的类型，能够表示大多数常见的值类型，每次只能封装（保存）单一类型的值</span></p><p><span>意义在于能够设计“</span><strong><span>返回类型可变的函数</span></strong><span>”</span></p><hr /><p><span>工程中常用模型设计</span></p><ul><li><strong><span>解析数据源中的数据</span></strong><span>（数据库、网络、串口等）</span></li><li><span>将解析后的数据存入 </span><strong><span>QStandardItem</span></strong><span> 对象中</span></li><li><span>根据数据间的关系在 </span><strong><span>QStandardItemModel</span></strong><span> 对象中组织数据项</span></li><li><strong><span>选择合适的视图显示数据值</span></strong></li></ul><hr /><p><span>工程中数据应用架构为4层结构（系统架构）</span></p><p><span>数据层 data source，如类DataSource，用于抽象表示数据的来源</span></p><p><span>数据表示层 data object，如ScoreInfo，</span></p><p><span>数据组织层 model，如ScoreInfoModel，用于从数据源获取数据并组织</span></p><p><span>数据显示层 view，如QTabView，用于显示模型中的数据</span></p><blockquote><p><span>优点：易于扩展和维护</span></p></blockquote><p><span>DataSource：设置数据源并读取数据，对数据进行解析后生成数据对象</span></p><p><span>ScoreInfo：封装数据源中的一组完整数据，提供返回具体数据值的接口函数 </span></p><p><span>ScoreInfoModel：使用QStandardItemModel作为成员，以ScoreInfo类对象为最小单元进行数据组织</span></p><hr /><p><span>架构图：定义模块功能</span></p><p><span>类图：定义具体功能的接口</span></p><p><span>流程图：定义类对象间的交互</span></p><p><span>模块实现结束后需进行单元测试</span></p><hr /><p><span>鼠标右键上下文菜单的实现</span></p><ol><li><span>定义菜单对象 </span><strong><span>QMenu</span></strong></li><li><span>连接菜单中的 </span><strong><span>QAction</span></strong><span> 对象到槽函数</span></li><li><span>定义事件过滤器，并处理 </span><strong><span>ContextMenu</span></strong><span> 事件</span></li><li><span>在当前鼠标的位置打开菜单对象</span></li></ol><p><span>fetchData() 只能取一次，取一次，清空一次</span></p><p><span>getData() 可以一直取</span></p><h4><a name="2112-模型视图中的委托" class="md-header-anchor"></a><span>2.11.2 模型视图中的委托</span></h4><p><span>传统的 MVC 设计模式：</span></p><p><span>	</span><span>Model 模型负责数据组织</span></p><p><span>	</span><span>View 视图负责数据显示</span></p><p><span>	</span><span>Controller 控制器负责用户输入</span></p><hr /><p><span>Qt中的模型视图设计模式借鉴了 MVC</span></p><p><span>模型负责组织数据，视图负责显示数据，如何编辑修改数据</span></p><p><span>视图中集成了处理用户输入的功能，视图将用户输入作为内部独立的子功能而实现（即将 View 与 Controller 结合了）</span></p><p><span>模型视图中的委托 Delegate</span></p><ul><li><span>是视图中</span><strong><span>处理用户输入的部件</span></strong></li><li><span>视图可以设置委托对象用于处理用户输入</span></li><li><strong><span>委托对象负责创建和显示用户输入上下文</span></strong></li></ul><p><span>标准委托功能：QItemDelegate</span></p><p><span>自定义委托：QCustomizeDelegate</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">m_view</span>.<span class="cm-variable">itemDelegate</span>(); &nbsp;<span class="cm-comment">// 当前的视图的默认委托，是QStyledItemDelegate类</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><hr /><p><span>委托中的编辑器：</span></p><ul><li><span>提供编辑时需要的上下文环境（编辑器）</span></li><li><span>不同委托提供的编辑器类型不同（文本框，单选框等）</span></li><li><span>编辑器能够从模型获取数据，并将编辑结果返回模型</span></li></ul><p><span>createEditor，创建编辑器组件</span></p><p><span>updateEidtorGeometry，更新编辑器组件大小</span></p><p><span>setEditorData，通过索引从模型获取数据</span></p><p><span>setModelData，将编辑后的数据返回模型</span></p><p><span>关键信号：</span></p><p><span>void closeEditor(QWidget* editor, QAbstractItemDelegate::EndEditHint hint)  </span></p><p><span>void commitData(QWidget* editor)</span></p><hr /><p><span>委托的本质：</span></p><ul><li><span>为视图提供数据编辑的上下文环境</span></li><li><span>产生界面元素的工厂类</span></li><li><span>能够使用和设置模型中的数据</span></li></ul><hr /><h4><a name="2113-自定义委托" class="md-header-anchor"></a><span>2.11.3 自定义委托</span></h4><p><span>当预定义的委托无法满足需求，就自定义委托类（重写以下虚函数）</span></p><ol><li><span>createEditor</span></li><li><span>updateEditorGeometry</span></li><li><span>setEditorData</span></li><li><span>setModelData</span></li><li><span>paint(可选)</span></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QWidget</span><span class="cm-operator">*</span> <span class="cm-def">createEditor</span>() <span class="cm-keyword">const</span> &nbsp;<span class="cm-comment">// 根据不同的数据类型创建不同的编辑器</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QWidget</span><span class="cm-operator">*</span> <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">NULL</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>(<span class="cm-variable">index</span>.<span class="cm-variable">data</span>().<span class="cm-variable">type</span> <span class="cm-operator">==</span> <span class="cm-variable">QVariant::Bool</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span> <span class="cm-comment">/* 创建 checkbox */</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span> <span class="cm-keyword">if</span>(<span class="cm-variable">index</span>.<span class="cm-variable">data</span>().<span class="cm-variable">type</span> <span class="cm-operator">==</span> <span class="cm-variable">QVariant::Char</span>){ &nbsp;<span class="cm-comment">/* 创建 combobox */</span>  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span> ()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-variable">ret</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 264px;"></div><div class="CodeMirror-gutters" style="display: none; height: 264px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">updateEditorGeometry</span>(<span class="cm-variable">QWidget</span><span class="cm-operator">*</span> <span class="cm-variable">editor</span>,<span class="cm-keyword">const</span> <span class="cm-variable">QStyleOptionVievItem</span><span class="cm-operator">&amp;</span> <span class="cm-variable">option</span>,<span class="cm-keyword">const</span> <span class="cm-variable">QModelIndex</span><span class="cm-operator">&amp;</span> <span class="cm-variable">index</span>) <span class="cm-keyword">const</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">editor</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setGeometry</span>(<span class="cm-variable">option</span>.<span class="cm-variable">rect</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span> 创建的是什么类型的编辑器，setEditorData设置编辑器的初始数据</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">setEditorData</span>(<span class="cm-variable">QWidget</span><span class="cm-operator">*</span> <span class="cm-variable">editor</span>,<span class="cm-keyword">const</span> <span class="cm-variable">QModelIndex</span><span class="cm-operator">&amp;</span> <span class="cm-variable">index</span>) <span class="cm-keyword">const</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>(<span class="cm-variable">index</span>.<span class="cm-variable">data</span>().<span class="cm-variable">type</span>() <span class="cm-operator">==</span> <span class="cm-variable">QVariant::Bool</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QCheckBox</span><span class="cm-operator">*</span> <span class="cm-variable">cb</span> <span class="cm-operator">=</span> <span class="cm-keyword">dynamic_cast</span><span class="cm-operator">&lt;</span><span class="cm-variable">QCheckBox</span><span class="cm-operator">*&gt;</span>(<span class="cm-variable">editor</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><span>根据参数中的数据索引更改模型中的数据</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">setModel</span>(<span class="cm-variable">QWdiget</span><span class="cm-operator">*</span> <span class="cm-variable">editor</span>,<span class="cm-variable">QAbstractItemModel</span> <span class="cm-operator">*</span><span class="cm-variable">model</span>,<span class="cm-keyword">const</span> <span class="cm-variable">QModelIndex</span><span class="cm-operator">&amp;</span> <span class="cm-variable">index</span>) <span class="cm-keyword">const</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>(<span class="cm-variable">index</span>.<span class="cm-variable">data</span>().<span class="cm-variable">type</span>() <span class="cm-operator">==</span> <span class="cm-variable">QVariant::Bool</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QCheckBox</span><span class="cm-operator">*</span> <span class="cm-variable">cb</span> <span class="cm-operator">=</span> <span class="cm-keyword">dynamic_cast</span><span class="cm-operator">&lt;</span><span class="cm-variable">QCheckBox</span><span class="cm-operator">*&gt;</span>(<span class="cm-variable">editor</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><p><span>paint函数在每次视图刷新时都会被调用，paint 作用是 显示 模型中的所有数据</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">paint</span>(<span class="cm-variable">QPainter</span><span class="cm-operator">*</span> <span class="cm-variable">painter</span>,<span class="cm-keyword">const</span> <span class="cm-variable">QStyleOptionViewItem</span><span class="cm-operator">&amp;</span> <span class="cm-variable">option</span>,<span class="cm-keyword">const</span> <span class="cm-variable">QModelIndex</span><span class="cm-operator">&amp;</span> <span class="cm-variable">index</span>) <span class="cm-keyword">const</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>(){ <span class="cm-comment">/* 自定义绘图动作 */</span>  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span>{ <span class="cm-variable">QItemDelegate::paint</span>(<span class="cm-variable">painter</span>,<span class="cm-variable">option</span>,<span class="cm-variable">index</span>); }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>在重写函数时，很多函数都是const，不允许修改成员变量，方法： mutable bool flag; 这样在 const 函数也可修改 flag 的值</span></p><p><span>自定义委托类需重写相应的成员函数</span></p><ul><li><span>根据需要创建编辑组件并设置组件中的数据</span></li><li><span>编辑结束后将数据返回模型</span></li><li><span>成员函数的参数携带了数据存取时需要的信息</span></li></ul><h4><a name="2114-视图与委托" class="md-header-anchor"></a><span>2.11.4 视图与委托</span></h4><p><span>委托是视图的构成部分，那么委托需要承担数据显示的部分工作</span></p><ul><li><span>视图负责确定</span><strong><span>数据项的组织显示形式</span></strong><span>（列表、树形、表格）</span></li><li><span>委托负责</span><strong><span>具体数据项的显示和编辑</span></strong><span>（数据值，编辑器）</span></li><li><span>视图和委托</span><strong><span>共同完成</span></strong><span>数据显示和编辑功能</span></li></ul><hr /><p><span>自定义委托的默认数据显示方式，步骤</span></p><ol><li><span>重写 paint 成员函数</span></li><li><span>在 paint中 </span><strong><span>自定义数据显示方式</span></strong></li><li><span>重写 editorEvent 成员函数</span></li><li><span>在 editorEvent 中</span><strong><span>处理交互事件</span></strong></li></ol><hr /><p><span>案例1：bool 类型数据，用 checkBox 显示</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-variable">index</span>.<span class="cm-variable">data</span>().<span class="cm-variable">type</span>() <span class="cm-operator">==</span> <span class="cm-variable">QVariant::Bool</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">bool</span> <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">index</span>.<span class="cm-variable">model</span>()<span class="cm-operator">-&gt;</span><span class="cm-variable">data</span>(<span class="cm-variable">index</span>,<span class="cm-variable">Qt::DisplayRole</span>).<span class="cm-variable">toBool</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QStyleOptionButton</span> <span class="cm-variable">checkBoxStyle</span>; <span class="cm-comment">// 组件绘制参数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">checkBoxStyle</span>.<span class="cm-variable">state</span> <span class="cm-operator">=</span> <span class="cm-variable">data</span> <span class="cm-operator">?</span> <span class="cm-variable">QStyle</span>:<span class="cm-variable">State_On</span> : <span class="cm-variable">QStyle</span>:<span class="cm-variable">State_Off</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">checkBoxStyle</span>.<span class="cm-variable">state</span> <span class="cm-operator">|=</span> <span class="cm-variable">QStyle::State_Enable</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">checkBoxStyle</span>.<span class="cm-variable">rect</span> <span class="cm-operator">=</span> <span class="cm-variable">option</span>.<span class="cm-variable">rect</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">checkBoxStyle</span>.<span class="cm-variable">rect</span>.<span class="cm-variable">setX</span>(<span class="cm-variable">option</span>.<span class="cm-variable">rect</span>.<span class="cm-variable">X</span>()<span class="cm-operator">+</span><span class="cm-variable">option</span>.<span class="cm-variable">rect</span>.<span class="cm-variable">width</span>()<span class="cm-operator">/</span><span class="cm-number">2</span><span class="cm-operator">-</span><span class="cm-number">6</span>); &nbsp;<span class="cm-comment">// checkBox 偏移</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 根据参数绘制组件（数据项自定义显示方式）</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QApplication::style</span>()<span class="cm-operator">-&gt;</span><span class="cm-variable">drawControl</span>(<span class="cm-variable">QStyle::CE_CheckBox</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">checkBoxStyle</span>,<span class="cm-variable">painter</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//QApplication::style() 返回一个类对象，里面存储了操作系统的风格</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 308px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p><span>在 editorEvent 中</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-variable">index</span>.<span class="cm-variable">data</span>().<span class="cm-variable">type</span>() <span class="cm-operator">==</span> <span class="cm-variable">QVariant::Bool</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QMouseEvent</span><span class="cm-operator">*</span> <span class="cm-variable">mouseEvent</span> <span class="cm-operator">=</span> <span class="cm-keyword">dynamic_cast</span><span class="cm-operator">&lt;</span><span class="cm-variable">QMouseEvent</span><span class="cm-operator">*&gt;</span>(<span class="cm-variable">event</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>(<span class="cm-variable">event</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>() <span class="cm-operator">==</span> <span class="cm-variable">QEvent::MouseButtonPress</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">option</span>.<span class="cm-variable">rect</span>.<span class="cm-variable">contains</span>(<span class="cm-variable">mouseEvent</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pos</span>()))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">bool</span> <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-variable">model</span><span class="cm-operator">-&gt;</span><span class="cm-variable">data</span>(<span class="cm-variable">index</span>,<span class="cm-variable">Qt::DisplayRole</span>).<span class="cm-variable">toBool</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">model_setData</span>(<span class="cm-variable">index</span>,<span class="cm-operator">!</span><span class="cm-variable">data</span>,<span class="cm-variable">Qt::DisplayRole</span>;)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><hr /><p><span>按钮二：将 Progress 从</span><strong><span>纯文本</span></strong><span>的显示方式改为 </span><strong><span>进度条+文本显示</span></strong><span> 的方式</span></p><ol><li><span>自定义新的委托类</span></li><li><span>在paint成员函数中绘制进度条显示方式</span></li><li><span>在editorEvent成员函数中禁止数据编辑操作</span></li></ol><p><span>在 paint 中</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-variable">index</span>.<span class="cm-variable">data</span>().<span class="cm-variable">type</span>() <span class="cm-operator">==</span> <span class="cm-variable">QVariant::Int</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">int</span> <span class="cm-variable">progress</span> <span class="cm-operator">=</span> <span class="cm-variable">index</span>.<span class="cm-variable">model</span>()<span class="cm-operator">-&gt;</span><span class="cm-variable">data</span>(<span class="cm-variable">index</span>,<span class="cm-variable">Qt::DisplayRole</span>).<span class="cm-variable">toInt</span>(); <span class="cm-comment">// 1. 根据索引参数获取模型中的数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QStyleOptionProgressBar</span> <span class="cm-variable">progressStyle</span>; <span class="cm-comment">// 2. 定义绘制参数对象 xxxxOption</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">progressStyle</span>.<span class="cm-variable">rect</span> <span class="cm-operator">=</span> <span class="cm-variable">option</span>.<span class="cm-variable">rect</span>; &nbsp;<span class="cm-comment">// 3. 设置具体组件绘制参数 到 xxxxOption</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">progressStyle</span>.<span class="cm-variable">minimum</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">progressStyle</span>.<span class="cm-variable">maximum</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">progressStyle</span>.<span class="cm-variable">progress</span> <span class="cm-operator">=</span> <span class="cm-variable">progress</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// 4. 根据参数对象 xxxxOption 绘制数据显示方式</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QApplication::style</span>()<span class="cm-operator">-&gt;</span><span class="cm-variable">drawControl</span>(<span class="cm-variable">QStyle::CE_ProgressBar</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">progressStyle</span>,<span class="cm-variable">painter</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-comment">//QApplication::style() 返回一个类对象，里面存储了操作系统的风格</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 308px;"></div><div class="CodeMirror-gutters" style="display: none; height: 308px;"></div></div></div></pre><p><span>在 editorEvent 中，过滤掉鼠标双击事件</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-variable">index</span>.<span class="cm-variable">data</span>().<span class="cm-variable">type</span>() <span class="cm-operator">==</span> <span class="cm-variable">QVariant::Int</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">event</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>() <span class="cm-operator">!=</span> <span class="cm-variable">QEvent::MouseButtonDblClick</span> ) &nbsp;<span class="cm-comment">// 禁用双击事件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">QItemDelegate::editorEvent</span>(<span class="cm-variable">event</span>,<span class="cm-variable">model</span>,<span class="cm-variable">option</span>,<span class="cm-variable">index</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">QItemDelegate::editorEvent</span>(<span class="cm-variable">event</span>,<span class="cm-variable">model</span>,<span class="cm-variable">option</span>,<span class="cm-variable">index</span>);</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-variable">ret</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><span>重写定义矩形范围</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable-3">int</span> <span class="cm-variable">DELTA</span> &nbsp;<span class="cm-operator">=</span> <span class="cm-number">4</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">top</span> <span class="cm-operator">=</span> <span class="cm-variable">option</span>.<span class="cm-variable">rect</span>.<span class="cm-variable">top</span>()<span class="cm-operator">+</span><span class="cm-variable">DELTA</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">left</span> <span class="cm-operator">=</span> <span class="cm-variable">option</span>.<span class="cm-variable">rect</span>.<span class="cm-variable">left</span>()<span class="cm-operator">+</span><span class="cm-variable">DELTA</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-variable">option</span>.<span class="cm-variable">rect</span>.<span class="cm-variable">width</span>()<span class="cm-operator">-</span> <span class="cm-number">2</span><span class="cm-operator">*</span><span class="cm-variable">DELTA</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-variable">option</span>.<span class="cm-variable">rect</span>.<span class="cm-variable">height</span>()<span class="cm-operator">-</span><span class="cm-number">2</span><span class="cm-operator">*</span><span class="cm-variable">DELTA</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">progressStyle</span>.<span class="cm-variable">rect</span> <span class="cm-operator">=</span> <span class="cm-variable">QRect</span>(<span class="cm-variable">left</span>,<span class="cm-variable">top</span>,<span class="cm-variable">width</span>,<span class="cm-variable">height</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><hr /><p><span>任务进度模拟</span></p><ol><li><span>定义计时器用于模拟任务进度</span></li></ol><ul><li><span>定义计算器槽函数 void timerTimeout()</span></li><li><span>在槽函数中修改模型中的数据</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QModelIndex</span> <span class="cm-variable">p1</span> <span class="cm-operator">=</span> <span class="cm-variable">m_model</span>.<span class="cm-variable">index</span>(<span class="cm-number">3</span>,<span class="cm-number">0</span>,<span class="cm-variable">QModelIndex</span>());</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QModelIndex</span> <span class="cm-variable">p2</span> <span class="cm-operator">=</span> <span class="cm-variable">m_model</span>.<span class="cm-variable">index</span>(<span class="cm-number">3</span>,<span class="cm-number">1</span>,<span class="cm-variable">QModelIndex</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QVariant</span> <span class="cm-variable">v1</span> <span class="cm-operator">=</span> (<span class="cm-variable">p1</span>.<span class="cm-variable">data</span>().<span class="cm-variable">toInt</span>()<span class="cm-operator">+</span><span class="cm-number">1</span>)<span class="cm-operator">%</span><span class="cm-number">100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QVariant</span> <span class="cm-variable">v2</span> <span class="cm-operator">=</span> (<span class="cm-variable">p2</span>.<span class="cm-variable">data</span>().<span class="cm-variable">toInt</span>()<span class="cm-operator">+</span><span class="cm-number">3</span>)<span class="cm-operator">%</span><span class="cm-number">100</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_model</span>.<span class="cm-variable">setData</span>(<span class="cm-variable">p1</span>,<span class="cm-variable">v1</span>,<span class="cm-variable">Qt::DisplayRole</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_model</span>.<span class="cm-variable">setData</span>(<span class="cm-variable">p2</span>,<span class="cm-variable">v2</span>,<span class="cm-variable">Qt::DisplayRole</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><p><span>在实际工程项目中，可使用后台线程根据实际的任务情况更新模型中的数据，从而更新数据的界面显示</span></p><h3><a name="212-基本图形绘制" class="md-header-anchor"></a><span>2.12 基本图形绘制</span></h3><p><span>QPainter ，拥有QPen（颜色，宽度，线风格），QBrush（填充风格，颜色），QFont（用于文本绘制，由字体属性组成）</span></p><p><span>QPaintDevice，是QPainter的绘画板，所有的QWidget类都继承自 QPaintDevice，因此，任意的 QWidget对象都能够作为画布绘制图形</span></p><p><span>只能在 </span><strong><span>QWidget::paintEvent</span></strong><span> 中绘制图形，是绘图上下文</span></p><p><span>工程中做法：改变绘图参数进行动态绘图</span></p><ol><li><span>根据需要确定参数对象(绘图类型，点坐标，角度等)</span></li><li><span>将参数对象存入数据集合中，如链表</span></li><li><span>在 paintevent 函数中遍历数据集合</span></li><li><span>根据参数对象绘制图形 update()</span></li></ol><p><span>坐标系</span></p><p><span>物理坐标系：设备坐标系，原点（0，0）在左上角</span></p><p><span>逻辑坐标系：</span></p><p><span>QPainter 使用逻辑坐标系绘制，默认情况下，Qt的逻辑坐标系与物理坐标系完全一致</span></p><p><span>定义视口 setViewport</span></p><p><span>定义窗口：setWindow</span></p><p><span>widget一运行就会触发绘图事件，绘图事件由 QPainter 中的 paintEvent(QPaintEvent *) 处理函数自动调用</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 首先，在 widget.h 的public 中增加 void paintEvent(QPaintEvent *)</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QPainter&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// void paintEvent(QPaintEvent *) 定义在 widget.cpp 中，如下</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 使用画笔 QcPen</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPainter</span> <span class="cm-def">painter</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPen</span> <span class="cm-def">myPen</span>(<span class="cm-variable">QClolor</span>(<span class="cm-number">255</span>,<span class="cm-number">0</span>,<span class="cm-number">0</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">myPen</span>.<span class="cm-variable">setWidth</span>(<span class="cm-number">3</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">myPen</span>.<span class="cm-variable">setStyle</span>(<span class="cm-variable">Qt::DashDotLine</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">myPen</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawLine</span>(<span class="cm-variable">QPoint</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>),<span class="cm-variable">QPoint</span>(<span class="cm-number">100</span>,<span class="cm-number">100</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 使用画刷 QBrush</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QBrush</span> <span class="cm-def">myBrush</span>(<span class="cm-variable">Qt::green</span>,<span class="cm-variable">Qt::SolidPatten</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setBrush</span>(<span class="cm-variable">myBrush</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">myPen</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawRect</span>(<span class="cm-number">200</span>,<span class="cm-number">200</span>,<span class="cm-number">50</span>,<span class="cm-number">50</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//使用渐变色</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QConicalGradient</span> <span class="cm-def">conicalGradient</span>(<span class="cm-variable">QPointF</span>(<span class="cm-number">300</span>,<span class="cm-number">300</span>),<span class="cm-number">0</span>); &nbsp;<span class="cm-comment">// 从 0 度开始，逆时针</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conicalGradient</span>.<span class="cm-variable">setColorAt</span>(<span class="cm-number">0.2</span>,<span class="cm-variable">Qt::gray</span>); &nbsp;<span class="cm-comment">// 0 ~ 0.2*360 度，渐变为 灰色</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conicalGradient</span>.<span class="cm-variable">setColorAt</span>(<span class="cm-number">0.5</span>,<span class="cm-variable">Qt::green</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conicalGradient</span>.<span class="cm-variable">setColorAt</span>(<span class="cm-number">0.7</span>,<span class="cm-variable">Qt::blue</span>); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">conicalGradient</span>.<span class="cm-variable">setColorAt</span>(<span class="cm-number">1</span>,<span class="cm-variable">Qt::yellow</span>); &nbsp; <span class="cm-comment">// 0.7*360  ~ 360 度，渐变为  黄色</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 506px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><hr /><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPainter</span> <span class="cm-def">painter</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPen</span> <span class="cm-def">myPen</span>(<span class="cm-variable">Qt::red</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">myPen</span>.<span class="cm-variable">setWidth</span>(<span class="cm-number">15</span>);</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">myPen</span>); &nbsp; <span class="cm-comment">//  == painter.setPen(QPen(Qt::red,15));  创建一个匿名对象</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><h4><a name="2121-抗锯齿和坐标系变换" class="md-header-anchor"></a><span>2.12.1 抗锯齿和坐标系变换</span></h4><ol><li><mark><span>抗锯齿 setRendeHints， 坐标系平移 translate</span></mark></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPinter</span> <span class="cm-def">painter</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPen</span> <span class="cm-def">myPen</span>(<span class="cm-variable">Qt::red</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">myPen</span>.<span class="cm-variable">setWidth</span>(<span class="cm-number">15</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">myPen</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawEllipse</span>(<span class="cm-variable">QPoint</span>(<span class="cm-number">200</span>,<span class="cm-number">200</span>),<span class="cm-number">100</span>,<span class="cm-number">100</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setRendeHints</span>(<span class="cm-variable">QPainter::Antialiasing</span>); &nbsp;<span class="cm-comment">// 对第二个圆使用 抗锯齿 操作，使得表面平滑</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">translate</span>(<span class="cm-number">200</span>,<span class="cm-number">0</span>); &nbsp;<span class="cm-comment">// 坐标系平移，x 向右平移 200，y 不变，取负值是向左平移</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawEllipse</span>(<span class="cm-variable">QPoint</span>(<span class="cm-number">200</span>,<span class="cm-number">200</span>),<span class="cm-number">100</span>,<span class="cm-number">100</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><ol start='2' ><li><mark><span>坐标系旋转 rotate，使用时，一般先平移，在旋转坐标系</span></mark></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">save</span>(); &nbsp;<span class="cm-comment">// 对坐标系进行操作之前，先保存当前的坐标系</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">QPen</span>(<span class="cm-variable">Qt::green</span>,<span class="cm-number">10</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawLine</span>(<span class="cm-variable">QPoint</span>(<span class="cm-number">20</span>,<span class="cm-number">20</span>),<span class="cm-variable">QPoint</span>(<span class="cm-number">100</span>,<span class="cm-number">100</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">rotate</span>(<span class="cm-number">90</span>); &nbsp;<span class="cm-comment">// 顺时针旋转 90 度</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">QPen</span>(<span class="cm-variable">Qt::blue</span>,<span class="cm-number">10</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawLine</span>(<span class="cm-variable">QPoint</span>(<span class="cm-number">20</span>,<span class="cm-number">20</span>),<span class="cm-variable">QPoint</span>(<span class="cm-number">100</span>,<span class="cm-number">100</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">restore</span>(); &nbsp;<span class="cm-comment">// 恢复原来坐标系</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><ol start='3' ><li><mark><span>坐标系缩放 scale</span></mark></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">save</span>(); &nbsp;<span class="cm-comment">// 对坐标系进行操作之前，先保存当前的坐标系</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">QPen</span>(<span class="cm-variable">Qt::green</span>,<span class="cm-number">5</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setBrush</span>(<span class="cm-variable">Qt::red</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawRect</span>(<span class="cm-number">300</span>,<span class="cm-number">300</span>,<span class="cm-number">50</span>,<span class="cm-number">50</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">scale</span>(<span class="cm-number">1.5</span>,<span class="cm-number">0.5</span>); &nbsp;<span class="cm-comment">// x 放大 1.5 倍， y放大 0.5 倍</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setBrush</span>(<span class="cm-variable">Qt::green</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawRect</span>(<span class="cm-number">300</span>,<span class="cm-number">300</span>,<span class="cm-number">50</span>,<span class="cm-number">50</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">restore</span>(); &nbsp;<span class="cm-comment">// 恢复原来坐标系</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><ol start='4' ><li><mark><span>坐标系扭曲 shear（不推荐使用）</span></mark></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">save</span>(); &nbsp;<span class="cm-comment">// 对坐标系进行操作之前，先保存当前的坐标系</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">QPen</span>(<span class="cm-variable">Qt::green</span>,<span class="cm-number">5</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setBrush</span>(<span class="cm-variable">Qt::red</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawRect</span>(<span class="cm-number">300</span>,<span class="cm-number">300</span>,<span class="cm-number">50</span>,<span class="cm-number">50</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">shear</span>(<span class="cm-number">0.5</span>,<span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setBrush</span>(<span class="cm-variable">Qt::black</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawRect</span>(<span class="cm-number">300</span>,<span class="cm-number">300</span>,<span class="cm-number">50</span>,<span class="cm-number">50</span>); &nbsp;<span class="cm-comment">// 扭曲后坐标变为 （450，300，50，50）变成平行四边形，每一个点的 x 坐标变成 1.5 倍</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">restore</span>(); &nbsp;<span class="cm-comment">// 恢复原来坐标系</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 176px;"></div><div class="CodeMirror-gutters" style="display: none; height: 176px;"></div></div></div></pre><h4><a name="2122-手动调用绘图事件处理函数" class="md-header-anchor"></a><span>2.12.2 手动调用绘图事件处理函数</span></h4><p><span>widget一运行就会自动触发绘图事件  paintEvent(QPaintEvent *) ，如何刷新绘图，如钟表，动画？</span></p><p><span>解决方法：手动调用 repaint() 或 update() 推荐使用 update()，会自动回调  paintEvent(QPaintEvent *) </span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QTimer</span> <span class="cm-operator">*</span><span class="cm-variable">timerID1</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QTimer</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">timerID1</span><span class="cm-operator">-&gt;</span><span class="cm-variable">start</span>(<span class="cm-number">1000</span>);</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">connect</span>(<span class="cm-variable">timerID1</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">QTimer::timeout</span>,<span class="cm-keyword">this</span>,[<span class="cm-operator">&amp;</span>](){ <span class="cm-variable">update</span>(); }); &nbsp;<span class="cm-comment">// 每隔 1s 调用 paintEvent 绘图</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><h4><a name="2133-绘制文字和路径--path-为一个容器" class="md-header-anchor"></a><span>2.13.3 绘制文字和路径  path 为一个容器</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPainter</span> <span class="cm-def">painter</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPainterPath</span> <span class="cm-variable">path</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">path</span>.<span class="cm-variable">moveTo</span>(<span class="cm-number">50</span>,<span class="cm-number">250</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">path</span>.<span class="cm-variable">moveTo</span>(<span class="cm-number">50</span>,<span class="cm-number">200</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">path</span>.<span class="cm-variable">lineTo</span>(<span class="cm-number">100</span>,<span class="cm-number">100</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pathe</span>.<span class="cm-variable">addEllipse</span>(<span class="cm-variable">QPoint</span>(<span class="cm-number">100</span>,<span class="cm-number">100</span>),<span class="cm-number">30</span>,<span class="cm-number">30</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">Qt::red</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawPath</span>(<span class="cm-variable">path</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">path</span>.<span class="cm-variable">translate</span>(<span class="cm-number">200</span>,<span class="cm-number">0</span>); &nbsp;<span class="cm-comment">// 坐标轴先 x 方向右平移 200</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">Qt::blue</span>);</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawPath</span>(<span class="cm-variable">path</span>); &nbsp;<span class="cm-comment">// 使用 path 容器，绘图</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 242px;"></div><div class="CodeMirror-gutters" style="display: none; height: 242px;"></div></div></div></pre><h4><a name="2124-绘图设备qpixmapqimage" class="md-header-anchor"></a><span>2.12.4 绘图设备_QPixmap_QImage</span></h4><p><span>Qt 中绘图工具，QWidget，QPixmap，QImage，QBitmap，QPicture</span></p><p><mark><span>QPixmap：图片类，主要用于显示图片，对于图片的显示做了优化处理，和平台有关，只能在主线程中</span></mark></p><p><mark><span>QImage：图片类，图依赖于平台的，多用于图片的传输，可以做像素级修改，可在主线程，多线程中</span></mark></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 不需要paintEvent(QPaintEvent *)</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QPainter&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QPen&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QPixmap&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QImage&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 使用 QPixmap</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPixmap</span> <span class="cm-def">pix</span>(<span class="cm-number">400</span>,<span class="cm-number">300</span>); &nbsp;<span class="cm-comment">// 画布大小 400*300</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pix</span>.<span class="cm-variable">fill</span>(<span class="cm-variable">Qt::white</span>); &nbsp; <span class="cm-comment">// 画布全白</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPainter</span> <span class="cm-def">painter</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">pix</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">QPen</span>(<span class="cm-variable">Qt::red</span>,<span class="cm-number">5</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setRenderHints</span>(<span class="cm-variable">QPainter::Antialiasing</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawEllipse</span>(<span class="cm-variable">QPoint</span>(<span class="cm-number">100</span>,<span class="cm-number">100</span>),<span class="cm-number">50</span>,<span class="cm-number">50</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pix</span>.<span class="cm-variable">save</span>(<span class="cm-string">"D://mypix.jpg"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 使用 QImage</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QImage</span> <span class="cm-def">img</span>(<span class="cm-number">400</span>,<span class="cm-number">300</span>); &nbsp; <span class="cm-comment">// 画布大小 400*300</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">img</span>.<span class="cm-variable">fill</span>(<span class="cm-variable">Qt::white</span>); &nbsp; <span class="cm-comment">// 画布全白</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPainter</span> <span class="cm-def">painter2</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">img</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter2</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">QPen</span>(<span class="cm-variable">Qt::green</span>,<span class="cm-number">5</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter2</span>.<span class="cm-variable">setRenderHints</span>(<span class="cm-variable">QPainter::Antialiasing</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter2</span>.<span class="cm-variable">drawEllipse</span>(<span class="cm-variable">QPoint</span>(<span class="cm-number">100</span>,<span class="cm-number">100</span>),<span class="cm-number">50</span>,<span class="cm-number">50</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">pix</span>.<span class="cm-variable">save</span>(<span class="cm-string">"D://myImg.jpg"</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 506px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><p><mark><span>使用 QImage 来修改图片中的像素点</span></mark></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPainter</span> <span class="cm-def">painter</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QImage</span> <span class="cm-variable">img</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">img</span>.<span class="cm-variable">load</span>(<span class="cm-string">":/image/image/demo.jpeg"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span><span class="cm-operator">=</span><span class="cm-number">0</span>;<span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-number">50</span>;<span class="cm-variable">i</span><span class="cm-operator">++</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">j</span><span class="cm-operator">=</span><span class="cm-number">0</span>;<span class="cm-variable">j</span><span class="cm-operator">&lt;</span><span class="cm-number">100</span>;<span class="cm-variable">j</span><span class="cm-operator">++</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">QRgb</span> <span class="cm-variable">rgb</span> <span class="cm-operator">=</span> <span class="cm-variable">qRgb</span>(<span class="cm-number">255</span>,<span class="cm-number">0</span>,<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">img</span>.<span class="cm-variable">setPixel</span>(<span class="cm-variable">i</span>,<span class="cm-variable">j</span>,<span class="cm-variable">rgb</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawImage</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>,<span class="cm-variable">img</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><h4><a name="2125-绘图设备qpictureqbitmap" class="md-header-anchor"></a><span>2.12.5 绘图设备_QPicture_QBitmap</span></h4><p><mark><span>QPicture：可视为一个绘图的容器，里面保存有绘图的记录和重绘制的命令，存储的形式是二进制形式，不方便打开(要用 Qt 代码打开显示)</span></mark></p><p><mark><span>QBitmap：黑白图片</span></mark></p><ol><li><span>使用 QPicture</span></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPicture</span> <span class="cm-variable">myPicture</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPainter</span> <span class="cm-def">painter</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">myPicture</span>); &nbsp;<span class="cm-comment">// == QPainter painter; painter.begin(&amp;myPicture);</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painte</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">QPen</span>(<span class="cm-variable">Qt::red</span>,<span class="cm-number">5</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawEllipse</span>(<span class="cm-variable">QPoint</span>(<span class="cm-number">100</span>,<span class="cm-number">100</span>),<span class="cm-number">50</span>,<span class="cm-number">50</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">end</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">myPicture</span>.<span class="cm-variable">save</span>(<span class="cm-string">"D://picture.jpg"</span>); &nbsp;<span class="cm-comment">// 任意后缀文件</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><span>想要显示该图片，如</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPaint</span> <span class="cm-def">painter</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPicture</span> <span class="cm-variable">mypic</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mypic</span>.<span class="cm-variable">load</span>(<span class="cm-string">"D://picture.jpg"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawPicture</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>,<span class="cm-variable">mypic</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><ol start='2' ><li><span>使用 QBitmap</span></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QBitmap</span> <span class="cm-def">mybitmap</span>(<span class="cm-number">400</span>,<span class="cm-number">300</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPainter</span> <span class="cm-def">painter2</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">mybitmap</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter2</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">QPen</span>(<span class="cm-variable">Qt::green</span>,<span class="cm-number">5</span>));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter2</span>.<span class="cm-variable">drawEllipse</span>(<span class="cm-variable">QPoint</span>(<span class="cm-number">100</span>,<span class="cm-number">100</span>),<span class="cm-number">50</span>,<span class="cm-number">50</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mybitmap</span>.<span class="cm-variable">save</span>(<span class="cm-string">"D://bitmap.jpg"</span>); &nbsp; <span class="cm-comment">// 图片为黑白的，并且会有很多不正常的像素点</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>使用 QBitmap打开图片，会自动转换为黑白图片，但是会出现很多不正常的像素点</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPaint</span> <span class="cm-def">painter</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QBitmap</span> <span class="cm-variable">mybitmap</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mybitmap</span>.<span class="cm-variable">load</span>(<span class="cm-string">"D://demo.jpeg"</span>);</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawPixmap</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>,<span class="cm-variable">mybitmap</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><h4><a name="2126-绘制弧线" class="md-header-anchor"></a><span>2.12.6 绘制弧线</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPaint</span> <span class="cm-def">painter</span>(<span class="cm-keyword">this</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPen</span> <span class="cm-variable">mypen</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mypen</span>.<span class="cm-variable">setColor</span>(<span class="cm-variable">Qt::red</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">my</span>.<span class="cm-variable">setWidth</span>(<span class="cm-number">5</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setPen</span>(<span class="cm-variable">mypen</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">setRenderHints</span>(<span class="cm-variable">QPainter::Antialiasing</span>);</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">painter</span>.<span class="cm-variable">drawArc</span>(<span class="cm-number">25</span>,<span class="cm-number">25</span>,<span class="cm-number">1550</span>,<span class="cm-number">1550</span>,<span class="cm-number">0</span>,<span class="cm-number">180</span><span class="cm-operator">*</span><span class="cm-number">16</span>); &nbsp;<span class="cm-comment">// 在 （0，0）开始 长 1550，宽1550的矩形中，画弧线，起始角度0，结束角度 180度</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 154px;"></div><div class="CodeMirror-gutters" style="display: none; height: 154px;"></div></div></div></pre><h3><a name="213-进程与线程" class="md-header-anchor"></a><span>2.13 进程与线程</span></h3><hr /><p><span>定义：</span></p><p><strong><span>程序</span></strong><span>是计算机存储系统中的</span><strong><span>数据文件</span></strong><span>（静态）</span></p><p><span>源代码程序：文本文件，描述程序行为和功能</span></p><p><span>可执行程序：二进制文件，直接加载并执行</span></p><hr /><p><strong><span>进程</span></strong><span>（动态）：广义：程序中关于某个数据集合的一次运行活动</span></p><p><span>狭义：程序被加载到内存中执行后得到进程</span></p><hr /><p><span>区别：</span></p><p><span>程序是硬盘中静态的文件（存储系统中的一段二进制表示），</span></p><p><strong><span>进程</span></strong><span>是内存中动态的</span><strong><span>运行实体</span></strong><span>（数据段、代码段、PC指针等）</span></p><hr /><p><span>联系：</span></p><p><span>一个程序可能对应多个进程（一个程序多次运行，每次运行产生一个进程）</span></p><p><span>一个进程可能包含多个程序（一个程序依赖多个其它动态库）</span></p><hr /><p><span>在当代操作系统中，资源分配的基本单位是进程，而CPU调度执行的基本单位是线程，线程是进程使用CPU资源的基本单位</span></p><p><span>线程：</span></p><ul><li><strong><span>进程内的一个执行单元</span></strong></li><li><span>操作系统中一个可调度的实体</span></li><li><span>进程中相对独立的一个执行流序列</span></li><li><span>执行时的现场数据和其它调度所需的信息</span></li></ul><ul><li><span>进程中可以存在多个线程并行执行，</span><strong><span>共享进程资源</span></strong><span>（一个进程被加载，就会产生一个主线程）</span></li><li><span>线程是被调度的执行单元，而</span><strong><span>进程不是调度单元</span></strong></li><li><strong><span>线程不能脱离进程单独存在</span></strong><span>，只能依赖于进程运行</span></li><li><span>线程有生命周期，有诞生和死亡</span></li><li><strong><span>任意线程都可以创建其它新的线程</span></strong></li></ul><hr /><p><span>总结：</span></p><ul><li><span>程序是数据文件</span></li><li><span>进程是程序运行后得到的执行实体</span></li><li><span>线程是进程内部的具体执行单元</span></li><li><span>一个进程内部可以有多个线程存在</span></li><li><span>进程是操作系统资源分配的基本单位</span></li><li><span>线程是操作系统调度执行的基本单位</span></li></ul><h4><a name="2131-多线程编程" class="md-header-anchor"></a><span>2.13.1 多线程编程</span></h4><p><span>通过 QThread 直接支持多线程，是一个跨平台的多线程解决方案</span></p><p><span>Qt 中线程以对象的形式被创建和使用</span></p><p><span>每一个线程对应着一个 QThread 对象</span></p><p><span>关键函数</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">run</span>() &nbsp;<span class="cm-comment">// 线程体函数，用于定义线程功能（执行流）</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">start</span>() &nbsp;<span class="cm-comment">// 启动函数，将线程入口地址设置为 run 函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">terminate</span>() <span class="cm-comment">// 强制结束线程（不推荐）</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>示例</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">MyThread</span>:<span class="cm-keyword">public</span> <span class="cm-variable">QThread</span> &nbsp;<span class="cm-comment">// 创建线程类</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">protected</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() &nbsp;<span class="cm-comment">// 线程入口函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-number">5</span>; <span class="cm-operator">++</span><span class="cm-variable">i</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">objectName</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">": "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">i</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">sleep</span>(<span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">MyThread</span> <span class="cm-variable">t</span>; &nbsp;<span class="cm-comment">// 创建子线程</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">t</span>.<span class="cm-variable">setObjectName</span>(<span class="cm-string">"t"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">t</span>.<span class="cm-variable">start</span>(); &nbsp;<span class="cm-comment">// 启动子线程</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><hr /><p><span>生命周期</span></p><p><span>自然死亡 run() 执行结束</span></p><p><span>非自然死亡 t.terminate()  </span></p><blockquote><p><span>在工程中，</span><strong><span>terminate() 是禁止使用的</span></strong><span>，会使得操作系统</span><strong><span>暴力终止线程</span></strong><span>，而不会考虑数据完整性，资源释放问题</span></p></blockquote><hr /><p><span>如何终止线程</span></p><ul><li><strong><span>run() 函数执行结束</span></strong><span>是优雅结束线程的唯一方式</span></li><li><span>在线程中增加标志变量 </span><strong><span>m_toStop</span></strong><span>(volatile bool)，必须使用 volatile，不允许编译器做优化</span></li><li><span>通过 m_toStop 的值判断是否需要从 run() 函数返回</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">MyThread</span>:<span class="cm-keyword">public</span> <span class="cm-variable">QThread</span> &nbsp;<span class="cm-comment">// 创建线程类</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">public</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">MyThread</span>(){ <span class="cm-variable">m_toStop</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">void</span> <span class="cm-variable">stop</span>() { <span class="cm-variable">m_toStop</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">protected</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">volatile</span> <span class="cm-variable-3">bool</span> <span class="cm-variable">m_toStop</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable-3">void</span> <span class="cm-variable">run</span>() &nbsp;<span class="cm-comment">// 线程入口函数</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">while</span>(<span class="cm-operator">!</span><span class="cm-variable">m_toStop</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">// </span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 374px;"></div><div class="CodeMirror-gutters" style="display: none; height: 374px;"></div></div></div></pre><h4><a name="2132-多线程间的同步" class="md-header-anchor"></a><span>2.13.2 多线程间的同步</span></h4><p><span>多线程编程的本质：</span><strong><span>并发性</span></strong></p><p><span>在宏观上，所有线程并行执行，多个线程间相互独立，互不干涉</span></p><p><span>线程间总是完全独立毫无依赖的吗，在特殊情况下，多线程的执行在</span><strong><span>时序上存在依赖</span></strong></p><p><span>同步：在特殊情况下，控制多线程间的相对执行顺序</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-def">QThread::wait</span>(<span class="cm-variable-3">unsigned</span> <span class="cm-variable-3">long</span> <span class="cm-variable">time</span> <span class="cm-operator">=</span> <span class="cm-variable">ULONG_MAX</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>示例</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QThread</span> <span class="cm-variable">t</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">t</span>.<span class="cm-variable">start</span>();</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">t</span>.<span class="cm-variable">wait</span>(); &nbsp;<span class="cm-comment">// 等待子线程执行结束，默认等待时间无限长</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><h4><a name="2133-多线程间的互斥" class="md-header-anchor"></a><span>2.13.3 多线程间的互斥</span></h4><p><span>多线程间除了在时序上可能产生依赖，在</span></p><p><span>如生产消费者问题</span></p><p><span>临界资源 critical resource：每次只允许一个线程进行访问（读/写）的资源</span></p><p><span>线程间的互斥（竞争）：多个线程在同一时刻都需要访问临界资源</span></p><p><strong><span>QMutex</span></strong><span> 类是一把线程锁，保证线程间的互斥</span></p><p><strong><span>利用线程锁能够保证临界资源的安全性</span></strong></p><p><span>关键成员函数</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">lock</span>() &nbsp; <span class="cm-comment">//  当锁空闲时，获取锁并继续执行；当锁被获取时，阻塞并等待锁释放</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">unlock</span>() &nbsp;<span class="cm-comment">// 释放锁（同一把锁的获取和释放必须在同一线程中成对出现）</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>示例</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QMutex</span> <span class="cm-variable">mutex</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mutex</span>.<span class="cm-variable">lock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 使用临界资源</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mutex</span>.<span class="cm-variable">unlock</span>(); &nbsp; <span class="cm-comment">// 如果mutex在调用unlock时是处于空闲状态，那么程序的行为是未定义的</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><hr /><p><span>线程死锁：线程间相互等待临界资源而造成彼此无法继续执行</span></p><p><span>发生死锁的条件：</span></p><p><span>系统中存在</span><strong><span>多个临界资源</span></strong><span>且</span><strong><span>临界资源不可抢占</span></strong></p><p><span>线程需要多个临界资源才能继续执行</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//  QThreadA 获得g_mutex_1，而QThreadB获得 g_mutex_2，则发生死锁</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ThreadA</span>:<span class="cm-keyword">public</span> <span class="cm-variable">QThread</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">protected</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-variable">run</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span> ;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span>(<span class="cm-atom">true</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">g_mutex_1</span>.<span class="cm-variable">lock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">g_mutex_2</span>.<span class="cm-variable">lock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">objectName</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"is working"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">g_mutex_2</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">g_mutex_1</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ThreadB</span>:<span class="cm-keyword">public</span> <span class="cm-variable">QThread</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">protected</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">void</span> <span class="cm-variable">run</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">int</span> <span class="cm-variable">count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span> ;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">while</span>(<span class="cm-atom">true</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">g_mutex_2</span>.<span class="cm-variable">lock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">g_mutex_1</span>.<span class="cm-variable">lock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">objectName</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"is working"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">g_mutex_1</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">g_mutex_2</span>.<span class="cm-variable">unlock</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 836px;"></div><div class="CodeMirror-gutters" style="display: none; height: 836px;"></div></div></div></pre><hr /><p><span>死锁的避免：对临界资源进行编号</span></p><ul><li><span>对所有的临界资源都分配一个唯一的序号（r1，r2，... ，rn）</span></li><li><span>对应的线程锁也分配相同的序号（m1，m2，...，mn）</span></li><li><strong><span>系统中的每个线程安装严格递增的次序请求资源</span></strong></li></ul><p><span>方法二：只使用一把线程锁，把n个资源看成一整个集合（服务器不会怎么做，客户端可以）</span></p><hr /><p><mark><span>信号量</span></mark></p><ul><li><span>信号量是特殊的线程锁</span></li><li><span>信号量允许 N 个线程同时访问临界资源</span></li><li><span>Qt 中直接支持信号量 QSemaphore</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QSemaphore</span> <span class="cm-def">sem</span>(<span class="cm-number">1</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sem</span>.<span class="cm-variable">acquire</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 使用临界资源</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sem</span>.<span class="cm-variable">release</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><p><span>QSemaphore 对象中维护了一个整型值，acquire() 会使其减1，release() 会使其加1，当该值为0时，acquire() 函数将阻塞当前线程</span></p><h4><a name="2134-多线程中的信号与槽" class="md-header-anchor"></a><span>2.13.4 多线程中的信号与槽</span></h4><p><span>QThread 继承自 QObject，可以发送信号，定义槽函数</span></p><p><span>关键信号：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">start</span>() &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 线程开始运行时发射该信号</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">finished</span>() &nbsp; &nbsp;<span class="cm-comment">// 线程完成运行时发射该信号</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">terminated</span>() &nbsp;<span class="cm-comment">// 线程异常终止时发射该信号</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>如果程序中有多个线程，槽函数是在哪个线程中执行的</span></p><ul><li><strong><span>进程中存在栈空间</span></strong><span>（区别于栈数据结构）</span></li><li><span>栈空间专门用于函数调用（保存函数参数，局部变量等）</span></li><li><strong><span>线程拥有独立的栈空间</span></strong><span>（可调用其它函数）</span></li></ul><p><span>只要函数体中没有访问临界资源的代码，同一个函数可以被多个线程同时调用，不会产生副作用</span></p><p><span>操作系统通过整型标识管理进程和线程</span></p><ul><li><span>进程拥有全局唯一的ID值（PID）</span></li><li><span>线程有进程内唯一的ID值（TID）</span></li></ul><p><span>QThread 中的关键静态成员函数</span></p><ul><li><span>QThread * currentThread()</span></li><li><span>Qt::HANDLE currentThreadId()</span></li></ul><p><span>对象依附于哪一个线程</span></p><p><span>线程的依附性与槽函数执行的关系</span></p><p><span>对象的依附性是否可以改变</span></p><p><span>默认情况下：</span><strong><span>对象依附于自身被创建的线程</span></strong><span>，例如对象在main函数（主线程）中被创建，则依附于主线程</span></p><p><span>默认情况下：槽函数在其所依附的线程中被调用执行</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QThread</span> <span class="cm-variable">t</span>; &nbsp; <span class="cm-comment">// 依附于主线程</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">MyObject</span> <span class="cm-variable">m</span>; &nbsp;<span class="cm-comment">// 依附于主线程</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">QObject::connect</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">t</span>,<span class="cm-variable">SIGNAL</span>(<span class="cm-variable">started</span>()),<span class="cm-operator">&amp;</span><span class="cm-variable">m</span>,<span class="cm-variable">SLOT</span>(<span class="cm-variable">getStarted</span>())); &nbsp;<span class="cm-comment">// 槽函数都在主线程被调用执行</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><p><mark><span>QObject::moveToThread()</span></mark><span> 用于改变对象的依附性，使得对象的槽函数在依附的线程中被调用执行</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m</span>.<span class="cm-variable">moveToThread</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">t</span>); &nbsp;<span class="cm-comment">// 改变 m 的线程依附性</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><hr /><p><span>线程中的事件循环</span></p><ul><li><span>信号与槽的机制需要事件循环支持</span></li><li><span>QThread 类中提供的 </span><strong><span>exec()</span></strong><span> 函数用于</span><strong><span>开启线程的事件循环</span></strong></li><li><strong><span>只有事件循环开启</span></strong><span>，依附在线程中的槽函数才能在信号发送后被调用</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QObject::connect</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">t</span>,<span class="cm-variable">SIGNAL</span>(<span class="cm-variable">started</span>()),<span class="cm-operator">&amp;</span><span class="cm-variable">m</span>,<span class="cm-variable">SLOT</span>(<span class="cm-variable">getStarted</span>())); &nbsp;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m</span>.<span class="cm-variable">moveToThread</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">t</span>); <span class="cm-comment">// 槽函数不会被调用执行（Qt4中）</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><blockquote><p><span>研究槽函数的具体执行线程的意义：避开临界资源的竞争问题</span></p><p><span>当信号的发送与对应槽函数的执行在不同线程中，可能产生临界资源的竞争问题</span></p></blockquote><p><span>无论事件循环是否开启，信号发送后会直接进入对象所依附线程的事件队列；然而，只有开启了事件循环，对应的槽函数才会在线程中被调用</span></p><p><span>使用 exec()  之后，线程进入事件循环</span></p><ul><li><span>事件循环结束前，exec() 后的语句无法执行</span></li><li><span>quit() 与 exit() 函数用于结束事件循环</span></li><li><span>quit() → exit(0)，</span><strong><span>exec()的返回值由 exit() 参数决定</span></strong></li></ul><p><span>什么时候需要在线程中开启事件循环</span></p><p><span>设计原则：</span></p><blockquote><p><span>事务性操作（间断性IO操作等）可以开启线程的事件循环，每次操作通过发送信号的方式使得槽函数在子线程中执行，将操作分摊给子线程</span></p></blockquote><hr /><p><span>文件缓冲区：</span></p><ul><li><span>默认情况下，文件操作时会开辟一段内存作为缓冲区</span></li><li><span>向文件中写入</span><strong><span>数据会先进入缓冲区</span></strong></li><li><span>只有当</span><strong><span>缓冲区满</span></strong><span>或者</span><strong><span>遇到换行符</span></strong><span>才将数据写入磁盘</span></li><li><span>缓冲区的意义：减少磁盘的低级 IO 操作，提高文件读写效率</span></li></ul><p><span>人为强制将缓冲区写入磁盘：file.flush()</span></p><p><span>Qt线程的使用模式：</span></p><ul><li><span>无事件循环：后台执行长时间的耗时任务，如文件复制，网络数据读取等</span></li><li><span>开启事件循环模式：执行事务性操作，如文件写入，数据库写入等</span></li></ul><p><span>工程开发中，多数情况不会开启线程的事件循环，线程多用于执行后台任务或耗时任务</span></p><h4><a name="2135-线程的生命期" class="md-header-anchor"></a><span>2.13.5 线程的生命期</span></h4><p><span>C++对象有生命周期</span></p><p><span>线程也有生命周期</span></p><p><span>工程实践中的经验准则：</span></p><blockquote><p><span>线程对象生命周期  &gt;  对应的线程生命周期</span></p></blockquote><p><span>如果是 &lt; ，那么线程对象销毁了，线程还在执行，线程执行时访问线程对象的成员变量时，就是非法的，因为线程对象的存储空间都没了</span></p><hr /><p><span>为确保 线程对象生命周期  &gt;  对应的线程生命周期</span></p><p><span>解决方案：</span></p><ol><li><span>同步型线程设计：</span></li></ol><p><span>			</span><span>线程对象</span><strong><span>主动等待</span></strong><span>线程生命周期结束后才销毁</span></p><p><span>	</span><span>特定：</span></p><p><span>			</span><span>同时支持</span><strong><span>栈</span></strong><span>和</span><strong><span>堆</span></strong><span>中创建线程对象，对象销毁时确保线程生命周期结束</span></p><p><span>	</span><span>设计要点：</span></p><p><span>			</span><strong><span>在析构函数中先调用 wait()</span></strong><span>，强制等到线程运行结束</span></p><p><span>	</span><span>使用场合：</span></p><p><span>			</span><strong><span>线程生命周期相对较短的情形</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">SyncThread::~SyncThread</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">wait</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 88px;"></div><div class="CodeMirror-gutters" style="display: none; height: 88px;"></div></div></div></pre><hr /><ol start='2' ><li><p><span>异步型线程设计</span></p><p><span>概念：</span></p><p><span>	</span><span>线程生命周期结束时</span><strong><span>通知销毁销毁对象</span></strong></p><p><span>特定：</span></p><p><span>		</span><span>只能在</span><strong><span>堆</span></strong><span>中创建线程对象，线程</span><strong><span>对象不能被外界主动销毁</span></strong></p><p><span>要点：</span></p><p><span>		</span><strong><span>在 run() 的最后调用 deleteLater()</span></strong><span> </span></p><p><span>		</span><span>线程体函数</span><strong><span>主动申请</span></strong><span>销毁线程对象</span></p><p><span>使用场合：</span></p><p><span>		</span><span>线程生命周期不可控，需要长时间运行于后台的情形</span></p></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">AsyncThread::run</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">for</span>(){} &nbsp;<span class="cm-comment">// 执行线程任务</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">deleterLater</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><hr /><p><span>总结：</span></p><ul><li><span>线程对象生命周期</span><strong><span>必须大于</span></strong><span>线程生命周期</span></li><li><span>同步型线程设计——</span><strong><span>线程生命周期较短</span></strong></li><li><span>异步型线程设计——</span><strong><span>线程生命周期不可控</span></strong></li><li><span>线程类的设计</span><strong><span>必须适应</span></strong><span>具体的场合；没有万能的设计，只有合适的设计</span></li></ul><h4><a name="2136-第二种线程创建方法" class="md-header-anchor"></a><span>2.13.6 第二种线程创建方法</span></h4><p><span>面向对象设计实践早期，工程中习惯通过继承的方式扩展系统功能</span></p><p><span>现代软件架构：尽量使用组合的方式实现系统功能，代码中仅体现需求中的继承关系</span></p><p><span>通过继承的方式实现新的线程类没有实际意义，就是为了重写 run()</span></p><p><span>ThreadOne, ThreadTwo,ThreadThree 就仅仅是 run() 不同</span></p><p><span>通过继承的方式实现多线程没有任何实际意义</span></p><ul><li><span>QThread 对应于操作系统中的线程</span></li><li><span>QThread 用于充当一个线程操作的集合</span></li><li><strong><span>应该提供灵活的方式指定线程入口函数</span></strong></li><li><strong><span>尽量避免重写 void run()</span></strong></li></ul><hr /><p><span>解决方案——信号与槽</span></p><ol><li><span>在类中定义一个槽函数 void tmain() 作为线程入口函数</span></li><li><span>在类中( Qt 类就可)定义要给 QThread 成员对象 m_thread</span></li><li><span>改变当前对象的线程依附性到 m_thread</span></li><li><span>连接 m_thread 的 start() 信号到 tmain()</span></li></ol><hr /><p><span>总结：</span></p><ul><li><span>早期Qt只能通过继承的方式创建线程</span></li><li><span>现代软件技术提倡</span><strong><span>以组合方式替代继承</span></strong></li><li><span>QThread 应该作为</span><strong><span>线程的操作集合</span></strong><span>而使用</span></li><li><span>可以通过</span><strong><span>信号与槽</span></strong><span>的机制灵活指定线程入口函数</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 新版本的 QThread</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">QThread</span>:<span class="cm-keyword">public</span> <span class="cm-variable">QObject</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">protected</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">virtual</span> <span class="cm-variable-3">void</span> <span class="cm-variable">run</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>{</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>(<span class="cm-variable-3">void</span>) <span class="cm-variable">exec</span>(); &nbsp; <span class="cm-comment">// 提供默认实现形式，默认开启了事件循环</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 198px;"></div><div class="CodeMirror-gutters" style="display: none; height: 198px;"></div></div></div></pre><h4><a name="2137-多线程与界面组件的通信" class="md-header-anchor"></a><span>2.13.7 多线程与界面组件的通信</span></h4><p><span>是否可以在子线程中创建界面组件？ ——————不能</span></p><p><span>GUI系统设计原则：</span></p><p><span>界面组件对象必须依附于主线程</span></p><p><span>所有界面组件的操作都只能在主线程中完成，因此，主线程也叫 GUI 线程</span></p><hr /><p><span>子线程如何对界面组件进行更新：</span><strong><span>子线程不能直接操作界面组件，但是可以通过信号与槽的机制间接操作界面组件</span></strong></p><p><span>解决方案1：</span><mark><span>信号与槽</span></mark></p><ol><li><p><span>咋主线程类中</span><strong><span>定义界面组件的更新信号</span></strong><span> UpdateUI</span></p></li><li><p><span>在主窗口类中</span><strong><span>定义更新界面组件的槽函数</span></strong><span> SetInfo</span></p></li><li><p><span>使用</span><strong><span>异步方式</span></strong><span>连接更新信号到槽函数（UpdateUI  → SetInfo）</span></p><p><span>	</span><span>子线程通过发射信号的方式更新界面组件</span></p><p><span>	</span><span>所有的界面组件对象只能依附于主线程</span></p></li></ol><hr /><p><span>解决方案2：</span><mark><span>发送自定义事件</span></mark></p><ol><li><p><strong><span>自定义事件类</span></strong><span>用于描述界面更新细节</span></p></li><li><p><span>在主窗口类中</span><strong><span>重写事件处理函数 event</span></strong></p></li><li><p><span>使用 </span><mark><span>postEvent()</span></mark><span> 以</span><strong><span>异步方式</span></strong><span> 发送自定义事件类对象(发送事件对象有两种方式：sendEvent()、postEvent()发送的对象必须在堆上创建 )</span></p><p><span>	</span><span>子线程指定接收消息的对象为主窗口对象（需要将主窗口设为父组件，这样主线程才能发送）</span></p><p><span>	</span><span>在 event() 事件处理函数更新界面状态</span></p></li></ol><p><span>事件对象是在主线程中被处理的，即 event() 的调用是在主线程中完成</span></p><h4><a name="2138-软件开发流程" class="md-header-anchor"></a><span>2.13.8 软件开发流程</span></h4><p><span>与开发技术无关，是开发团队必须遵守的一系列规则，在于保证产品的质量和进度，业界已经存在多种开发流程的模型</span></p><ol><li><p><span>即兴模型 Build and Fix Model</span></p><p><span>	</span><span>与用户交流后即开始进行开发，没有需求分析和需求发掘过程，没有整体设计以及规划，没有软件文档，维护性差</span></p></li><li><p><span>瀑布模型 Waterfall Model</span></p><p><span>	</span><span>自上而下的布局（需求分析→架构设计→开发实现→系统测试→最终发布），每个步骤都是不可逆的</span></p></li><li><p><span>增量模型  Incremental Model</span></p><p><span>	</span><span>将系统功能分解为互不重叠的子功能，并行实现子功能，每个子功能就是瀑布模型，全部完成后系统开发结束</span></p></li><li><p><span>螺旋模型  Spiral Model</span></p><p><span>	</span><span>采用一种迭代的方法，项目分解成多个不同的版本，每个版本的开发过程都需要用户参与（多次需求分析，多次开发）</span></p></li><li><p><strong><span>敏捷模型</span></strong><span>  Agile Modeling</span></p><p><span>	</span><span>一切从简，拥抱变化，高效工作，持续开发</span></p></li></ol><p>&nbsp;</p><h2><a name="第三章proj" class="md-header-anchor"></a><span>第三章：Proj</span></h2><h3><a name="31计算器" class="md-header-anchor"></a><span>3.1计算器</span></h3><hr /><p><span>计算器核心算法：</span></p><ol><li><span>中缀表达式进行</span><strong><span>数字</span></strong><span>和</span><strong><span>运算符</span></strong><span>的</span><strong><span>分离</span></strong></li><li><span>将中缀表达式转换为</span><strong><span>后缀表达式</span></strong></li><li><span>通过后缀表达式</span><strong><span>计算最终结果</span></strong></li></ol><hr /><p><mark><span>1.分离算法</span></mark></p><p><span>中缀表达式中包含</span></p><ul><li><span>数字和小数点：0-9 或 .</span></li><li><span>符号位:+或-</span></li><li><span>运算符：+-*/</span></li><li><span>括号：（）</span></li></ul><p><span>思想：以</span><strong><span>符号作为标志</span></strong><span>对表达式中的字符逐个进行访问</span></p><ol><li><p><span>定义累计变量num</span></p></li><li><p><span>当前字符 exp[i] 为</span><strong><span>数字</span></strong><span>或</span><strong><span>小数点</span></strong><span>时：</span></p><p><span>	</span><span>累计： num += exp[i]</span></p></li><li><p><span>当前字符为</span><strong><span>符号</span></strong><span>时：</span></p><p><span>	</span><span>num 为运算数，分离并保存</span></p><p><span>	</span><span>若 exp[i] 为正负号：</span></p><p><span>				</span><span>累计符号位+和-：num+=exp[i]</span></p><p><span>	</span><span>若 exp[i] 为运算符，分离并保存</span></p><p><span>		</span></p></li></ol><p><span>如何区分正负号和加减号</span></p><ul><li><span>+和-在表达式的第一个位置</span></li><li><span>括号后的+和-</span></li><li><span>运算符后的+和-</span></li></ul><p><span>正负号：看前一个字符，前一个字符为空、（、运算符</span></p><p><mark><span>2.中缀转换为后缀表达式</span></mark></p><p><span>类似编译过程</span></p><ul><li><span>四则运算表达式中的括号必须匹配</span></li><li><span>根据运算符优先级进行转换</span></li><li><span>转换后的表达式中没有括号</span></li><li><span>转换后可以顺序的计算最终结果</span></li></ul><p><span>转换过程：</span></p><ol><li><p><span>当前元素为</span><strong><span>数字</span></strong><span>：输出</span></p></li><li><p><span>当前元素e为</span><strong><span>运算符</span></strong><span>：</span></p><p><span>（1）与栈顶运算符进行优先级比较</span></p><p><span>（2）小于等于：将栈顶元素输出，转（1）</span></p><p><span>（3）大于：将当前元素入栈</span></p></li><li><p><span>当前元素为  </span><strong><span>（</span></strong><span>  ：入职</span></p></li><li><p><span>当前元素为    </span><strong><span>）</span></strong><span>：</span></p><p><span>（1）弹出栈顶元素并输出，直至栈顶元素为左括号</span></p><p><span>（2）将栈顶的左括号从栈中弹出</span></p></li></ol><p><mark><span>3.后缀表达式计算</span></mark></p><p><span>遍历后缀表达式</span></p><ul><li><p><span>当前元素为数字：进栈</span></p></li><li><p><span>当前元素为运算符：</span></p><p><span>	</span><span>1.从栈中弹出右操作数</span></p><p><span>	</span><span>2.从栈中弹出左操作数</span></p><p><span>	</span><span>3.根据符号进行运算</span></p><p><span>	</span><span>4.将运算结果压入栈中</span></p></li></ul><p><span>遍历结束，栈中的唯一数字为结果</span></p><h3><a name="32-文本编辑器" class="md-header-anchor"></a><span>3.2 文本编辑器</span></h3><p><span>文本编辑器需求固定，功能之间的耦合性弱，因此增量模型</span></p><p><span>Valgrind内存分析器</span></p><p><span>ui-&gt;addMenu(menu)  // menu并没有成为ui的子对象</span></p><h4><a name="321-创建查找对话框" class="md-header-anchor"></a><span>3.2.1 创建查找对话框</span></h4><p><span>可复用对话框需求分析：</span></p><ul><li><span>可复用软件部件</span></li><li><span>查找文本框中的指定字符串</span></li><li><span>能够指定查找方向</span></li><li><span>大小写敏感查找</span></li></ul><p><span>QString 提供不同的子串查找方式  indexOf()  与 lastIndexOf()</span></p><p><span>QPointer 智能指针，当指向的Qt对象销毁时，该指针会自动设置为NULL，实现查找对话框与文本框的弱耦合关系</span></p><h4><a name="322-替换对话框" class="md-header-anchor"></a><span>3.2.2 替换对话框</span></h4><p><span>需求分析：</span></p><ul><li><span>可复用软件部件</span></li><li><span>查找文本框中的指定字符串</span></li><li><span>替换单个指定字符串</span></li><li><span>替换所有指定字符串</span></li></ul><p><span>具体实现</span></p><ul><li><span>替换对话框的功能</span><strong><span>涵盖</span></strong><span>了查找对话框</span></li><li><span>替换对话框可以</span><strong><span>继承自查找对话框</span></strong></li><li><span>替换功能的实现是</span><strong><span>基于查找算法完成的</span></strong></li><li><span>查找对话框与主界面文本框是聚合关系</span></li></ul><h4><a name="323-关于对话框" class="md-header-anchor"></a><span>3.2.3 关于对话框</span></h4><p><span>关于对话框用于标识软件自身的信息</span></p><p><span>软件 logo、项目名、版本号、开发者信息、版权信息、联系方式</span></p><p><span>布局</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QHBoxLayout&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPushButton</span><span class="cm-operator">*</span> <span class="cm-variable">submitBtn</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QPushButton</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPushButton</span><span class="cm-operator">*</span> <span class="cm-variable">cancelBtn</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QPushButton</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QPushButton</span><span class="cm-operator">*</span> <span class="cm-variable">browserBtn</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QPushButton</span>(<span class="cm-keyword">this</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><h3><a name="33-3d-动画" class="md-header-anchor"></a><span>3.3 3D 动画</span></h3><p><span>QOpenGL</span></p><p><span>查看版本</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QApplication&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QOffscreenSurface&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QOpenGLContext&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QOpenGLFunctions&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QDebug&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">argc</span>, <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">argv</span>[])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QApplication</span> <span class="cm-variable">a</span>(<span class="cm-variable">argc</span>, <span class="cm-variable">argv</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QOffscreenSurface</span> <span class="cm-variable">surf</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">surf</span>.<span class="cm-variable">create</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QOpenGLContext</span> <span class="cm-variable">ctx</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ctx</span>.<span class="cm-variable">create</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ctx</span>.<span class="cm-variable">makeCurrent</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">surf</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">GLint</span> <span class="cm-variable">major</span>, <span class="cm-variable">minor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ctx</span>.<span class="cm-variable">functions</span>()<span class="cm-operator">-&gt;</span><span class="cm-variable">glGetIntegerv</span>(<span class="cm-variable">GL_MAJOR_VERSION</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">major</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ctx</span>.<span class="cm-variable">functions</span>()<span class="cm-operator">-&gt;</span><span class="cm-variable">glGetIntegerv</span>(<span class="cm-variable">GL_MINOR_VERSION</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">minor</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"OpenGL Version Info:"</span> <span class="cm-operator">&lt;&lt;</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span>)<span class="cm-variable">ctx</span>.<span class="cm-variable">functions</span>()<span class="cm-operator">-&gt;</span><span class="cm-variable">glGetString</span>(<span class="cm-variable">GL_VERSION</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"OpenGL Version Major:"</span> <span class="cm-operator">&lt;&lt;</span><span class="cm-variable">major</span><span class="cm-operator">&lt;&lt;</span><span class="cm-string">"OpenGL minor:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">minor</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ctx</span>.<span class="cm-variable">doneCurrent</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">a</span>.<span class="cm-variable">exec</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/*</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">OpenGL Version Info: 3.3 (Compatibility Profile) Mesa 20.0.8</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">OpenGL Version Major: 3 OpenGL minor: 3  */</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 594px;"></div><div class="CodeMirror-gutters" style="display: none; height: 594px;"></div></div></div></pre><h3><a name="34-串口调试助手项目" class="md-header-anchor"></a><span>3.4 串口调试助手项目</span></h3><hr /><h4><a name="341-自动识别串口号" class="md-header-anchor"></a><span>3.4.1 自动识别串口号</span></h4><p><span>使用定时器，定时 500ms </span></p><p><span>扫描串口</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// widget.h 中</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">private</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QTimer</span> <span class="cm-operator">*</span><span class="cm-variable">timerID1</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"><span class="cm-comment">// widget.cpp 中<span class="cm-tab" role="presentation" cm-text="	"> </span></span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QtSerialPort/QtSerialPort&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-def">Widget::event</span>(<span class="cm-variable">QEvent</span> <span class="cm-operator">*</span><span class="cm-variable">event</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">QStringList</span> <span class="cm-variable">newPortStringList</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">static</span> <span class="cm-variable">QStringList</span> <span class="cm-variable">prePortStringList</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">newPortStringList</span>.<span class="cm-variable">clear</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">foreach</span>(<span class="cm-keyword">const</span> <span class="cm-variable">QSerialPortInfo</span> <span class="cm-operator">&amp;</span><span class="cm-variable">info</span>, <span class="cm-variable">QSerialPortInfo::availablePorts</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">newPortStringList</span> <span class="cm-operator">+=</span> <span class="cm-variable">info</span>.<span class="cm-variable">portName</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">prePortStringList</span> <span class="cm-operator">!=</span> <span class="cm-variable">newPortStringList</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">comboBox</span><span class="cm-operator">-&gt;</span><span class="cm-variable">clear</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">comboBox</span><span class="cm-operator">-&gt;</span><span class="cm-variable">addItems</span>(<span class="cm-variable">newPortStringList</span>);</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">prePortStringList</span> <span class="cm-operator">=</span> <span class="cm-variable">newPortStringList</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 418px;"></div><div class="CodeMirror-gutters" style="display: none; height: 418px;"></div></div></div></pre><hr /><h4><a name="342-设置串口参数" class="md-header-anchor"></a><span>3.4.2 设置串口参数</span></h4><hr /><h4><a name="343-接收功能" class="md-header-anchor"></a><span>3.4.3 接收功能 </span></h4><hr /><h4><a name="344-发送功能" class="md-header-anchor"></a><span>3.4.4 发送功能</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="C++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QByteArray</span> <span class="cm-variable">byteArray</span>; &nbsp;<span class="cm-comment">// 用于发送 write 要发送 QByteArray 类型</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sendText</span> <span class="cm-operator">=</span> <span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">textEdit_2</span><span class="cm-operator">-&gt;</span><span class="cm-variable">toPlainText</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">byteArray</span> <span class="cm-operator">=</span> <span class="cm-variable">sendText</span>.<span class="cm-variable">toLation1</span>(); &nbsp;<span class="cm-comment">// 将 QString 类型的 sendText 转换为 QByteArray 类型</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sendText_byte</span> <span class="cm-operator">+=</span> <span class="cm-variable">sendText</span>.<span class="cm-variable">length</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">label_12</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setText</span>(<span class="cm-variable">QString::number</span>(<span class="cm-variable">sendText_byte</span>));</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mySerial</span><span class="cm-operator">-&gt;</span><span class="cm-variable">write</span>(<span class="cm-variable">byteArray</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 132px;"></div><div class="CodeMirror-gutters" style="display: none; height: 132px;"></div></div></div></pre><h3><a name="35-stm32开发板qt开发" class="md-header-anchor"></a><span>3.5 STM32开发板Qt开发</span></h3><h4><a name="351-交叉编译qt项目" class="md-header-anchor"></a><span>3.5.1 交叉编译Qt项目</span></h4><h5><a name="1）安装交叉编译器" class="md-header-anchor"></a><span>（1）安装交叉编译器</span></h5><p><span>在 ubuntu 中安装 .sh 脚本文件</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="linux"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="linux"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">chmod 777 ./*.sh</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo ./*.sh</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>默认安装在 /opt</span></p><p><span>每次使用安装后的该脚本，都需要source添加环境变量</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="linux"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="linux"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">source</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><p><span>source是一个内置的Shell命令，它读取并执行当前Shell中文件的内容，仅对当前 terminal 有效</span></p><p><span>source 之后 qmake-v 才有效</span></p><h5><a name="2）命令行交叉编译qt项目" class="md-header-anchor"></a><span>（2）命令行交叉编译Qt项目</span></h5><blockquote><p><span>qmake -v  </span></p></blockquote><p><span>会打印 qmake 版本信息</span></p><p><span>在 Lesson55QUdp.pro 文件夹下</span></p><blockquote><p><span>qmake Lesson55QUdp.pro</span></p></blockquote><p><span>执行完会生成 Makefile 文件，以及一些隐藏文件（ls -a查看，ls -l显示全部文件的详细信息）</span></p><blockquote><p><span>make distclean  // 不用</span></p></blockquote><p><span>会删除上述 qmake 生成的所有文件</span></p><blockquote><p><span>make -j 2    // 使用2两个线程进行编译，不能大于内核数量，实际是调用 gcc</span></p></blockquote><p><span>根据makefile进行编译，执行完会生成  Lesson55QUdp 的可执行文件（ls -l可看到带x属性）</span></p><blockquote><p><span>make clean  // 需要用</span></p></blockquote><p><span>只会删除一部分多余的么用文件</span></p><h5><a name="3）拷贝编译好的执行程序到开发板上" class="md-header-anchor"></a><span>（3）拷贝编译好的执行程序到开发板上</span></h5><hr /><p><span>方法一：U盘</span></p><p><span>通过U盘，U盘在ubuntu目录 /media/zhihongzeng/ 下面，cp 拷贝，拷贝完 sync 同步数据</span></p><p><span>通过U盘拷贝可执行文件到开发板</span></p><p><span>需要先关闭开发板当前运行的程序，killall+程序名</span></p><p><span>然后修改默认启动的程序</span></p><hr /><p><span>方法二：通过网络</span></p><p><span>开发板与电脑处于同一网络</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="linux"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="linux"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">scp 文件 用户名@ip地址：路径</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">scp -r 文件夹 用户名@ip地址：路径</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">scp Lesson55QUdp root@开发板ip :/home/root</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">// 将 Lesson55QUdp 拷贝到 开发板的 /home/root 目录下，开发板的默认用户名为 root</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><h5><a name="4）stm32-交叉编译qt项目" class="md-header-anchor"></a><span>（4）STM32 交叉编译Qt项目</span></h5><h4><a name="352-qt点亮开发板的led" class="md-header-anchor"></a><span>3.5.2 Qt点亮开发板的LED</span></h4><p><span>Qt → 驱动提供接口 → 开发板硬件</span></p><hr /><ol><li><span>开发板的 Linux 中找到 LED</span></li></ol><p><span>内核设备树路径 arch/arm/boot/dts/stm32mp157d-atk.dtsi</span></p><p><span>里面注册有硬件中的 LED，LED注册成了 gpio-led 类型设备，通过应用层接口操作 LED</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include "lesson58led.h"</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include "ui_lesson58led.h"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QDebug&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">Lesson58Led::Lesson58Led</span>(<span class="cm-variable">QWidget</span> <span class="cm-operator">*</span><span class="cm-variable">parent</span>) :</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QWidget</span>(<span class="cm-variable">parent</span>),</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ui</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Ui::Lesson58Led</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setupUi</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">MyFile</span>.<span class="cm-variable">setFileName</span>(<span class="cm-string">"/sys/class/leds/sys-led/brightness"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 设置触发模式为 none</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">system</span>(<span class="cm-string">"echo none &gt; /sys/class/leds/sys-led/trigger"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">Lesson58Led::on_pushButton_clicked</span>(<span class="cm-variable-3">bool</span> <span class="cm-variable">checked</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">MyFile</span>.<span class="cm-variable">exists</span>() )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qDebug</span>() <span class="cm-operator">&lt;&lt;</span><span class="cm-string">" no led."</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">MyFile</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::WriteOnly</span>) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">QByteArray</span> <span class="cm-variable">buff</span>[] <span class="cm-operator">=</span> {<span class="cm-string">"0"</span>,<span class="cm-string">"1"</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">checked</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pushButton</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setText</span>(<span class="cm-string">"off"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">MyFile</span>.<span class="cm-variable">write</span>(<span class="cm-variable">buff</span>[<span class="cm-number">1</span>]);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pushButton</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setText</span>(<span class="cm-string">"on"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">MyFile</span>.<span class="cm-variable">write</span>(<span class="cm-variable">buff</span>[<span class="cm-number">0</span>]);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">MyFile</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 924px;"></div><div class="CodeMirror-gutters" style="display: none; height: 924px;"></div></div></div></pre><h4><a name="353-使用开发板的按键" class="md-header-anchor"></a><span>3.5.3 使用开发板的按键</span></h4><p><span>Linux 系统中集成了键盘，因此可以设置按键为键盘中的某个键</span></p><p><span>Qt::Key_VolumeDown 的按键编号为 114</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">Lesson60Btn::keyPressEvent</span>(<span class="cm-variable">QKeyEvent</span> <span class="cm-operator">*</span><span class="cm-variable">event</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>( <span class="cm-variable">event</span><span class="cm-operator">-&gt;</span><span class="cm-variable">key</span>() <span class="cm-operator">==</span> <span class="cm-variable">Qt::Key_1</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setStyleSheet</span>(<span class="cm-string">"QWidget{background-color:red;}"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"key pressed."</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">Lesson60Btn::keyReleaseEvent</span>(<span class="cm-variable">QKeyEvent</span> <span class="cm-operator">*</span><span class="cm-variable">event</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>( <span class="cm-variable">event</span><span class="cm-operator">-&gt;</span><span class="cm-variable">key</span>() <span class="cm-operator">==</span> <span class="cm-variable">Qt::Key_1</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">this</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setStyleSheet</span>(<span class="cm-string">"QWidget{background-color:white;}"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 352px;"></div><div class="CodeMirror-gutters" style="display: none; height: 352px;"></div></div></div></pre><h4><a name="354-串口上位机" class="md-header-anchor"></a><span>3.5.4 串口上位机</span></h4><p><span>要在ubuntu中连接串口，需要 chmod 777 /dev/ttyUSB</span></p><h4><a name="355-嵌入式qt嵌入式移植概述" class="md-header-anchor"></a><span>3.5.5 嵌入式Qt嵌入式移植概述</span></h4><hr /><p><span>为什么要移植：</span></p><p><span>自制系统，如BusyBox简易系统，希望能运行Qt</span></p><p><span>厂家提供的Qt库太大，太全，占空间</span></p><p><span>版本升级，想用其他好用的Qt版本</span></p><hr /><p><span>方法：</span></p><ol><li><span>编译Qt源码（在Qt官网的single中），得到Qt库文件（Linux中.so后缀，Windows中 .dll 后缀），部署到嵌入式系统中</span></li><li><strong><span>利用开源的嵌入式 Linux 系统自动构建框架 Buildroot</span></strong><span> 或者 Yocto</span></li></ol><p><strong><span>Buildroot ：很方便</span></strong></p><p><span>Yocto：容易编译出错，而且文件巨大，不学</span></p><p><span>三种方法对比</span></p><figure><table><thead><tr><th>&nbsp;</th><th style='text-align:center;' ><span>单独编译Qt源码（移植到BusyBox）</span></th><th style='text-align:center;' ><span>Buildroot构建Qt</span></th><th style='text-align:center;' ><span>Yocto构建Qt</span></th></tr></thead><tbody><tr><td><strong><span>难度</span></strong></td><td style='text-align:center;' ><span>相当大，依赖第三方库</span></td><td style='text-align:center;' ><span>小，需要什么就勾选就行</span></td><td style='text-align:center;' ><span>大</span></td></tr><tr><td><strong><span>Qt库完整性</span></strong></td><td style='text-align:center;' ><span>不完整</span></td><td style='text-align:center;' ><span>完整</span></td><td style='text-align:center;' ><span>完整</span></td></tr><tr><td><strong><span>复杂程度</span></strong></td><td style='text-align:center;' ><span>复杂</span></td><td style='text-align:center;' ><span>一般</span></td><td style='text-align:center;' ><span>一般</span></td></tr><tr><td><strong><span>缺少的功能</span></strong></td><td style='text-align:center;' ><span>播放媒体（Qt是调用gstreamer媒体去解码），网络功能（需要python）等</span></td><td style='text-align:center;' ><span>较完整，需要配置依赖编译</span></td><td style='text-align:center;' ><span>较完整，需要配置依赖编译</span></td></tr><tr><td><strong><span>适用场合</span></strong></td><td style='text-align:center;' ><span>运行简单的Qt图形界面</span></td><td style='text-align:center;' ><span>功能完善，媒体，网络等功能可用</span></td><td style='text-align:center;' ><span>功能完善，媒体，网络等功能可用</span></td></tr></tbody></table></figure><h2><a name="第四章进阶" class="md-header-anchor"></a><span>第四章：进阶</span></h2><h3><a name="41-网络编程" class="md-header-anchor"></a><span>4.1 网络编程</span></h3><p><span>对于不同人群</span></p><ul><li><span>网络用户：资源库、虚拟世界、通讯媒体</span></li><li><span>应用程序开发者：数据收发的通道（open、send、receive、close）</span></li><li><span>网络设备开发者：数据收发器、设备连接方式、通信协议</span></li></ul><hr /><p><span>网络形态：</span></p><p><span>1.局域网 LAN：物理上位置接近的设备通过交换机连接</span></p><p><span>2.广域网 WAN：不同的局域网通过路由器连接成广域网</span></p><hr /><p><span>网络基本概念</span></p><ul><li><span>MAC地址（硬件地址，给交换机用）：网络设备出厂时设定的全球唯一硬件地址</span></li><li><span>网络地址（软件地址即ip地址，给路由器用）：每一台网络主机都有唯一的地址（如192.168.12.1）</span></li><li><span>网络端口：每一台网络主机可以通过不同端口进行多路通信（如80端口）</span></li></ul><ol><li><p><span>交换机：</span><strong><span>端到端数据收发</span></strong><span>（只做一次中转）</span></p><p><span>	</span><span>基于硬件地址实现不同设备间的数据转发</span></p><p><span>	</span><span>特定：工作层次低，转发速度快</span></p><p><span>	</span><span>原理：有一张主机-MAC地址的映射表</span></p></li><li><p><span>路由器：</span><strong><span>决定数据转发路线，执行转发操作</span></strong></p><p><span>	</span><span>基于软件地址实现不同网络间的数据转发</span></p><p><span>	</span><span>特点：能够选择数据通道，实现通信控制</span></p><p><span>	</span><span>原理：如何知道哪条路径发送时间最短：静态路由（管理员配置好的一张表），动态路由（算法）</span></p></li></ol><p><span>交换机与路由器工作在不同的层次</span></p><p><span>网络协议：为数据交换而建立的规则、标准或约定的集合</span></p><p><span>协议栈：</span></p><blockquote><p><span>应用层</span></p><p><span>传输层（TCP/UDP）</span></p><p><span>网络层（IP）（路由器）</span></p><p><span>接口层：1.数据链路层(交换机)    2.物理层</span></p></blockquote><p><span>上层协议基于下层协议实现</span></p><hr /><p><span>TCP（传输控制协议）</span></p><p><span>		</span><span>基于连接的可靠传输协议，主要用于大量数据的场合，传输速度慢</span></p><p><span>		</span><span>TCP的3次握手（建立连接）</span></p><p><span>UDP（用户数据报协议）</span></p><p><span>		</span><span>非连接方式的传输协议，主要用于少了数据的场合，传输速度快</span></p><p><span>区别：TCP数据传输前需要建立连接，而UDP不需要</span></p><hr /><p><span>TCP和UDP是应用层协议的基础</span></p><p><span>应用层协议：</span></p><ul><li><span>HTTP：超文本传输协议，常用于游览器/Web服务器</span></li><li><span>FTP：文件传输协议，常用于文件共享</span></li><li><span>SMTP：邮件传输协议，常用于邮件发送</span></li><li><span>Telent：远程登录协议，常用于终端远程登陆主机</span></li></ul><h4><a name="411-客户端" class="md-header-anchor"></a><span>4.1.1 客户端</span></h4><p><span>Qt网络编程方式：</span></p><p><span>网络只是数据传输的通道，Qt提供了网络协议对应的类（封装了协议细节），使用类进行数据收发，从而进行网络应用开发</span></p><p><span>QTcpSocket、QTcpServer</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">connectToHost</span>() &nbsp; <span class="cm-comment">// 1.连接服务器主机</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">read</span>()<span class="cm-variable">、write</span>() &nbsp; <span class="cm-comment">// 2</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">close</span>() &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 3</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>默认情况下，QTcpSocket 使用</span><strong><span>异步编程</span></strong><span>的方式</span></p><p><span>	</span><span>1. 操作完成后立即返回</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2.  通过**发送信号的方式返回操作结果**，可以在程序中将对应信号连接到槽函数，获取结果</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 22px;"></div><div class="CodeMirror-gutters" style="display: none; height: 22px;"></div></div></div></pre><ol start='3' ><li><span>在GUI应用程序中，通常使用 QTcpSocket 的异步方式</span></li></ol><p><span>同步编程：如函数调用，返回就是操作的结果</span></p><p><span>异步编程：函数返回时是代表操作的启动（返回 bool，判断是否启动成功）。通过回调拿到操作的结果（回调函数或者信号槽都可实现）</span></p><p><span>QTcpSocket 提供了辅助函数，可完成同步编程的方式</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">waitForConnected</span>() &nbsp; &nbsp; <span class="cm-variable">waritForDisconnected</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">waitForBytesWritten</span>() &nbsp; <span class="cm-variable">waitForReadyRead</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><p><span>示例：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">SyncClientDemo</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QTcpSocket</span> <span class="cm-variable">client</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">buf</span>[<span class="cm-number">256</span>] <span class="cm-operator">=</span> {<span class="cm-number">0</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">client</span>.<span class="cm-variable">connectToHost</span>(<span class="cm-string">"127.0.0.1"</span>,<span class="cm-number">9999</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"connected:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">client</span>.<span class="cm-variable">waitForConnected</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"send byte:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">client</span>.<span class="cm-variable">write</span>(<span class="cm-string">"zzh"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"send status:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">client</span>.<span class="cm-variable">waitForBytesWritten</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"data available:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">client</span>.<span class="cm-variable">waitForReadyRead</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"received data byte:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">client</span>.<span class="cm-variable">read</span>(<span class="cm-variable">buf</span>,<span class="cm-keyword">sizeof</span>(<span class="cm-variable">buf</span>)<span class="cm-operator">-</span><span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"received data:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">buf</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">client</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">//qDebug()&lt;&lt;"disconnected:"&lt;&lt;client.waitForDisconnected();</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 462px;"></div><div class="CodeMirror-gutters" style="display: none; height: 462px;"></div></div></div></pre><p><span>异步编程</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">connect</span>() &nbsp; &nbsp;<span class="cm-variable">disconnected</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">readyRead</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">bytesWritten</span>(<span class="cm-variable">qint64</span>) &nbsp;<span class="cm-comment">//数据成功发送志系统</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 66px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p><span>示例：</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include "clientdemo.h"</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">ClientDemo::ClientDemo</span>(<span class="cm-variable">QObject</span> <span class="cm-operator">*</span><span class="cm-variable">parent</span>) : <span class="cm-variable">QObject</span>(<span class="cm-variable">parent</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">connect</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">m_client</span>,<span class="cm-variable">SIGNAL</span>(<span class="cm-variable">connected</span>()),<span class="cm-keyword">this</span>,<span class="cm-variable">SLOT</span>(<span class="cm-variable">onConnected</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">connect</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">m_client</span>,<span class="cm-variable">SIGNAL</span>(<span class="cm-variable">disconnected</span>()),<span class="cm-keyword">this</span>,<span class="cm-variable">SLOT</span>(<span class="cm-variable">onDisconnected</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">connect</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">m_client</span>,<span class="cm-variable">SIGNAL</span>(<span class="cm-variable">readyRead</span>()),<span class="cm-keyword">this</span>,<span class="cm-variable">SLOT</span>(<span class="cm-variable">onDataReady</span>()));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">connect</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">m_client</span>,<span class="cm-variable">SIGNAL</span>(<span class="cm-variable">bytesWritten</span>(<span class="cm-variable">qint64</span>)),<span class="cm-keyword">this</span>,<span class="cm-variable">SLOT</span>(<span class="cm-variable">onBytesWritten</span>(<span class="cm-variable">qint64</span>)));</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">ClientDemo::connectTo</span>(<span class="cm-variable">QString</span> <span class="cm-variable">ip</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">port</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">m_client</span>.<span class="cm-variable">connectToHost</span>(<span class="cm-variable">ip</span>,<span class="cm-variable">port</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qint64</span> <span class="cm-def">ClientDemo::send</span>(<span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">data</span>, <span class="cm-variable-3">int</span> <span class="cm-variable">len</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-keyword">return</span> <span class="cm-variable">m_client</span>.<span class="cm-variable">write</span>(<span class="cm-variable">data</span>,<span class="cm-variable">len</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qint64</span> <span class="cm-def">ClientDemo::available</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">m_client</span>.<span class="cm-variable">bytesAvailable</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">ClientDemo::close</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">m_client</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">ClientDemo::onConnected</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"onConnected"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"local addr:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">m_client</span>.<span class="cm-variable">localAddress</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"local port:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">m_client</span>.<span class="cm-variable">localPort</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">ClientDemo::onDisconnected</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"onDisconnected"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">ClientDemo::onDataReady</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">buf</span>[<span class="cm-number">256</span>] <span class="cm-operator">=</span> {<span class="cm-number">0</span>};</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"onDataReady"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">m_client</span>.<span class="cm-variable">read</span>(<span class="cm-variable">buf</span>,<span class="cm-keyword">sizeof</span>(<span class="cm-variable">buf</span>)<span class="cm-operator">-</span><span class="cm-number">1</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"data:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">buf</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">ClientDemo::onBytesWritten</span>(<span class="cm-variable">qint64</span> <span class="cm-variable">bytes</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"onBytesWritten"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">bytes</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1166px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1166px;"></div></div></div></pre><h4><a name="412-服务器" class="md-header-anchor"></a><span>4.1.2 服务器</span></h4><p><span>服务器是为客户端服务的，服务的内容诸如向客户端提供资源，保存客户端数据，为客户端提供功能接口，等</span></p><hr /><p><span>1.C/S 网络结构 Client / Server</span></p><p><span>服务端公开网络地址，提供服务</span></p><p><span>客户端提供服务端网络地址主动连接服务端</span></p><p><span>特点：</span></p><ul><li><span>服务端被动接受连接（服务端无法主动连接客户端）</span></li><li><span>服务端必须公开网络地址(容易受攻击)</span></li><li><span>客户端倾向于处理用户交互及体验</span></li><li><span>服务端倾向于用户数据的组织和存储（数据处理）</span></li></ul><hr /><ol start='2' ><li><span>B/S 网络结构  Browser / Server</span></li></ol><ul><li><span>是一种</span><strong><span>特殊的 C/S 网络架构</span></strong></li><li><span>客户端统一使用浏览器 </span><strong><span>Browser</span></strong></li><li><span>客户端 GUI 通常使用 </span><strong><span>HTML</span></strong><span> 进行开发</span></li><li><span>客户端与服务端通常采用 </span><strong><span>http</span></strong><span> 协议进行通信</span></li></ul><hr /><p><span>TCP 服务端编程</span></p><p><span>QTcpServer 类封装了 TCP 协议细节</span></p><p><span>QTcpServer 用于端口的连接监听，</span><strong><span>监听到连接后，生成 QTcpSocket 对象与客户端通信</span></strong></p><p><span>每个QTcpSocket 对象同样需要连接信号到槽函数</span></p><hr /><p><span>使用方式：</span></p><ol><li><span>监听地址和端口 listen()</span></li><li><span>通过信号通知客户端连接 newConnection()</span></li><li><span>获取 QTcpSocket 通信对象  nextPendingConnection()</span></li><li><span>停止监听 close()</span></li></ol><hr /><p><span>注意：</span></p><ul><li><span>QTcpServer 用于处理客户端连接，不进行具体通信</span></li><li><span>监听的端口只用于响应连接请求</span></li><li><span>监听到连接后，生成QTcpSocket 对象与客户端通信</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QTcpServer</span> : &nbsp;<span class="cm-variable">listen</span>() &nbsp;<span class="cm-variable">isListening</span>() &nbsp;<span class="cm-variable">close</span>()</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QTcpSocket</span> : &nbsp;<span class="cm-variable">connect</span>() &nbsp; <span class="cm-variable">read</span>() &nbsp;<span class="cm-variable">write</span>() &nbsp;<span class="cm-variable">close</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 44px;"></div><div class="CodeMirror-gutters" style="display: none; height: 44px;"></div></div></div></pre><h4><a name="413-tcp-传输文件小案例" class="md-header-anchor"></a><span>4.1.3 TCP 传输文件小案例</span></h4><ol><li><span>客户端 client</span></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QT</span> <span class="cm-operator">+=</span> <span class="cm-variable">core</span> <span class="cm-variable">ui</span> <span class="cm-variable">network</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QTcpServer&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QTcpSocket&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#incldue &lt;QFileDialog&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-meta">#include &lt;QTimer&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 定义套接字</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QTcpSocket</span> <span class="cm-operator">*</span><span class="cm-variable">tcpSocket</span>; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QString</span> <span class="cm-variable">fileName</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Qint64</span> <span class="cm-variable">fileSize</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Qfile</span> <span class="cm-variable">file</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QTimer</span> <span class="cm-variable">myTimer</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tcpSocket</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QTcpSocket</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">myTimer</span> <span class="cm-operator">=</span><span class="cm-keyword">new</span> <span class="cm-variable">QTimer</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">connect</span>( <span class="cm-variable">tcpSocket</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">QTcpSocket::readyRead</span>,<span class="cm-keyword">this</span>,[<span class="cm-operator">&amp;</span>](){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QByteArray</span> <span class="cm-variable">arr</span> <span class="cm-operator">=</span><span class="cm-variable">tcpSocket</span><span class="cm-operator">-&gt;</span><span class="cm-variable">readAll</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"client receive: "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">arr</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  });</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">connect</span>(<span class="cm-variable">myTimer</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">QTimer::timeout</span>,<span class="cm-keyword">this</span>,[<span class="cm-operator">&amp;</span>](){ &nbsp;<span class="cm-comment">// 20ms 的定时器，定时结束再开始真正发送文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">myTimer</span><span class="cm-operator">-&gt;</span><span class="cm-variable">stop</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qint64</span> <span class="cm-variable">len</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qint64</span> <span class="cm-variable">sendSize</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">do</span>{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">len</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-3">char</span> <span class="cm-variable">buf</span>[<span class="cm-number">4</span><span class="cm-operator">*</span><span class="cm-number">4096</span>]; <span class="cm-comment">// 4kb</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">len</span> <span class="cm-operator">=</span> <span class="cm-variable">file</span>.<span class="cm-variable">read</span>(<span class="cm-variable">buf</span>,<span class="cm-keyword">sizeof</span>(<span class="cm-variable">buf</span>)); &nbsp;<span class="cm-comment">// 实际读出来的值为 len</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tcpSocket</span><span class="cm-operator">-&gt;</span><span class="cm-variable">write</span>(<span class="cm-variable">buf</span>,<span class="cm-variable">len</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">sendSize</span> <span class="cm-operator">+=</span> <span class="cm-variable">len</span>; &nbsp; &nbsp;<span class="cm-comment">// 累计已经发送文件大小</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">progressBar</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setValue</span>(<span class="cm-variable">sendSize</span><span class="cm-operator">/</span><span class="cm-number">1024</span>); &nbsp;<span class="cm-comment">// 为了让数字不那么大，/1024</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }<span class="cm-keyword">while</span>(<span class="cm-variable">len</span><span class="cm-operator">&gt;</span><span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">sendSize</span> <span class="cm-operator">==</span> <span class="cm-variable">fileSize</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">file</span>.<span class="cm-variable">close</span>(); &nbsp;<span class="cm-comment">// 关闭文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tcpSocket</span><span class="cm-operator">-&gt;</span><span class="cm-variable">disconnectFromHost</span>(); &nbsp;<span class="cm-comment">// 断开服务器的连接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tcpSocket</span><span class="cm-operator">-&gt;</span><span class="cm-variable">close</span>(); &nbsp;<span class="cm-comment">// 关闭套接字</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">Widget::on_pushButton_clicked</span>() &nbsp;<span class="cm-comment">// 点击连接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">tcpSocket</span><span class="cm-operator">-&gt;</span><span class="cm-variable">connectToHost</span>(<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">lineEdit</span><span class="cm-operator">-&gt;</span><span class="cm-variable">text</span>(),<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">lineEdit_2</span><span class="cm-operator">-&gt;</span><span class="cm-variable">text</span>().<span class="cm-variable">toInt</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">Widget::on_pushButton_2_clicked</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QString</span> <span class="cm-variable">filePath</span> <span class="cm-operator">=</span> <span class="cm-variable">QFileDialog::getOpenFileName</span>(<span class="cm-keyword">this</span>); &nbsp;<span class="cm-comment">// 打开要发送的文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QFileInfo</span> <span class="cm-variable">fileData</span>(<span class="cm-variable">filePath</span>); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">fileName</span> <span class="cm-operator">=</span> <span class="cm-variable">fileData</span>.<span class="cm-variable">fileName</span>(); &nbsp;<span class="cm-comment">// 记录打开的文件名</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">fileSize</span> <span class="cm-operator">=</span> <span class="cm-variable">fileData</span>.<span class="cm-variable">size</span>(); &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 记录打开的文件大小</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"name:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">fileName</span><span class="cm-operator">&lt;&lt;</span><span class="cm-string">", size:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">fileSize</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-operator">!</span><span class="cm-variable">filePath</span>.<span class="cm-variable">isEmpty</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">lable_3</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setText</span>(<span class="cm-variable">filePath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">file</span>.<span class="cm-variable">setFileName</span>(<span class="cm-variable">filePath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">file</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::ReadOnly</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">progressBar</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setMaximun</span>(<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">progressBar</span><span class="cm-operator">-&gt;</span><span class="cm-variable">SetMinum</span>(<span class="cm-variable">fileSize</span><span class="cm-operator">/</span><span class="cm-number">1024</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">progressBar</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setValue</span>(<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">Widget::on_pushButton_3_clicked</span>() &nbsp;<span class="cm-comment">// 按键3 发送</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 第一次发送信息，即文件的头信息 "文件名+###"+文件大小</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QString</span> <span class="cm-variable">head</span> <span class="cm-operator">=</span> <span class="cm-variable">fileName</span><span class="cm-operator">+</span><span class="cm-string">"###"</span><span class="cm-operator">+</span><span class="cm-variable">QString::number</span>(<span class="cm-variable">fileSize</span>); </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qint64</span> <span class="cm-variable">length</span> <span class="cm-operator">=</span> <span class="cm-variable">tcpSocket</span><span class="cm-operator">-&gt;</span><span class="cm-variable">write</span>(<span class="cm-variable">head</span>.<span class="cm-variable">toUtf8</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">length</span><span class="cm-operator">&gt;</span><span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">myTimer</span><span class="cm-operator">-&gt;</span><span class="cm-variable">start</span>(<span class="cm-number">20</span>); &nbsp;<span class="cm-comment">// 20ms 的定时器，定时结束再开始真正发送文件</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"send head successfully."</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"failed to send head."</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">file</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1936px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1936px;"></div></div></div></pre><ol start='2' ><li><span>服务器端 server</span></li></ol><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 定义套接字</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QTcpServer</span> <span class="cm-operator">*</span><span class="cm-variable">tcpServer</span>; &nbsp;<span class="cm-comment">// 用于监听</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QTcpSocket</span> <span class="cm-operator">*</span><span class="cm-variable">clientConnection</span> <span class="cm-operator">=</span> <span class="cm-keyword">nullptr</span>; &nbsp; <span class="cm-comment">// 用于通信</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">bool</span> <span class="cm-variable">headInfo</span><span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QString</span> <span class="cm-variable">fileName</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qint64</span> <span class="cm-variable">fileSize</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qint64</span> <span class="cm-variable">recvSize</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QFile</span> <span class="cm-variable">file</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 初始化</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tcpServer</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QTcpServer</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">clientConnection</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QTcpSocket</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">Widget::on_pushButton_clicked</span>() &nbsp;<span class="cm-comment">// 点击连接</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 监听网络</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">tcpServer</span><span class="cm-operator">-&gt;</span><span class="cm-variable">listen</span>(<span class="cm-variable">QHostAddress::LocalHost</span>,<span class="cm-number">8080</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">connect</span>(<span class="cm-variable">tcpServer</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">QTcpServer::newConnection</span>,<span class="cm-keyword">this</span>,[<span class="cm-operator">&amp;</span>](){ &nbsp;<span class="cm-comment">// 监听到客户端有请求到来</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">clientConnection</span> <span class="cm-operator">=</span> <span class="cm-variable">tcpServer</span><span class="cm-operator">-&gt;</span><span class="cm-variable">nextPendingConnection</span>(); &nbsp;<span class="cm-comment">// 产生新的套接字，用于通信</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">clientConnection</span><span class="cm-operator">-&gt;</span><span class="cm-variable">write</span>(<span class="cm-string">"welcome to connect to server."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">textEdit</span><span class="cm-operator">-&gt;</span><span class="cm-variable">append</span>(<span class="cm-string">"new connection......"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// 客户端接收信号</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">connect</span>(<span class="cm-variable">clientConnection</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">QTcpSocket::readyRead</span>,<span class="cm-keyword">this</span>,[<span class="cm-operator">&amp;</span>](){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">QByteArray</span> <span class="cm-variable">arr</span> <span class="cm-operator">=</span> <span class="cm-variable">clientConnection</span><span class="cm-operator">-&gt;</span><span class="cm-variable">readAll</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>(<span class="cm-variable">headInfo</span>) &nbsp;<span class="cm-comment">// 第一次接收到信息，即文件的头信息 "文件名+###"+文件大小</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">headInfo</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">recvSize</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">fileName</span> <span class="cm-operator">=</span> <span class="cm-variable">QString</span>(<span class="cm-variable">arr</span>).<span class="cm-variable">section</span>(<span class="cm-string">"###"</span>,<span class="cm-number">0</span>,<span class="cm-number">0</span>); &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">fileSize</span> <span class="cm-operator">=</span> <span class="cm-variable">QString</span>(<span class="cm-variable">arr</span>).<span class="cm-variable">section</span>(<span class="cm-string">"###"</span>,<span class="cm-number">1</span>,<span class="cm-number">1</span>).<span class="cm-variable">toInt</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">file</span>.<span class="cm-variable">setFileName</span>(<span class="cm-variable">filePath</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">file</span>.<span class="cm-variable">open</span>(<span class="cm-variable">QIODevice::WriteOnly</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">progressBar</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setMaximun</span>(<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">progressBar</span><span class="cm-operator">-&gt;</span><span class="cm-variable">SetMinum</span>(<span class="cm-variable">fileSize</span><span class="cm-operator">/</span><span class="cm-number">1024</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">progressBar</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setValue</span>(<span class="cm-number">0</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qint64</span> <span class="cm-variable">length</span> <span class="cm-operator">=</span> <span class="cm-variable">file</span>.<span class="cm-variable">write</span>(<span class="cm-variable">arr</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">length</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">recvSize</span> <span class="cm-operator">+=</span> <span class="cm-variable">length</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">progressBar</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setValue</span>(<span class="cm-variable">recvSize</span><span class="cm-operator">/</span><span class="cm-number">1024</span>); &nbsp;<span class="cm-comment">// 为了让数字不那么大，/1024</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">recvSize</span> <span class="cm-operator">==</span> <span class="cm-variable">fileSize</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">QMessageBox::information</span>(<span class="cm-keyword">this</span>,<span class="cm-variable">“OK”</span>,<span class="cm-string">"reveived completed."</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">file</span>.<span class="cm-variable">close</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  });</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pushButton</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setEnable</span>(<span class="cm-atom">false</span>); &nbsp;<span class="cm-comment">// 第一次监听收到信号后，就不能再点击</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1364px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1364px;"></div></div></div></pre><h3><a name="42-文本协议的设计与实现" class="md-header-anchor"></a><span>4.2 文本协议的设计与实现</span></h3><hr /><p><span>缓冲区概念：一段暂存数据的内存</span></p><p><span>1.发送缓冲区：</span></p><ul><li><span>数据先进入发送缓冲区，之后由操作系统送往远程主机</span></li><li><span>flush() 强制发送缓冲区中的数据立即被送走</span></li></ul><p><span>2.接受缓冲区：</span></p><ul><li><span>远端数据被操作系统接收后放入接收缓冲区</span></li><li><span>bytesAvailable() 获取接收缓冲区中数据的字节数</span></li></ul><p><span>为什么需要缓冲区：因为应用程序不能直接操作硬件（网卡）</span></p><hr /><p><span>问题，write(&quot;A&quot;); write(&quot;B&quot;); write(&quot;C&quot;);  但是由于缓冲区，接收端不知道 ABC是一次一次发送的，还是一次性发送到的</span></p><p><strong><span>通过建立协议解决数据粘连问题</span></strong></p><p><span>网络设计中的期望</span></p><ul><li><span>每次发送一条</span><strong><span>完整</span></strong><span>的消息，每次接收一条</span><strong><span>完整</span></strong><span>的消息</span></li><li><span>即使缓冲区中有多条消息，也</span><strong><span>不会出现消息粘连</span></strong></li><li><span>消息中涵盖了</span><strong><span>数据类型</span></strong><span>和</span><strong><span>数据长度</span></strong><span>等信息</span></li></ul><hr /><p><span>应用层协议设计</span></p><p><span>协议是通信双方为数据交换而建立的规则、标准或约定的集合</span></p><p><span>协议对数据传输的作用</span></p><ul><li><span>通信双方根据协议能够正确收发数据</span></li><li><span>通信双方根据协议能够解释数据的意义</span></li></ul><hr /><p><span>目标：基于TCP设计可用于文本传输的协议</span></p><p><span>数据头：数据类型（即：数据区用途，固定长度）</span></p><p><span>数据长度：数据区长度（固定长度）</span></p><p><span>数据区：字符数据（变长）</span></p><figure><table><thead><tr><th><span>数据类型</span></th><th><span>数据长度</span></th><th><span>数据区</span></th></tr></thead><tbody><tr><td><span>4个字符</span></td><td><span>4个字符</span></td><td><span>n个字符（由数据长度标识）</span></td></tr></tbody></table></figure><p><span>通过计算数据消息的总长度，能够避免数据粘连的问题</span></p><h4><a name="421-从数据流装配文本协议对象" class="md-header-anchor"></a><span>4.2.1 从数据流装配文本协议对象</span></h4><p><span>如何将接收缓冲区的数据装配成为协议对象</span></p><p><span>缓冲区数据量充足，能够装配不止一个对象，如何处理剩余数据；</span></p><p><span>数据量不足，能否达到协议最小长度，达到最小长度，但是无法产生一个对象</span></p><p><span>解决方案：</span></p><ul><li><p><span>定义一个类用于接收字节流并装配协议对象</span></p></li><li><p><span>类中提供容器（队列）暂存字节流</span></p></li><li><p><span>当容器中至少存在 8 个字节时开始装配</span></p><p><span>1.首先装配协议中的 类型（type）和数据长度（length）</span></p><p><span>2.根据数据区长度从容器中取数据装配协议数据（data）</span></p><p><span>3.当协议数据装配完成时，创建协议对象并返回，否则返回 NULL</span></p></li></ul><hr /><p><span>总结：</span></p><p><span>从连续的字节流装配协议对象是应用自定义协议的基础</span></p><p><span>装配类（TextMsgAssembler） </span><strong><span>用于解析自定义协议</span></strong></p><p><span>装配列的实现关键是</span><strong><span>如何处理字节数据不够的情况</span></strong></p><p><span>自定义协议列和装配类能够</span><strong><span>有效解决数据粘连问题</span></strong></p><h4><a name="422-文本协议中中文处理" class="md-header-anchor"></a><span>4.2.2 文本协议中中文处理</span></h4><p><span>中文类型的宽字符编码 宽字符 &gt;= 2 字节</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">TextMessage</span> <span class="cm-def">mesg</span> (<span class="cm-string">"demo"</span>,<span class="cm-string">"威威位"</span>);</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QString</span> <span class="cm-variable">d</span> <span class="cm-operator">=</span> <span class="cm-variable">mesg</span>.<span class="cm-variable">serialize</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* 方式一 */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">TextMessage</span> <span class="cm-variable">unknown</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">unknown</span>.<span class="cm-variable">unserialize</span>(<span class="cm-variable">d</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">unknown</span>.<span class="cm-variable">type</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">", "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">unknown</span>.<span class="cm-variable">length</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">", "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">unknown</span>.<span class="cm-variable">data</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 能够正常的识别中文</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">/* 方式二 */</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">TextMsgAssembler</span> <span class="cm-variable">as</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QSharedPointer</span><span class="cm-operator">&lt;</span><span class="cm-variable">TextMessage</span><span class="cm-operator">*&gt;</span> <span class="cm-variable">p</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p</span> <span class="cm-operator">=</span> <span class="cm-variable">as</span>.<span class="cm-variable">assembler</span>(<span class="cm-variable">d</span>.<span class="cm-variable">toStdString</span>().<span class="cm-variable">c_srt</span>(), <span class="cm-variable">d</span>.<span class="cm-variable">length</span>());</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">p</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span><span class="cm-operator">&lt;&lt;</span><span class="cm-string">", "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">p</span><span class="cm-operator">-&gt;</span><span class="cm-variable">length</span><span class="cm-operator">&lt;&lt;</span><span class="cm-string">", "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">p</span><span class="cm-operator">-&gt;</span><span class="cm-variable">data</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 不能正常的识别中文</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 330px;"></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></pre><hr /><p><span>原文本协议只考虑ASCII码的情况，不支持中文。ASCII是一个字节，而宽字符 &gt;= 2字节</span></p><p><span>协议设计改动：</span></p><ul><li><span>Type: 4 个ASCII 字符</span></li><li><span>Length: 4 个ASCII 字符（存储数据区字节数）</span></li><li><span>数据区：使用 </span><strong><span>UTF-8</span></strong><span> 方式进行编码</span></li></ul><hr /><p><span>编码格式</span></p><p><span>ASCII：最早统一编码标准，规定了 128 个字符编码（一个字节表示一个字符）</span></p><p><span>Unicode： 一个很大的字符集，规定了字符的二进制代码（编码标准）</span></p><p><span>UTF-8：使用最广泛的一种 Unicode 编码标准的实现</span></p><p><span>		</span><span>特点：一种边长的编码方式，使用1-4个字节表示一个字符</span></p><p><span>		</span><span>英文字母，UTF-8与 ASCII 相同</span></p><h4><a name="423-文本协议的网络应用" class="md-header-anchor"></a><span>4.2.3 文本协议的网络应用</span></h4><ul><li><span>客户端提供发送 TextMessage 对象的成员函数</span></li><li><span>客户端和服务端均内置 TextMsgAssembler 对象，用于从网络字节流装配TextMessage 对象</span></li><li><span>当成功收到 TextMessage 对象，使用 TextMsgHandler 接口进行异步通</span></li></ul><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h3><a name="43-qt-数据库" class="md-header-anchor"></a><span>4.3 Qt 数据库</span></h3><h4><a name="431-创建数据库" class="md-header-anchor"></a><span>4.3.1 创建数据库</span></h4><p><span>依靠的是 SQL 模块</span></p><figure><table><thead><tr><th><span>驱动</span></th><th><span>数据库</span></th></tr></thead><tbody><tr><td><span>QDB2</span></td><td><span>IBM DB2(7.1及更新)</span></td></tr><tr><td><span>QIBASE</span></td><td><span>BOrland InterBase</span></td></tr><tr><td><span>QMYSQL</span></td><td><span>MySQL</span></td></tr><tr><td><span>QOCI</span></td><td><span>Oracle Call Interface Driver</span></td></tr><tr><td><span>QODBC</span></td><td><span>Open Database Connectivity</span></td></tr><tr><td><span>QPSQL</span></td><td><span>PostgreSQL(7.3及更新)</span></td></tr><tr><td><span>QSQLITE2</span></td><td><span>SQLite2</span></td></tr><tr><td><strong><span>QSQLITE</span></strong></td><td><strong><span>SQLite3</span></strong></td></tr><tr><td><span>QSYMSQL</span></td><td><span>针对 Symbian 平台的 SQLite3</span></td></tr><tr><td><span>QTDS</span></td><td><span>Sybase Adaptive Server(自 Qt4.7 废除)</span></td></tr></tbody></table></figure><p><span>SQL 的分层</span></p><p><strong><span>数据库 -&gt; 驱动层 -&gt; SQL 接口层（QSQLDatabase）-&gt; 用户接口层</span></strong><span>（QSQL....Model 作用是将数据库链接到窗口部件）</span></p><p><span>用户使用的是接口层，驱动层是桥梁，</span></p><ul><li><span>使用SQLite3，经常用于嵌入式</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QT</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">+=</span> <span class="cm-variable">core</span> <span class="cm-variable">gui</span> <span class="cm-variable">sql</span> &nbsp; <span class="cm-comment">// 要使用数据库，添加 sql</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QSqlDatabase&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QSqlError&gt; &nbsp;</span><span class="cm-comment">// 数据库错误相关</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QStringList</span> <span class="cm-variable">drivers</span> <span class="cm-operator">=</span> <span class="cm-variable">QSqlDatabase::drivers</span>(); &nbsp;<span class="cm-comment">// 查看支持哪些数据库</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">foreach</span>(<span class="cm-variable">QString</span> <span class="cm-variable">d</span>,<span class="cm-variable">drivers</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-variable">d</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 创建数据库</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QSqlDatabase</span> <span class="cm-variable">db</span> <span class="cm-operator">=</span> <span class="cm-variable">QSqlDatabase::addDatabase</span>(<span class="cm-string">"QSQLITE"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">db</span>.<span class="cm-variable">setDatabaseName</span>(<span class="cm-string">"database.db"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>(<span class="cm-operator">!</span><span class="cm-variable">db</span>.<span class="cm-variable">open</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"Failed to onnect."</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">db</span>.<span class="cm-variable">lastError</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"Connect to database successfully."</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 440px;"></div><div class="CodeMirror-gutters" style="display: none; height: 440px;"></div></div></div></pre><p><strong><span>SQLite 数据库中有很多命令和指令 ，网上可以找到 sqlite 语句大全，学习数据库就是学习数据库指令，以及在Qt中调用这些命令</span></strong></p><h4><a name="432-插入数据库遍历数据库" class="md-header-anchor"></a><span>4.3.2 插入数据库_遍历数据库</span></h4><p><span>数据库中分为不同的表格table，数据要存入 table 中</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QSQlQuery&gt; &nbsp;</span><span class="cm-comment">// 数据库命令</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QSqlQuery</span> <span class="cm-variable">sql_query</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// create a table student(int id, varchar name(30), int age )</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QString</span> <span class="cm-variable">create_sql</span> <span class="cm-operator">=</span> <span class="cm-string">"create a table student( id int, name varchar(30), age int )"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sql_query</span>.<span class="cm-variable">prepare</span>(<span class="cm-variable">create_sql</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">if</span>(<span class="cm-operator">!</span><span class="cm-variable">sql_query</span>.<span class="cm-variable">exec</span>()}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"Failed to create table."</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">sql_query</span>.<span class="cm-variable">lastError</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable">qDebug</span>()<span class="cm-operator">&lt;&lt;</span><span class="cm-string">"Table created."</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">// 添加数据</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">// "insert into student values( ?, ?, ?)"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">QString</span> <span class="cm-variable">insert_sql</span> <span class="cm-operator">=</span> <span class="cm-string">"insert into student values( ?, ?, ?)"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">sql_query</span>.<span class="cm-variable">prepare</span>(<span class="cm-variable">insert_sql</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">sql_query</span>.<span class="cm-variable">addBindValue</span>(<span class="cm-number">1</span>); &nbsp;<span class="cm-comment">// 三个数据，因此要三次</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">sql_query</span>.<span class="cm-variable">addBindValue</span>(<span class="cm-variable">“Rick”</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">sql_query</span>.<span class="cm-variable">addBindValue</span>(<span class="cm-number">18</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">if</span>(<span class="cm-variable">sql_query</span>.<span class="cm-variable">exec</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>() <span class="cm-operator">&lt;&lt;</span><span class="cm-string">"Insert student no.1 OK"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">QString</span> <span class="cm-variable">insert_sql</span> <span class="cm-operator">=</span> <span class="cm-string">"insert into student values( ?, ?, ?)"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">sql_query</span>.<span class="cm-variable">prepare</span>(<span class="cm-variable">insert_sql</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">sql_query</span>.<span class="cm-variable">addBindValue</span>(<span class="cm-number">2</span>); &nbsp;<span class="cm-comment">// 三个数据，因此要三次</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">sql_query</span>.<span class="cm-variable">addBindValue</span>(<span class="cm-variable">“Lihua”</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">sql_query</span>.<span class="cm-variable">addBindValue</span>(<span class="cm-number">19</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">if</span>(<span class="cm-variable">sql_query</span>.<span class="cm-variable">exec</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>() <span class="cm-operator">&lt;&lt;</span><span class="cm-string">"Insert student no.2 OK"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">// 显示数据库</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">// "select * from student"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">QString</span> <span class="cm-variable">select_all_sql</span> <span class="cm-operator">=</span> <span class="cm-string">"select * from student"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">sql_query</span>.<span class="cm-variable">prepare</span>(<span class="cm-variable">select_all_sql</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">if</span>(<span class="cm-variable">sql_query</span>.<span class="cm-variable">exec</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable">qDebug</span>() <span class="cm-operator">&lt;&lt;</span><span class="cm-string">"show database:\n"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-keyword">while</span>(<span class="cm-variable">sql_query</span>.<span class="cm-variable">next</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable-3">int</span> <span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">sql_query</span>.<span class="cm-variable">value</span>(<span class="cm-number">0</span>).<span class="cm-variable">toInt</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span> &nbsp; <span class="cm-variable">QString</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">sql_query</span>.<span class="cm-variable">value</span>(<span class="cm-number">1</span>).<span class="cm-variable">toString</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable-3">int</span> <span class="cm-variable">age</span> <span class="cm-operator">=</span> <span class="cm-variable">sql_query</span>.<span class="cm-variable">value</span>(<span class="cm-number">2</span>).<span class="cm-variable">toInt</span>();</span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">qDebug</span>() <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"id: "</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">id</span><span class="cm-operator">&lt;&lt;</span><span class="cm-string">", name:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">name</span><span class="cm-operator">&lt;&lt;</span><span class="cm-string">", age:"</span><span class="cm-operator">&lt;&lt;</span><span class="cm-variable">age</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1100px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1100px;"></div></div></div></pre><h4><a name="433-更新删除数据库" class="md-header-anchor"></a><span>4.3.3 更新_删除数据库</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 删除数据库</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">“delete</span> <span class="cm-variable">from</span> <span class="cm-variable">student”</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QString</span> <span class="cm-variable">clear_sql</span> <span class="cm-operator">=</span> <span class="cm-variable">“delete</span> <span class="cm-variable">from</span> <span class="cm-variable">student”</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sql_query</span>.<span class="cm-variable">prepare</span>(<span class="cm-variable">clear_sql</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-operator">!</span><span class="cm-variable">sql_query</span>.<span class="cm-variable">exec</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>() <span class="cm-operator">&lt;&lt;</span><span class="cm-string">"failed to clear table."</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>() <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Table cleared"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">//  更新数据库</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"update student set name = :nm where id =n"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QString</span> <span class="cm-variable">update_sql</span> <span class="cm-operator">=</span> <span class="cm-string">"update student set name = :nm where id = :n"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sql_query</span>.<span class="cm-variable">prepare</span>(<span class="cm-variable">update_sql</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sql_query</span>.<span class="cm-variable">bindValue</span>(<span class="cm-string">":nm"</span>,<span class="cm-string">"Michael"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sql_query</span>.<span class="cm-variable">bindValue</span>(<span class="cm-string">":n"</span>,<span class="cm-string">"1"</span>); &nbsp;<span class="cm-comment">//修改 id 为1的那一行 name 为 "Michael"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-operator">!</span><span class="cm-variable">sql_query</span>.<span class="cm-variable">exec</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>() <span class="cm-operator">&lt;&lt;</span><span class="cm-string">"failed to update table."</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>() <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Table updated"</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-comment">// 删除某一行</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">“delete</span> <span class="cm-variable">form</span> <span class="cm-variable">student</span> <span class="cm-variable">where</span> <span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-variable">n”</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QString</span> <span class="cm-variable">delete_sql</span> <span class="cm-operator">=</span> <span class="cm-variable">“delete</span> <span class="cm-variable">form</span> <span class="cm-variable">student</span> <span class="cm-variable">where</span> <span class="cm-variable">id</span> <span class="cm-operator">=</span> <span class="cm-operator">?</span><span class="cm-variable">”</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sql_query</span>.<span class="cm-variable">prepare</span>(<span class="cm-variable">update_sql</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sql_query</span>.<span class="cm-variable">bindValue</span>(<span class="cm-string">"2"</span>); &nbsp;<span class="cm-comment">// 删除 id 为2的那一行</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">if</span>(<span class="cm-operator">!</span><span class="cm-variable">sql_query</span>.<span class="cm-variable">exec</span>())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-variable">qDebug</span>() <span class="cm-operator">&lt;&lt;</span><span class="cm-string">"failed to delete table row NO.2."</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre><div class="" style="position: relative;"><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">qDebug</span>() <span class="cm-operator">&lt;&lt;</span> <span class="cm-string">"Table row NO.2 deleted"</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 682px;"></div><div class="CodeMirror-gutters" style="display: none; height: 682px;"></div></div></div></pre><h4><a name="434-数据库数据窗体访问修改以及查找" class="md-header-anchor"></a><span>4.3.4 数据库数据窗体访问，修改以及查找</span></h4><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QT</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">+=</span> <span class="cm-variable">core</span> <span class="cm-variable">gui</span> <span class="cm-variable">sql</span> &nbsp; <span class="cm-comment">// 要使用数据库，添加 sql</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QSqlDatabase&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QSqlError&gt; &nbsp;</span><span class="cm-comment">// 数据库错误相关</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QSQlQuery&gt; &nbsp;</span><span class="cm-comment">// 数据库命令</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 110px;"></div><div class="CodeMirror-gutters" style="display: none; height: 110px;"></div></div></div></pre><p><span>以上是 库提供SQL 接口层，</span></p><p><strong><span>用户接口层（QSQL....Model 作用是将数据库链接到窗口部件）</span></strong></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c++" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c++"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 14px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QSqlQueryModel&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QSqlTableModel&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QSqlRelationModel&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;QTableView&gt; &nbsp;</span><span class="cm-comment">// ui 界面中的表格，用于显示数据库</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">QSqlTableModel</span> <span class="cm-operator">*</span><span class="cm-variable">model</span>; &nbsp;<span class="cm-comment">// .h 中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// .c 中</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">QSqlTableModel</span>(<span class="cm-keyword">this</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">tableView</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setModel</span>(<span class="cm-variable">model</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setTable</span>(<span class="cm-variable">student</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span><span class="cm-operator">-&gt;</span><span class="cm-variable">select</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 将 id，name，age 修改为中文，仅仅是显示改了</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setHeaderData</span>(<span class="cm-number">0</span>,<span class="cm-variable">Qt::Horizontal</span>,<span class="cm-string">"序号"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setHeaderData</span>(<span class="cm-number">1</span>,<span class="cm-variable">Qt::Horizontal</span>,<span class="cm-string">"姓名"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setHeaderData</span>(<span class="cm-number">2</span>,<span class="cm-variable">Qt::Horizontal</span>,<span class="cm-string">"年龄"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">model</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setEditStrategy</span>(<span class="cm-variable">QSqlTableModel::OnManualSubmit</span>); &nbsp;<span class="cm-comment">// 修改后需要 submit 才会生效</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">connect</span>(<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pushButton1</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">QPushButton::clicked</span>(),<span class="cm-keyword">this</span>,[<span class="cm-operator">&amp;</span>](){<span class="cm-variable">model</span><span class="cm-operator">-&gt;</span><span class="cm-variable">submit</span>()}); &nbsp;<span class="cm-comment">// 修改后点击按键提交修改</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">connect</span>(<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pushButton2</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">QPushButton::clicked</span>(),<span class="cm-keyword">this</span>,[<span class="cm-operator">&amp;</span>](){<span class="cm-variable">model</span><span class="cm-operator">-&gt;</span><span class="cm-variable">revertAll</span>()}); &nbsp;<span class="cm-comment">// 撤销修改</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// 查找</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">connect</span>(<span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pushButton3</span>,<span class="cm-operator">&amp;</span><span class="cm-variable">QPushButton::clicked</span>(),<span class="cm-keyword">this</span>,[<span class="cm-operator">&amp;</span>](){</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QString</span> <span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-variable">ui</span><span class="cm-operator">-&gt;</span><span class="cm-variable">lineEdit</span><span class="cm-operator">-&gt;</span><span class="cm-variable">text</span>();</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">QString</span> <span class="cm-variable">nm</span> <span class="cm-operator">=</span> <span class="cm-variable">QString</span>(<span class="cm-string">"name='%1' "</span>).<span class="cm-variable">arg</span>(<span class="cm-variable">name</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">// " ame = 'Tom' "</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">model</span><span class="cm-operator">-&gt;</span><span class="cm-variable">setFilter</span>(<span class="cm-variable">nm</span>); &nbsp;<span class="cm-comment">// </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">model</span><span class="cm-operator">-&gt;</span><span class="cm-variable">select</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}); </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 792px;"></div><div class="CodeMirror-gutters" style="display: none; height: 792px;"></div></div></div></pre><p><span>QString nm = QString(&quot;name=&#39;%1&#39; &quot;).arg(name);</span></p><p><span>将字符串 name 内容替换掉 %1</span></p></div>
</body>
</html>